<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Intro Sell Practice - HenryHQ</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Instrument+Serif:ital@0;1&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #000000;
            min-height: 100vh;
            color: #e0e0e0;
        }

        /* TOP NAV */
        .top-nav {
            padding: 16px 24px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .top-nav-logo {
            font-family: 'Instrument Serif', Georgia, serif;
            font-size: 1.5rem;
            color: #fafafa;
            text-decoration: none;
        }

        .top-nav-logo em {
            font-style: italic;
            color: #22d3ee;
        }

        .top-nav-links {
            display: flex;
            gap: 24px;
            align-items: center;
        }

        .top-nav-link {
            color: #a1a1aa;
            text-decoration: none;
            font-size: 0.9rem;
            transition: color 0.2s;
        }

        .top-nav-link:hover {
            color: #22d3ee;
        }

        /* Header */
        .header {
            background: rgba(15, 15, 35, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(138, 43, 226, 0.2);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .back-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #a0a0a0;
            text-decoration: none;
            font-size: 0.9rem;
            transition: color 0.2s;
        }

        .back-btn:hover {
            color: #fff;
        }

        .header-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #fff;
        }

        /* Main Container */
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Hero Section */
        .hero {
            text-align: center;
            margin-bottom: 2rem;
        }

        .hero-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .hero h1 {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #a855f7, #6366f1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero p {
            color: #a0a0a0;
            font-size: 1rem;
            max-width: 500px;
            margin: 0 auto;
        }

        /* Tips Card */
        .tips-card {
            background: rgba(138, 43, 226, 0.1);
            border: 1px solid rgba(138, 43, 226, 0.3);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .tips-card h3 {
            font-size: 0.9rem;
            font-weight: 600;
            color: #a855f7;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .tips-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.75rem;
        }

        .tip-item {
            display: flex;
            align-items: flex-start;
            gap: 0.5rem;
            font-size: 0.85rem;
            color: #c0c0c0;
        }

        .tip-icon {
            color: #10b981;
            font-size: 0.8rem;
            margin-top: 2px;
        }

        /* Practice Section */
        .practice-section {
            background: rgba(30, 30, 60, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #fff;
        }

        .word-count {
            font-size: 0.85rem;
            color: #a0a0a0;
            padding: 0.25rem 0.75rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
        }

        .word-count.good {
            color: #10b981;
            background: rgba(16, 185, 129, 0.1);
        }

        .word-count.warning {
            color: #f59e0b;
            background: rgba(245, 158, 11, 0.1);
        }

        .word-count.over {
            color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
        }

        /* Context Inputs */
        .context-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .context-field {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .context-field label {
            font-size: 0.8rem;
            color: #a0a0a0;
            font-weight: 500;
        }

        .context-field input,
        .context-field select {
            padding: 0.75rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #fff;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .context-field input:focus,
        .context-field select:focus {
            outline: none;
            border-color: rgba(138, 43, 226, 0.5);
            background: rgba(255, 255, 255, 0.08);
        }

        .context-field input::placeholder {
            color: #666;
        }

        .context-field select option {
            background: #1a1a3e;
            color: #fff;
        }

        /* Seniority Hint */
        .seniority-hint {
            display: flex;
            align-items: flex-start;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: 8px;
            margin-bottom: 1.5rem;
            font-size: 0.85rem;
            color: #a0a0a0;
            line-height: 1.5;
        }

        .hint-icon {
            flex-shrink: 0;
        }

        /* Pre-populated hint */
        .prepopulated-hint {
            display: flex;
            align-items: flex-start;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 8px;
            margin-bottom: 1rem;
            font-size: 0.85rem;
            color: #10b981;
            line-height: 1.5;
        }

        .prepopulated-hint span:nth-child(2) {
            flex: 1;
        }

        .clear-hint-btn {
            background: none;
            border: none;
            color: #10b981;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0;
            line-height: 1;
            opacity: 0.7;
        }

        .clear-hint-btn:hover {
            opacity: 1;
        }

        /* Intro Textarea */
        .intro-textarea {
            width: 100%;
            min-height: 180px;
            padding: 1.25rem;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: #fff;
            font-size: 1rem;
            line-height: 1.6;
            resize: vertical;
            transition: all 0.2s;
        }

        .intro-textarea:focus {
            outline: none;
            border-color: rgba(138, 43, 226, 0.5);
            background: rgba(255, 255, 255, 0.05);
        }

        .intro-textarea::placeholder {
            color: #666;
        }

        /* Action Buttons */
        .action-row {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .btn {
            flex: 1;
            padding: 1rem 1.5rem;
            border-radius: 10px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #8b5cf6, #6366f1);
            border: none;
            color: #fff;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.3);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #c0c0c0;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        .btn-voice {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #ef4444;
        }

        .btn-voice:hover {
            background: rgba(239, 68, 68, 0.2);
        }

        .btn-voice.recording {
            background: #ef4444;
            color: #fff;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Timer Display */
        .timer-display {
            display: none;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 10px;
            color: #ef4444;
            font-size: 1.2rem;
            font-weight: 600;
            font-variant-numeric: tabular-nums;
        }

        .timer-display.active {
            display: flex;
        }

        .timer-dot {
            width: 8px;
            height: 8px;
            background: #ef4444;
            border-radius: 50%;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        /* Feedback Section */
        .feedback-section {
            background: rgba(30, 30, 60, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 2rem;
            display: none;
        }

        .feedback-section.visible {
            display: block;
        }

        .feedback-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .feedback-score {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
            font-weight: 700;
            color: #fff;
        }

        .feedback-score.excellent {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .feedback-score.good {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }

        .feedback-score.needs-work {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        .feedback-title {
            flex: 1;
        }

        .feedback-title h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #fff;
            margin-bottom: 0.25rem;
        }

        .feedback-title p {
            font-size: 0.85rem;
            color: #a0a0a0;
        }

        /* Feedback Grid */
        .feedback-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .feedback-box {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 1.25rem;
        }

        .feedback-box h4 {
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .feedback-box.strengths h4 {
            color: #10b981;
        }

        .feedback-box.improvements h4 {
            color: #f59e0b;
        }

        .feedback-box ul {
            list-style: none;
        }

        .feedback-box li {
            font-size: 0.9rem;
            color: #c0c0c0;
            padding: 0.4rem 0;
            padding-left: 1.25rem;
            position: relative;
        }

        .feedback-box li::before {
            content: '‚Ä¢';
            position: absolute;
            left: 0;
            color: #666;
        }

        /* Rewritten Intro */
        .rewritten-section {
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 12px;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
        }

        .rewritten-section h4 {
            font-size: 0.85rem;
            font-weight: 600;
            color: #a855f7;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .rewritten-text {
            font-size: 0.95rem;
            color: #e0e0e0;
            line-height: 1.7;
        }

        .copy-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1rem;
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            color: #a0a0a0;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .copy-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        .copy-btn.copied {
            color: #10b981;
            border-color: rgba(16, 185, 129, 0.3);
        }

        /* Coaching Tips */
        .coaching-section {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 1.25rem;
        }

        .coaching-section h4 {
            font-size: 0.85rem;
            font-weight: 600;
            color: #6366f1;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .coaching-tips {
            font-size: 0.9rem;
            color: #c0c0c0;
            line-height: 1.6;
        }

        /* Loading State */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 15, 35, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .loading-overlay.active {
            display: flex;
        }

        .loading-content {
            text-align: center;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(138, 43, 226, 0.2);
            border-top-color: #8b5cf6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            color: #a0a0a0;
            font-size: 0.95rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .context-grid {
                grid-template-columns: 1fr;
            }

            .feedback-grid {
                grid-template-columns: 1fr;
            }

            .action-row {
                flex-direction: column;
            }
        }
    </style>
    <link rel="stylesheet" href="css/mobile.css">
    <!-- Supabase Auth -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/supabase-client.js"></script>
</head>
<body>
    <nav class="top-nav">
        <a href="index.html" class="top-nav-logo"><em>Henry</em>HQ</a>
    </nav>

    <header class="header">
        <div class="header-content">
            <a href="interview-intelligence.html" class="back-btn">
                <span>‚Üê</span> Back to Practice
            </a>
            <span class="header-title">Intro Sell Practice</span>
        </div>
    </header>

    <main class="container">
        <section class="hero">
            <div class="hero-icon">üëã</div>
            <h1>Intro Sell Practice</h1>
            <p>Craft and perfect your 60‚Äì90 second opener that makes a strong first impression</p>
        </section>

        <div class="tips-card">
            <h3><span>üí°</span> Keys to a Strong Intro</h3>
            <div class="tips-list">
                <div class="tip-item">
                    <span class="tip-icon">‚úì</span>
                    <span>60‚Äì90 seconds (120‚Äì180 words)</span>
                </div>
                <div class="tip-item">
                    <span class="tip-icon">‚úì</span>
                    <span>Lead with your current role</span>
                </div>
                <div class="tip-item">
                    <span class="tip-icon">‚úì</span>
                    <span>Highlight 2‚Äì3 key achievements</span>
                </div>
                <div class="tip-item">
                    <span class="tip-icon">‚úì</span>
                    <span>Connect experience to target role</span>
                </div>
                <div class="tip-item">
                    <span class="tip-icon">‚úì</span>
                    <span>Sound natural, not rehearsed</span>
                </div>
                <div class="tip-item">
                    <span class="tip-icon">‚úì</span>
                    <span>Match expectations to your level</span>
                </div>
            </div>
        </div>

        <section class="practice-section">
            <div class="section-header">
                <h2 class="section-title">Your Intro</h2>
                <span id="wordCount" class="word-count">0 words</span>
            </div>

            <div class="context-grid">
                <div class="context-field">
                    <label>Target Role (optional)</label>
                    <input type="text" id="targetRole" placeholder="e.g., Product Manager, Software Engineer, Marketing Manager">
                </div>
                <div class="context-field">
                    <label>Seniority Level</label>
                    <select id="seniorityLevel">
                        <option value="entry">Entry Level / Junior (0-2 years)</option>
                        <option value="mid" selected>Mid Level (3-5 years)</option>
                        <option value="senior">Senior (6-10 years)</option>
                        <option value="staff">Staff / Principal (10+ years)</option>
                        <option value="director">Director / VP</option>
                        <option value="executive">Executive (C-Suite)</option>
                    </select>
                </div>
            </div>

            <p class="seniority-hint" id="seniorityHint">
                <span class="hint-icon">üí°</span>
                <span id="hintText">At mid level, highlight 1-2 significant projects with measurable impact and growth trajectory.</span>
            </p>

            <textarea
                id="introText"
                class="intro-textarea"
                placeholder="Start writing your intro here...

Example structure:
‚Ä¢ Current role & company (1-2 sentences)
‚Ä¢ Key achievements with metrics (2-3 sentences)
‚Ä¢ Why you're interested in this role/company (1-2 sentences)"
            ></textarea>

            <div id="timerDisplay" class="timer-display">
                <span class="timer-dot"></span>
                <span id="timerText">0:00</span>
            </div>

            <div class="action-row">
                <button id="recordBtn" class="btn btn-voice" onclick="toggleRecording()">
                    <span>üé§</span> Record Practice
                </button>
                <button id="feedbackBtn" class="btn btn-primary" onclick="getFeedback()" disabled>
                    <span>‚ú®</span> Get Feedback
                </button>
            </div>
        </section>

        <section id="feedbackSection" class="feedback-section">
            <div class="feedback-header">
                <div id="feedbackScore" class="feedback-score good">85</div>
                <div class="feedback-title">
                    <h3 id="feedbackGrade">Good Intro!</h3>
                    <p id="feedbackSummary">Strong foundation with room for improvement</p>
                </div>
            </div>

            <div class="feedback-grid">
                <div class="feedback-box strengths">
                    <h4><span>‚úì</span> Strengths</h4>
                    <ul id="strengthsList">
                        <li>Clear role positioning</li>
                        <li>Good use of metrics</li>
                    </ul>
                </div>
                <div class="feedback-box improvements">
                    <h4><span>‚Üë</span> Areas to Improve</h4>
                    <ul id="improvementsList">
                        <li>Add company-specific connection</li>
                        <li>Strengthen closing statement</li>
                    </ul>
                </div>
            </div>

            <div class="rewritten-section">
                <h4><span>üìù</span> Suggested Rewrite</h4>
                <p id="rewrittenText" class="rewritten-text"></p>
                <button id="copyBtn" class="copy-btn" onclick="copyRewrite()">
                    <span>üìã</span> Copy to Clipboard
                </button>
            </div>

            <div class="coaching-section">
                <h4><span>üéØ</span> Coaching Tips</h4>
                <p id="coachingTips" class="coaching-tips"></p>
            </div>
        </section>
    </main>

    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p class="loading-text">Analyzing your intro...</p>
        </div>
    </div>

    <script>
        // State
        let isRecording = false;
        let mediaRecorder = null;
        let audioChunks = [];
        let recordingTimer = null;
        let recordingSeconds = 0;

        // Elements
        const introText = document.getElementById('introText');
        const wordCount = document.getElementById('wordCount');
        const feedbackBtn = document.getElementById('feedbackBtn');
        const recordBtn = document.getElementById('recordBtn');
        const timerDisplay = document.getElementById('timerDisplay');
        const timerText = document.getElementById('timerText');
        const feedbackSection = document.getElementById('feedbackSection');
        const loadingOverlay = document.getElementById('loadingOverlay');

        // Seniority level hints
        const seniorityHints = {
            entry: "At entry level, focus on relevant education, internships, and transferable skills. Show eagerness to learn and grow.",
            mid: "At mid level, highlight 1-2 significant projects with measurable impact and your growth trajectory.",
            senior: "At senior level, emphasize leadership of complex initiatives, mentoring others, and strategic impact with quantified results.",
            staff: "At staff/principal level, demonstrate cross-team influence, technical vision, and organization-wide impact.",
            director: "At director level, showcase P&L responsibility, team building, strategic decisions, and business outcomes.",
            executive: "At executive level, emphasize company-wide transformation, board-level communication, and industry thought leadership."
        };

        // Seniority level change handler
        const seniorityLevel = document.getElementById('seniorityLevel');
        const hintText = document.getElementById('hintText');

        seniorityLevel.addEventListener('change', function() {
            hintText.textContent = seniorityHints[this.value];
        });

        // Word count tracking
        introText.addEventListener('input', updateWordCount);

        function updateWordCount() {
            const text = introText.value.trim();
            const words = text ? text.split(/\s+/).length : 0;
            wordCount.textContent = `${words} words`;

            // Update color based on word count
            wordCount.classList.remove('good', 'warning', 'over');
            if (words >= 120 && words <= 180) {
                wordCount.classList.add('good');
            } else if (words > 180 && words <= 220) {
                wordCount.classList.add('warning');
            } else if (words > 220) {
                wordCount.classList.add('over');
            }

            // Enable/disable feedback button
            feedbackBtn.disabled = words < 30;
        }

        // Recording functionality
        async function toggleRecording() {
            if (isRecording) {
                stopRecording();
            } else {
                await startRecording();
            }
        }

        async function startRecording() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];

                mediaRecorder.ondataavailable = (event) => {
                    audioChunks.push(event.data);
                };

                mediaRecorder.onstop = async () => {
                    const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                    await transcribeAudio(audioBlob);
                    stream.getTracks().forEach(track => track.stop());
                };

                mediaRecorder.start();
                isRecording = true;
                recordBtn.classList.add('recording');
                recordBtn.innerHTML = '<span>‚èπ</span> Stop Recording';

                // Start timer
                recordingSeconds = 0;
                timerDisplay.classList.add('active');
                updateTimer();
                recordingTimer = setInterval(updateTimer, 1000);
            } catch (error) {
                console.error('Recording error:', error);
                alert('Could not access microphone. Please check permissions.');
            }
        }

        function stopRecording() {
            if (mediaRecorder && isRecording) {
                mediaRecorder.stop();
                isRecording = false;
                recordBtn.classList.remove('recording');
                recordBtn.innerHTML = '<span>üé§</span> Record Practice';

                // Stop timer
                clearInterval(recordingTimer);
                timerDisplay.classList.remove('active');
            }
        }

        function updateTimer() {
            recordingSeconds++;
            const mins = Math.floor(recordingSeconds / 60);
            const secs = recordingSeconds % 60;
            timerText.textContent = `${mins}:${secs.toString().padStart(2, '0')}`;

            // Warning if over 90 seconds
            if (recordingSeconds > 90) {
                timerDisplay.style.borderColor = 'rgba(239, 68, 68, 0.8)';
                timerDisplay.style.color = '#ef4444';
            }
        }

        async function transcribeAudio(audioBlob) {
            loadingOverlay.classList.add('active');
            document.querySelector('.loading-text').textContent = 'Transcribing your intro...';

            try {
                const formData = new FormData();
                formData.append('audio', audioBlob);

                const response = await fetch('/api/transcribe', {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    const data = await response.json();
                    introText.value = data.transcription;
                    updateWordCount();
                } else {
                    throw new Error('Transcription failed');
                }
            } catch (error) {
                console.error('Transcription error:', error);
                alert('Could not transcribe audio. Please try typing your intro instead.');
            } finally {
                loadingOverlay.classList.remove('active');
            }
        }

        // Get feedback
        async function getFeedback() {
            const intro = introText.value.trim();
            if (!intro || intro.split(/\s+/).length < 30) {
                alert('Please write at least 30 words before getting feedback.');
                return;
            }

            loadingOverlay.classList.add('active');
            document.querySelector('.loading-text').textContent = 'Analyzing your intro...';

            try {
                const role = document.getElementById('targetRole').value.trim();
                const seniority = document.getElementById('seniorityLevel').value;

                const response = await fetch('/api/intro-feedback', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        intro,
                        target_role: role || null,
                        seniority_level: seniority
                    })
                });

                if (response.ok) {
                    const feedback = await response.json();
                    displayFeedback(feedback);
                } else {
                    throw new Error('Feedback request failed');
                }
            } catch (error) {
                console.error('Feedback error:', error);
                // Show mock feedback for demo
                displayFeedback(generateMockFeedback());
            } finally {
                loadingOverlay.classList.remove('active');
            }
        }

        function displayFeedback(feedback) {
            // Score
            const scoreEl = document.getElementById('feedbackScore');
            scoreEl.textContent = feedback.score;
            scoreEl.classList.remove('excellent', 'good', 'needs-work');
            if (feedback.score >= 85) {
                scoreEl.classList.add('excellent');
                document.getElementById('feedbackGrade').textContent = 'Excellent Intro!';
            } else if (feedback.score >= 70) {
                scoreEl.classList.add('good');
                document.getElementById('feedbackGrade').textContent = 'Good Intro!';
            } else {
                scoreEl.classList.add('needs-work');
                document.getElementById('feedbackGrade').textContent = 'Needs Work';
            }

            document.getElementById('feedbackSummary').textContent = feedback.summary;

            // Strengths
            const strengthsList = document.getElementById('strengthsList');
            strengthsList.innerHTML = feedback.strengths.map(s => `<li>${s}</li>`).join('');

            // Improvements
            const improvementsList = document.getElementById('improvementsList');
            improvementsList.innerHTML = feedback.improvements.map(i => `<li>${i}</li>`).join('');

            // Rewritten intro
            document.getElementById('rewrittenText').textContent = feedback.rewritten_intro;

            // Coaching tips
            document.getElementById('coachingTips').textContent = feedback.coaching_tips;

            // Show section
            feedbackSection.classList.add('visible');
            feedbackSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function generateMockFeedback() {
            const wordCount = introText.value.trim().split(/\s+/).length;
            const seniority = document.getElementById('seniorityLevel').value;
            let score = 70;

            if (wordCount >= 120 && wordCount <= 180) score += 10;
            if (introText.value.includes('%') || /\d+/.test(introText.value)) score += 5;
            if (introText.value.toLowerCase().includes('led') ||
                introText.value.toLowerCase().includes('built') ||
                introText.value.toLowerCase().includes('grew')) score += 5;

            // Seniority-specific feedback
            const seniorityFeedback = {
                entry: {
                    improvements: [
                        'Highlight relevant coursework, projects, or internships',
                        'Show enthusiasm and eagerness to learn',
                        'Connect transferable skills to the target role'
                    ],
                    tips: 'At entry level, focus on demonstrating potential and a growth mindset. Highlight any relevant projects, coursework, or internships. Show enthusiasm for learning and explain why you\'re drawn to this field.'
                },
                mid: {
                    improvements: [
                        'Add 1-2 specific metrics or achievements',
                        'Show progression and growth in your career',
                        'Highlight a key project that demonstrates your capabilities'
                    ],
                    tips: 'At mid level, interviewers want to see tangible impact. Include specific metrics (%, $, time saved) and demonstrate ownership of meaningful projects. Show you\'re ready for increased responsibility.'
                },
                senior: {
                    improvements: [
                        'Emphasize leadership and mentoring of others',
                        'Highlight strategic impact, not just execution',
                        'Show cross-functional influence and collaboration'
                    ],
                    tips: 'At senior level, you\'re expected to have led complex initiatives. Emphasize how you\'ve mentored others, driven strategy, and influenced beyond your immediate team. Quantify your impact at scale.'
                },
                staff: {
                    improvements: [
                        'Demonstrate organization-wide technical influence',
                        'Show how you\'ve shaped technical vision or strategy',
                        'Highlight your role as a force multiplier for the team'
                    ],
                    tips: 'At staff/principal level, you should demonstrate broad technical leadership. Show how you\'ve influenced architecture decisions, mentored senior engineers, and driven initiatives that affected multiple teams.'
                },
                director: {
                    improvements: [
                        'Include P&L or budget responsibility metrics',
                        'Highlight team building and organizational design',
                        'Show strategic business impact, not just operational'
                    ],
                    tips: 'At director level, focus on business outcomes and team leadership. Include metrics around team growth, budget management, and strategic initiatives. Show how you\'ve built high-performing organizations.'
                },
                executive: {
                    improvements: [
                        'Lead with company-wide transformation or impact',
                        'Include board-level metrics and outcomes',
                        'Demonstrate thought leadership in your industry'
                    ],
                    tips: 'At executive level, your intro should convey company-wide vision and transformation. Lead with your most significant business outcomes and demonstrate strategic thinking that transcends functional boundaries.'
                }
            };

            const feedback = seniorityFeedback[seniority] || seniorityFeedback.mid;

            return {
                score: Math.min(score, 95),
                summary: `Your intro has a solid foundation for ${seniority === 'entry' ? 'an entry-level' : seniority === 'mid' ? 'a mid-level' : seniority === 'senior' ? 'a senior' : seniority === 'staff' ? 'a staff/principal' : seniority === 'director' ? 'a director' : 'an executive'} candidate. Here\'s how to strengthen it further.`,
                strengths: [
                    'Clear explanation of current role',
                    'Good narrative flow',
                    wordCount >= 100 ? 'Appropriate length' : 'Concise delivery'
                ],
                improvements: feedback.improvements,
                rewritten_intro: 'I\'m currently a [Role] at [Company], where I\'ve [key achievement with metric]. Before that, I [relevant experience]. I\'m looking to bring my experience in [skill] to help [specific value you can add].',
                coaching_tips: feedback.tips
            };
        }

        function copyRewrite() {
            const text = document.getElementById('rewrittenText').textContent;
            navigator.clipboard.writeText(text).then(() => {
                const btn = document.getElementById('copyBtn');
                btn.classList.add('copied');
                btn.innerHTML = '<span>‚úì</span> Copied!';
                setTimeout(() => {
                    btn.classList.remove('copied');
                    btn.innerHTML = '<span>üìã</span> Copy to Clipboard';
                }, 2000);
            });
        }

        // Pre-populate from session data if available
        function initializeFromSession() {
            try {
                const analysisData = JSON.parse(sessionStorage.getItem('analysisData') || '{}');
                const prepGuideData = JSON.parse(sessionStorage.getItem('prepGuideData') || '{}');

                // Pre-populate target role from analysis
                if (analysisData.role_title) {
                    document.getElementById('targetRole').value = analysisData.role_title;
                }

                // Pre-populate intro pitch from prep guide if available
                if (prepGuideData.intro_pitch) {
                    introText.value = prepGuideData.intro_pitch;
                    updateWordCount();
                    showPrePopulatedHint();
                }
            } catch (e) {
                console.log('No session data available');
            }
        }

        function showPrePopulatedHint() {
            // Add a hint above the textarea that this was pre-populated
            const hint = document.createElement('div');
            hint.className = 'prepopulated-hint';
            hint.innerHTML = `
                <span class="hint-icon">‚ú®</span>
                <span>We've pre-loaded your AI-generated intro pitch. Practice saying it out loud, then edit it to sound natural in your own voice.</span>
                <button class="clear-hint-btn" onclick="this.parentElement.remove()">√ó</button>
            `;
            introText.parentElement.insertBefore(hint, introText);
        }

        // Initialize
        updateWordCount();
        initializeFromSession();
    </script>
<script src="components/analytics.js"></script>
<script src="components/hey-henry.js"></script>
<script src="components/admin-alerts.js"></script>
<script src="components/strategy-nav.js"></script>
    <script src="components/status-banner.js"></script>
<script src="components/top-nav.js"></script>
</body>
</html>
