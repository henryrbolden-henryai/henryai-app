<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Profile ‚Äî HenryHQ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=DM+Sans:opsz,wght@9..40,400;9..40,500;9..40,600&display=swap" rel="stylesheet">
    <style>
        :root {
            --color-bg: #0a0a0b;
            --color-surface: #141416;
            --color-surface-elevated: #1c1c1f;
            --color-border: rgba(255, 255, 255, 0.08);
            --color-border-hover: rgba(255, 255, 255, 0.15);
            --color-text: #fafafa;
            --color-text-secondary: #a1a1aa;
            --color-accent: #22d3ee;
            --color-accent-muted: rgba(34, 211, 238, 0.15);
            --color-success: #4ade80;
            --color-warning: #fbbf24;
            --color-error: #f87171;
            --font-display: 'Instrument Serif', Georgia, serif;
            --font-body: 'DM Sans', -apple-system, sans-serif;
            --ease-out: cubic-bezier(0.16, 1, 0.3, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            background: var(--color-bg);
            color: var(--color-text);
            min-height: 100vh;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            padding: 40px 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        .back-link {
            color: var(--color-text-secondary);
            text-decoration: none;
            font-size: 0.9rem;
            display: inline-block;
            margin-bottom: 24px;
        }

        .back-link:hover {
            color: var(--color-accent);
        }

        h1 {
            font-family: var(--font-display);
            font-size: 2rem;
            font-weight: 400;
            margin-bottom: 8px;
        }

        .subtitle {
            color: var(--color-text-secondary);
            font-size: 1rem;
            margin-bottom: 32px;
        }

        .form-section {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
        }

        .section-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-title .icon {
            font-size: 1.2rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group:last-child {
            margin-bottom: 0;
        }

        label {
            display: block;
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--color-text);
        }

        .label-hint {
            font-weight: 400;
            color: var(--color-text-secondary);
            font-size: 0.85rem;
        }

        input[type="text"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 12px 16px;
            background: var(--color-bg);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            color: var(--color-text);
            font-family: var(--font-body);
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--color-accent);
        }

        select {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23a1a1aa' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 16px center;
            padding-right: 40px;
        }

        .comp-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
        }

        .comp-grid label {
            font-size: 0.8rem;
            color: var(--color-text-secondary);
        }

        .comp-grid input {
            text-align: center;
        }

        .resume-info {
            background: var(--color-bg);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            padding: 16px;
        }

        .resume-info-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .resume-info-name {
            font-weight: 600;
            color: var(--color-success);
        }

        .resume-info-meta {
            font-size: 0.85rem;
            color: var(--color-text-secondary);
        }

        .resume-chat-link {
            display: inline-block;
            margin-top: 12px;
            color: var(--color-accent);
            text-decoration: none;
            font-size: 0.9rem;
        }

        .resume-chat-link:hover {
            text-decoration: underline;
        }

        .file-upload {
            position: relative;
            border: 2px dashed var(--color-border);
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            cursor: pointer;
            transition: border-color 0.2s, background 0.2s;
            display: none;
        }

        .file-upload.show {
            display: block;
        }

        .file-upload:hover {
            border-color: var(--color-accent);
            background: var(--color-accent-muted);
        }

        .file-upload input {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }

        .file-upload-text {
            color: var(--color-text-secondary);
            font-size: 0.9rem;
        }

        .parsing-status {
            margin-top: 12px;
            font-size: 0.85rem;
            color: var(--color-text-secondary);
            display: none;
        }

        .parsing-status.show {
            display: block;
        }

        .parsing-status.success {
            color: var(--color-success);
        }

        .location-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .location-tag {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: var(--color-accent-muted);
            border: 1px solid rgba(34, 211, 238, 0.3);
            border-radius: 20px;
            font-size: 0.85rem;
            color: var(--color-accent);
        }

        .location-tag button {
            background: none;
            border: none;
            color: var(--color-accent);
            cursor: pointer;
            font-size: 1rem;
            line-height: 1;
            padding: 0;
        }

        /* Section hint text */
        .section-hint {
            color: var(--color-text-secondary);
            font-size: 0.9rem;
            margin-bottom: 16px;
            margin-top: -8px;
        }

        /* Henry Response Bubbles */
        .henry-response {
            display: none;
            margin-top: 12px;
            padding: 14px 16px;
            background: var(--color-accent-muted);
            border-left: 3px solid var(--color-accent);
            border-radius: 0 8px 8px 0;
            font-size: 0.9rem;
            color: var(--color-text);
            line-height: 1.5;
        }

        .henry-response.show {
            display: block;
        }

        .henry-response::before {
            content: 'üí¨ ';
        }

        /* File Upload - New Profile Style */
        .file-upload {
            border: 2px dashed var(--color-border);
            border-radius: 12px;
            padding: 40px 32px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .file-upload:hover {
            border-color: var(--color-accent);
            background: var(--color-accent-muted);
        }

        .file-upload.has-file {
            border-color: var(--color-success);
            background: rgba(74, 222, 128, 0.1);
        }

        .file-upload.hidden {
            display: none;
        }

        .file-upload input[type="file"] {
            display: none;
        }

        .upload-icon {
            font-size: 2.5rem;
            margin-bottom: 12px;
        }

        .upload-text {
            color: var(--color-text-secondary);
            font-size: 0.95rem;
        }

        .upload-text span {
            color: var(--color-accent);
            text-decoration: underline;
        }

        .file-name {
            display: none;
            margin-top: 12px;
            color: var(--color-success);
            font-size: 0.9rem;
        }

        .file-name.show {
            display: block;
        }

        /* Radio Options */
        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 16px;
            background: var(--color-bg);
            border: 1px solid var(--color-border);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .radio-option:hover {
            border-color: var(--color-border-hover);
        }

        .radio-option.selected {
            border-color: var(--color-accent);
            background: var(--color-accent-muted);
        }

        .radio-option input {
            display: none;
        }

        .radio-circle {
            width: 20px;
            height: 20px;
            border: 2px solid var(--color-border);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .radio-option.selected .radio-circle {
            border-color: var(--color-accent);
        }

        .radio-circle::after {
            content: '';
            width: 10px;
            height: 10px;
            background: var(--color-accent);
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .radio-option.selected .radio-circle::after {
            opacity: 1;
        }

        .radio-label {
            font-size: 0.95rem;
            color: var(--color-text);
        }

        /* Checkbox Options */
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .checkbox-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 16px;
            background: var(--color-bg);
            border: 1px solid var(--color-border);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .checkbox-option:hover {
            border-color: var(--color-border-hover);
        }

        .checkbox-option.selected {
            border-color: var(--color-accent);
            background: var(--color-accent-muted);
        }

        .checkbox-option input {
            display: none;
        }

        .checkbox-box {
            width: 18px;
            height: 18px;
            border: 2px solid var(--color-border);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .checkbox-option.selected .checkbox-box {
            border-color: var(--color-accent);
            background: var(--color-accent);
        }

        .checkbox-box::after {
            content: '‚úì';
            font-size: 12px;
            color: var(--color-bg);
            opacity: 0;
        }

        .checkbox-option.selected .checkbox-box::after {
            opacity: 1;
        }

        .add-location {
            display: flex;
            gap: 8px;
        }

        .add-location input {
            flex: 1;
        }

        .add-location button {
            padding: 12px 20px;
            background: var(--color-surface-elevated);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            color: var(--color-text);
            cursor: pointer;
            font-size: 0.9rem;
            white-space: nowrap;
        }

        .button-group {
            display: flex;
            gap: 12px;
        }

        .btn-primary {
            flex: 1;
            padding: 16px 24px;
            background: var(--color-accent);
            border: none;
            border-radius: 12px;
            color: #000;
            font-family: var(--font-body);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s var(--ease-out), box-shadow 0.2s var(--ease-out);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(34, 211, 238, 0.3);
        }

        .btn-danger {
            padding: 16px 24px;
            background: transparent;
            border: 1px solid var(--color-error);
            border-radius: 12px;
            color: var(--color-error);
            font-family: var(--font-body);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn-danger:hover {
            background: rgba(248, 113, 113, 0.1);
        }

        .btn-danger-outline {
            width: 100%;
            padding: 14px 24px;
            background: transparent;
            border: 1px solid var(--color-warning);
            border-radius: 12px;
            color: var(--color-warning);
            font-family: var(--font-body);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn-danger-outline:hover {
            background: rgba(251, 191, 36, 0.1);
        }

        .error-message,
        .success-message {
            border-radius: 8px;
            padding: 12px 16px;
            font-size: 0.9rem;
            margin-bottom: 20px;
            display: none;
        }

        .error-message {
            background: rgba(248, 113, 113, 0.1);
            border: 1px solid rgba(248, 113, 113, 0.3);
            color: var(--color-error);
        }

        .success-message {
            background: rgba(74, 222, 128, 0.1);
            border: 1px solid rgba(74, 222, 128, 0.3);
            color: var(--color-success);
        }

        .error-message.show,
        .success-message.show {
            display: block;
        }

        /* Delete Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 16px;
            padding: 32px;
            max-width: 440px;
            width: 100%;
        }

        .modal h2 {
            font-family: var(--font-display);
            font-size: 1.5rem;
            font-weight: 400;
            margin-bottom: 12px;
        }

        .modal p {
            color: var(--color-text-secondary);
            font-size: 0.95rem;
            line-height: 1.6;
            margin-bottom: 24px;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
        }

        .modal-btn {
            flex: 1;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            border: none;
        }

        .modal-btn.secondary {
            background: var(--color-surface-elevated);
            color: var(--color-text);
            border: 1px solid var(--color-border);
        }

        .modal-btn.danger {
            background: var(--color-error);
            color: white;
        }

        .modal-btn.warning {
            background: var(--color-warning);
            color: #000;
        }

        @media (max-width: 640px) {
            .comp-grid {
                grid-template-columns: 1fr;
            }

            .button-group {
                flex-direction: column;
            }
        }

        /* HEADER */
        header {
            padding: 24px 0;
            border-bottom: 1px solid var(--color-border);
            margin-bottom: 32px;
        }

        header .header-container {
            max-width: 640px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .logo {
            font-family: var(--font-display);
            font-size: 1.5rem;
            color: var(--color-text);
            text-decoration: none;
        }

        .logo em {
            font-style: italic;
            color: var(--color-accent);
        }

        .header-nav {
            display: flex;
            gap: 24px;
            align-items: center;
        }

        .nav-link {
            color: var(--color-text-secondary);
            text-decoration: none;
            font-size: 0.9rem;
            transition: color 0.2s ease;
        }

        .nav-link:hover {
            color: var(--color-accent);
        }
    </style>
    <link rel="stylesheet" href="css/mobile.css">
    <!-- Beta Access Gate -->
    <script>
        if (localStorage.getItem('beta_verified') !== 'true') {
            window.location.href = 'beta-access.html';
        }
    </script>
</head>
<body>
    <!-- HEADER -->
    <header>
        <div class="header-container">
            <a href="index.html" class="logo"><em>Henry</em>HQ</a>
        </div>
    </header>

    <div class="container">
        <a href="analyze.html" class="back-link" id="backLink" style="display: none;">‚Üê Back</a>

        <h1 id="pageTitle">Set Up Your Profile</h1>
        <p class="subtitle" id="pageSubtitle">Tell me about yourself so I can give you better advice.</p>

        <div class="error-message" id="errorMessage"></div>
        <div class="success-message" id="successMessage"></div>

        <!-- SECTION 1: RESUME -->
        <div class="form-section">
            <div class="section-title">
                <span class="icon">üìÑ</span>
                Your Resume
            </div>
            <p class="section-hint">Upload once, use for every job. I'll pull out the details so you don't have to re-enter anything.</p>
            <div class="form-group">
                <div class="resume-info" id="resumeInfo" style="display: none;">
                    <div class="resume-info-header">
                        <span class="resume-info-name" id="resumeName">Loading...</span>
                    </div>
                    <div class="resume-info-meta" id="resumeMeta"></div>
                    <a href="resume-discuss.html" class="resume-chat-link">üí¨ Chat with Henry about your resume</a>
                </div>
                <label class="file-upload" id="fileUpload">
                    <input type="file" id="resumeFile" accept=".pdf,.docx,.doc,.txt">
                    <div class="upload-icon">üìé</div>
                    <div class="upload-text">Drop your resume here or <span>browse</span></div>
                    <div class="file-name" id="fileName"></div>
                </label>
                <div class="parsing-status" id="parsingStatus"></div>
            </div>
        </div>

        <!-- SECTION 2: COMPENSATION -->
        <div class="form-section">
            <div class="section-title">
                <span class="icon">üí∞</span>
                Compensation Expectations
            </div>
            <div class="form-group">
                <label>What are you looking for? <span class="label-hint">(annual base salary, USD)</span></label>
                <div class="comp-grid">
                    <div>
                        <label>Minimum</label>
                        <input type="text" id="compMin" placeholder="$120,000" inputmode="numeric">
                    </div>
                    <div>
                        <label>Target</label>
                        <input type="text" id="compTarget" placeholder="$150,000" inputmode="numeric">
                    </div>
                    <div>
                        <label>Stretch</label>
                        <input type="text" id="compStretch" placeholder="$180,000" inputmode="numeric">
                    </div>
                </div>
            </div>
        </div>

        <!-- SECTION 3: WORK ARRANGEMENT -->
        <div class="form-section">
            <div class="section-title">
                <span class="icon">üè†</span>
                Work Arrangement
            </div>
            <p class="section-hint">What setups work for you? Select all that apply.</p>
            <div class="form-group">
                <div class="checkbox-group" id="workArrangementGroup">
                    <div class="checkbox-option" data-value="remote">
                        <span class="checkbox-box"></span>
                        <span>Remote</span>
                    </div>
                    <div class="checkbox-option" data-value="hybrid">
                        <span class="checkbox-box"></span>
                        <span>Hybrid</span>
                    </div>
                    <div class="checkbox-option" data-value="onsite">
                        <span class="checkbox-box"></span>
                        <span>On-site</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- SECTION 4: LOCATION -->
        <div class="form-section">
            <div class="section-title">
                <span class="icon">üìç</span>
                Location
            </div>
            <div class="form-group">
                <label>Where are you based?</label>
                <input type="text" id="currentLocation" placeholder="e.g., New York, NY">
            </div>
            <div class="form-group">
                <label>Open to relocating?</label>
                <div class="radio-group" id="relocateGroup">
                    <label class="radio-option" data-value="yes">
                        <input type="radio" name="relocate" value="yes">
                        <span class="radio-circle"></span>
                        <span class="radio-label">Yes</span>
                    </label>
                    <label class="radio-option" data-value="maybe">
                        <input type="radio" name="relocate" value="maybe">
                        <span class="radio-circle"></span>
                        <span class="radio-label">Maybe, for the right role</span>
                    </label>
                    <label class="radio-option" data-value="no">
                        <input type="radio" name="relocate" value="no">
                        <span class="radio-circle"></span>
                        <span class="radio-label">No</span>
                    </label>
                </div>
            </div>
            <div class="form-group" id="relocateLocationsGroup" style="display: none;">
                <label>Where would you consider?</label>
                <div class="add-location">
                    <input type="text" id="relocateLocationInput" placeholder="e.g., Austin, Seattle, Denver">
                    <button type="button" id="addRelocateLocationBtn">Add</button>
                </div>
                <div class="location-tags" id="relocateLocationTags"></div>
            </div>
        </div>

        <!-- SECTION 5: ABOUT YOU -->
        <div class="form-section">
            <div class="section-title">
                <span class="icon">üë§</span>
                About You
            </div>
            <div class="form-group">
                <label>Pronouns (optional, for personalized messaging)</label>
                <input type="text" id="pronouns" placeholder="e.g., she/her, he/him, they/them">
            </div>
        </div>

        <!-- SECTION 5.5: LINKEDIN PROFILE -->
        <div class="form-section linkedin-profile-section">
            <div class="section-title">
                <span class="icon">üíº</span>
                LinkedIn Profile
            </div>
            <div id="linkedin-profile-status">
                <!-- Populated dynamically by linkedin-upload.js -->
            </div>
        </div>

        <!-- SECTION 6: WHERE YOU'RE AT -->
        <div class="form-section">
            <div class="section-title">
                <span class="icon">üí≠</span>
                Where you're at
            </div>
            <p class="section-hint">Job searching is hard. Be honest so I can calibrate my advice to your actual situation.</p>
            
            <div class="form-group">
                <label>How are you holding up?</label>
                <select id="holdingUp">
                    <option value="">Select one...</option>
                    <option value="doing_well">I'm good, exploring opportunistically</option>
                    <option value="stressed_but_managing">Stressed but managing</option>
                    <option value="struggling">Struggling, honestly</option>
                    <option value="rather_not_say">I'd rather not say</option>
                </select>
                <div class="henry-response" id="holdingUpResponse"></div>
            </div>

            <div class="form-group">
                <label>What's your timeline?</label>
                <select id="timeline">
                    <option value="">Select one...</option>
                    <option value="no_rush">No rush, waiting for the right thing</option>
                    <option value="actively_looking">Actively looking (1-3 months)</option>
                    <option value="soon">Need something soon (under a month)</option>
                    <option value="urgent">Urgent, financial pressure</option>
                </select>
                <div class="henry-response" id="timelineResponse"></div>
            </div>

            <div class="form-group">
                <label>How's your confidence right now?</label>
                <select id="confidence">
                    <option value="">Select one...</option>
                    <option value="strong">Feeling strong, I know what I bring</option>
                    <option value="shaky">A bit shaky after some rejections</option>
                    <option value="low">Pretty low, hard to stay motivated</option>
                    <option value="need_validation">I just need reassurance that I'm on the right track</option>
                </select>
                <div class="henry-response" id="confidenceResponse"></div>
            </div>
        </div>

        <div class="button-group">
            <button class="btn-primary" id="saveBtn">Save and Start My Job Search</button>
        </div>

    </div>

    <!-- Account Options - fixed bottom left, only shown in edit mode -->
    <div id="dangerZone" style="display: none; position: fixed; bottom: 24px; left: 24px; opacity: 0.5;">
        <div style="display: flex; flex-direction: column; gap: 4px; align-items: flex-start;">
            <button id="resetProfileBtn" style="background: transparent; border: none; color: var(--color-text-muted); font-size: 0.75rem; cursor: pointer; padding: 4px 0;">Reset Profile</button>
            <button id="deleteAccountBtn" style="background: transparent; border: none; color: var(--color-text-muted); font-size: 0.75rem; cursor: pointer; padding: 4px 0;">Delete Account</button>
        </div>
    </div>

    <!-- Reset Profile Confirmation Modal -->
    <div class="modal-overlay" id="resetModal">
        <div class="modal">
            <h2>Reset your profile?</h2>
            <p>This will delete your profile data and all tracked applications. Your account will remain active and you can set up a new profile.</p>
            <div class="form-group" style="margin: 20px 0;">
                <label style="font-size: 0.9rem; color: var(--color-text-secondary);">Type <strong style="color: var(--color-warning);">RESET</strong> to confirm:</label>
                <input type="text" id="resetConfirmInput" placeholder="Type RESET" autocomplete="off" style="margin-top: 8px;">
            </div>
            <div class="modal-actions">
                <button class="modal-btn secondary" id="cancelResetBtn">Cancel</button>
                <button class="modal-btn warning" id="confirmResetBtn" disabled>Reset Profile</button>
            </div>
        </div>
    </div>

    <!-- Delete Account Confirmation Modal - Step 1 -->
    <div class="modal-overlay" id="deleteModal">
        <div class="modal">
            <h2>Delete your account?</h2>
            <p>This will <strong>permanently</strong> delete your account and all associated data. This action cannot be undone.</p>
            <p style="margin-top: 12px; color: var(--color-error); font-size: 0.9rem;">Are you absolutely sure you want to proceed?</p>
            <div class="modal-actions">
                <button class="modal-btn secondary" id="cancelDeleteBtn">Cancel</button>
                <button class="modal-btn danger" id="proceedDeleteBtn">Yes, Delete My Account</button>
            </div>
        </div>
    </div>

    <!-- Delete Account Confirmation Modal - Step 2 (Final) -->
    <div class="modal-overlay" id="deleteFinalModal">
        <div class="modal">
            <h2>Final Confirmation</h2>
            <p>This is your last chance to cancel. All your data will be permanently deleted.</p>
            <div class="form-group" style="margin: 20px 0;">
                <label style="font-size: 0.9rem; color: var(--color-text-secondary);">Type <strong style="color: var(--color-error);">DELETE MY ACCOUNT</strong> to confirm:</label>
                <input type="text" id="deleteConfirmInput" placeholder="Type DELETE MY ACCOUNT" autocomplete="off" style="margin-top: 8px;">
            </div>
            <div class="modal-actions">
                <button class="modal-btn secondary" id="cancelDeleteFinalBtn">Cancel</button>
                <button class="modal-btn danger" id="confirmDeleteBtn" disabled>Permanently Delete</button>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = window.location.hostname === 'localhost' ? 'http://localhost:8000' : 'https://henryai-app-production.up.railway.app';
        
        // State
        let profile = null;
        let relocateLocations = [];
        let workArrangements = [];

        // Elements
        const resumeInfo = document.getElementById('resumeInfo');
        const resumeName = document.getElementById('resumeName');
        const resumeMeta = document.getElementById('resumeMeta');
        const fileUpload = document.getElementById('fileUpload');
        const resumeFile = document.getElementById('resumeFile');
        const parsingStatus = document.getElementById('parsingStatus');
        const saveBtn = document.getElementById('saveBtn');
        const deleteBtn = document.getElementById('deleteBtn');
        const deleteModal = document.getElementById('deleteModal');
        const errorMessage = document.getElementById('errorMessage');
        const successMessage = document.getElementById('successMessage');

        // Determine if this is new profile or edit
        let isNewProfile = false;

        // Currency formatting helpers
        function formatCurrency(value) {
            if (!value && value !== 0) return '';
            const num = typeof value === 'string' ? parseInt(value.replace(/[^0-9]/g, '')) : value;
            if (isNaN(num)) return '';
            return '$' + num.toLocaleString('en-US');
        }

        function parseCurrency(formattedValue) {
            if (!formattedValue) return null;
            const num = parseInt(formattedValue.replace(/[^0-9]/g, ''));
            return isNaN(num) ? null : num;
        }

        // Set up currency input formatting
        function setupCurrencyInput(inputId) {
            const input = document.getElementById(inputId);
            input.addEventListener('input', function(e) {
                const cursorPos = e.target.selectionStart;
                const oldValue = e.target.value;
                const oldLength = oldValue.length;

                // Get raw number
                const rawNum = oldValue.replace(/[^0-9]/g, '');
                if (!rawNum) {
                    e.target.value = '';
                    return;
                }

                // Format with $ and commas
                const formatted = formatCurrency(rawNum);
                e.target.value = formatted;

                // Adjust cursor position
                const newLength = formatted.length;
                const diff = newLength - oldLength;
                const newPos = Math.max(1, cursorPos + diff); // Keep cursor after $
                e.target.setSelectionRange(newPos, newPos);
            });

            // Format on blur if just a number was entered
            input.addEventListener('blur', function(e) {
                if (e.target.value && !e.target.value.startsWith('$')) {
                    e.target.value = formatCurrency(e.target.value);
                }
            });
        }

        // Initialize currency inputs
        setupCurrencyInput('compMin');
        setupCurrencyInput('compTarget');
        setupCurrencyInput('compStretch');

        // Load existing profile - tries Supabase first, then localStorage
        async function loadProfile() {
            let profileData = null;

            // Try Supabase first if available
            if (typeof HenryData !== 'undefined') {
                try {
                    profileData = await HenryData.getCandidateProfile();
                    if (profileData) {
                        console.log('Loaded profile from Supabase');
                    }
                } catch (e) {
                    console.error('Error loading from Supabase:', e);
                }
            }

            // Fall back to localStorage if no Supabase data
            if (!profileData) {
                const stored = localStorage.getItem('userProfile');
                if (stored) {
                    try {
                        profileData = JSON.parse(stored);
                        console.log('Loaded profile from localStorage');
                    } catch (e) {
                        console.error('Failed to parse localStorage profile:', e);
                    }
                }
            }

            if (!profileData) {
                // New profile mode
                isNewProfile = true;
                setupNewProfileMode();
                return;
            }

            profile = profileData;
            setupEditMode();
            populateForm();
        }

        function setupNewProfileMode() {
            document.getElementById('pageTitle').textContent = 'Set Up Your Profile';
            document.getElementById('pageSubtitle').textContent = 'Tell me about yourself so I can give you better advice.';
            document.getElementById('backLink').style.display = 'none';
            document.getElementById('deleteBtn').style.display = 'none';
            document.getElementById('saveBtn').textContent = 'Save and Start My Job Search';
            // Show file upload, hide resume info
            document.getElementById('fileUpload').style.display = 'block';
            document.getElementById('resumeInfo').style.display = 'none';
        }

        function setupEditMode() {
            document.getElementById('pageTitle').textContent = 'Edit Your Profile';
            document.getElementById('pageSubtitle').textContent = 'Update your preferences anytime.';
            document.getElementById('backLink').style.display = 'block';
            document.getElementById('dangerZone').style.display = 'block';
            document.getElementById('saveBtn').textContent = 'Save Changes';
            // Show resume info, hide file upload
            document.getElementById('fileUpload').style.display = 'none';
            document.getElementById('resumeInfo').style.display = 'block';
        }

        function populateForm() {
            // Resume info
            if (profile.resume) {
                const name = profile.resume.contact?.full_name || profile.resume.full_name || 'Unknown';
                resumeName.textContent = name;
                const expCount = profile.resume.experience?.length || 0;
                const skillCount = profile.resume.skills?.length || 0;
                resumeMeta.textContent = `${expCount} roles ¬∑ ${skillCount} skills`;
            }

            // Compensation (format as currency)
            if (profile.compensation) {
                document.getElementById('compMin').value = formatCurrency(profile.compensation.min);
                document.getElementById('compTarget').value = formatCurrency(profile.compensation.target);
                document.getElementById('compStretch').value = formatCurrency(profile.compensation.stretch);
            }

            // Work arrangement
            if (profile.work_arrangement) {
                workArrangements = profile.work_arrangement;
                workArrangements.forEach(value => {
                    const option = document.querySelector(`.checkbox-option[data-value="${value}"]`);
                    if (option) {
                        option.classList.add('selected');
                    }
                });
            }

            // Location
            if (profile.location) {
                document.getElementById('currentLocation').value = profile.location.current || '';
                
                if (profile.location.open_to_relocate) {
                    const option = document.querySelector(`#relocateGroup .radio-option[data-value="${profile.location.open_to_relocate}"]`);
                    if (option) {
                        option.classList.add('selected');
                        option.querySelector('input').checked = true;
                        // Show relocate locations if yes or maybe
                        if (profile.location.open_to_relocate === 'yes' || profile.location.open_to_relocate === 'maybe') {
                            document.getElementById('relocateLocationsGroup').style.display = 'block';
                        }
                    }
                }
                
                relocateLocations = profile.location.relocate_to || [];
                renderRelocateLocations();
            }

            // Pronouns
            document.getElementById('pronouns').value = profile.pronouns || '';

            // Situation (dropdown-based)
            if (profile.situation) {
                if (profile.situation.holding_up) {
                    document.getElementById('holdingUp').value = profile.situation.holding_up;
                    showHenryResponse('holdingUp', profile.situation.holding_up);
                }
                if (profile.situation.timeline) {
                    document.getElementById('timeline').value = profile.situation.timeline;
                    showHenryResponse('timeline', profile.situation.timeline);
                }
                if (profile.situation.confidence) {
                    document.getElementById('confidence').value = profile.situation.confidence;
                    showHenryResponse('confidence', profile.situation.confidence);
                }
            }
        }

        // Henry's responses to each selection - real talk, not corporate comfort
        const henryResponses = {
            holdingUp: {
                doing_well: "Good. That's leverage. Let's use it.",
                stressed_but_managing: "Yeah, this market's rough. Let's be strategic so you're not just spraying applications.",
                struggling: "Appreciate the honesty. This market is brutal and it's not just you. Let's focus on what we can control.",
                rather_not_say: "Fair enough. Let's just get to work."
            },
            timeline: {
                no_rush: "That's the best position to be in. We can be picky.",
                actively_looking: "Solid timeline. Enough runway to be strategic, not desperate.",
                soon: "Okay, we need to move. I'll flag roles with faster hiring cycles.",
                urgent: "Got it. We'll prioritize volume and speed, but I'm not going to let you take something terrible just because it's fast."
            },
            confidence: {
                strong: "Good. You'll need that energy. Let's find roles that deserve it.",
                shaky: "Rejections hit different when you actually want the job. That's normal. Let's get some momentum going.",
                low: "Look, I've seen thousands of candidates. The ones who feel worst about themselves are rarely the ones who should. This market breaks people. It's not you.",
                need_validation: "You're not off-base. Ghost jobs are real. Companies ghost candidates constantly. The process is broken, not you."
            }
        };

        function showHenryResponse(field, value) {
            const responseEl = document.getElementById(field + 'Response');
            if (responseEl && henryResponses[field] && henryResponses[field][value]) {
                responseEl.textContent = henryResponses[field][value];
                responseEl.classList.add('show');
            } else if (responseEl) {
                responseEl.classList.remove('show');
            }
        }

        // File upload handler (works for both new and edit)
        resumeFile.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            // Show file name
            const fileNameEl = document.getElementById('fileName');
            fileNameEl.textContent = `üìé ${file.name}`;
            fileNameEl.classList.add('show');
            fileUpload.classList.add('has-file');

            parsingStatus.textContent = 'Parsing resume...';
            parsingStatus.className = 'parsing-status show';

            try {
                const formData = new FormData();
                formData.append('file', file);

                const response = await fetch(`${API_BASE}/api/resume/parse`, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) throw new Error('Failed to parse resume');

                const parsedResume = await response.json();
                
                // Initialize profile if new
                if (!profile) {
                    profile = {};
                }
                profile.resume = parsedResume;
                
                const name = parsedResume.contact?.full_name || parsedResume.full_name || 'Unknown';
                const firstName = name.split(' ')[0];
                parsingStatus.textContent = `‚úì Got it, ${firstName}!`;
                parsingStatus.className = 'parsing-status show success';
                
                // Update display for edit mode
                resumeName.textContent = name;
                const expCount = parsedResume.experience?.length || 0;
                const skillCount = parsedResume.skills?.length || 0;
                resumeMeta.textContent = `${expCount} roles ¬∑ ${skillCount} skills`;

                // In edit mode, switch back to info view
                if (!isNewProfile) {
                    fileUpload.style.display = 'none';
                    resumeInfo.style.display = 'block';
                }

            } catch (error) {
                console.error('Parse error:', error);
                parsingStatus.textContent = '‚úó Failed to parse resume. Try another format?';
                parsingStatus.className = 'parsing-status show error';
            }
        });

        // Dropdown change listeners for Henry responses
        ['holdingUp', 'timeline', 'confidence'].forEach(field => {
            const select = document.getElementById(field);
            if (select) {
                select.addEventListener('change', (e) => {
                    showHenryResponse(field, e.target.value);
                });
            }
        });

        // Radio/Checkbox handlers
        document.querySelectorAll('.radio-group').forEach(group => {
            group.querySelectorAll('.radio-option').forEach(option => {
                option.addEventListener('click', () => {
                    // Deselect all in group
                    group.querySelectorAll('.radio-option').forEach(o => o.classList.remove('selected'));
                    // Select this one
                    option.classList.add('selected');
                    option.querySelector('input').checked = true;

                    // Show/hide relocate locations based on answer
                    if (group.id === 'relocateGroup') {
                        const value = option.dataset.value;
                        const relocateLocationsGroup = document.getElementById('relocateLocationsGroup');
                        relocateLocationsGroup.style.display = (value === 'yes' || value === 'maybe') ? 'block' : 'none';
                    }
                });
            });
        });

        document.querySelectorAll('.checkbox-option').forEach(option => {
            option.addEventListener('click', (e) => {
                e.preventDefault();
                option.classList.toggle('selected');
                
                // Update workArrangements array
                workArrangements = Array.from(document.querySelectorAll('.checkbox-option.selected'))
                    .map(o => o.dataset.value);
            });
        });

        // Relocate location handling
        const relocateLocationInput = document.getElementById('relocateLocationInput');
        const addRelocateLocationBtn = document.getElementById('addRelocateLocationBtn');
        const relocateLocationTags = document.getElementById('relocateLocationTags');

        addRelocateLocationBtn.addEventListener('click', () => {
            const location = relocateLocationInput.value.trim();
            if (location && !relocateLocations.includes(location)) {
                relocateLocations.push(location);
                renderRelocateLocations();
                relocateLocationInput.value = '';
            }
        });

        relocateLocationInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                addRelocateLocationBtn.click();
            }
        });

        function renderRelocateLocations() {
            relocateLocationTags.innerHTML = relocateLocations.map((loc, index) => `
                <span class="location-tag">
                    ${loc}
                    <button type="button" onclick="removeRelocateLocation(${index})">√ó</button>
                </span>
            `).join('');
        }

        function removeRelocateLocation(index) {
            relocateLocations.splice(index, 1);
            renderRelocateLocations();
        }
        window.removeRelocateLocation = removeRelocateLocation;

        // Helper function for radio groups (relocate still uses radio)
        function getSelectedRadioValue(groupId) {
            const selected = document.querySelector(`#${groupId} .radio-option.selected`);
            return selected ? selected.dataset.value : null;
        }

        // Save changes
        saveBtn.addEventListener('click', async () => {
            // Clear previous errors
            errorMessage.classList.remove('show');

            // Validate required fields for new profile
            if (isNewProfile) {
                if (!profile || !profile.resume) {
                    errorMessage.textContent = 'Please upload your resume first.';
                    errorMessage.classList.add('show');
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                    return;
                }
                if (!document.getElementById('timeline').value) {
                    errorMessage.textContent = 'Please select your timeline.';
                    errorMessage.classList.add('show');
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                    return;
                }
            }

            try {
                if (!profile) profile = {};

                profile.compensation = {
                    min: parseCurrency(document.getElementById('compMin').value),
                    target: parseCurrency(document.getElementById('compTarget').value),
                    stretch: parseCurrency(document.getElementById('compStretch').value)
                };

                profile.work_arrangement = workArrangements;

                profile.location = {
                    current: document.getElementById('currentLocation').value.trim(),
                    open_to_relocate: getSelectedRadioValue('relocateGroup'),
                    relocate_to: relocateLocations
                };

                profile.pronouns = document.getElementById('pronouns').value.trim() || null;

                profile.situation = {
                    holding_up: document.getElementById('holdingUp').value || null,
                    timeline: document.getElementById('timeline').value || null,
                    confidence: document.getElementById('confidence').value || null
                };

                if (isNewProfile) {
                    profile.created_at = new Date().toISOString();
                }
                profile.updated_at = new Date().toISOString();

                // Save to localStorage as fallback
                localStorage.setItem('userProfile', JSON.stringify(profile));

                // Save to Supabase if available
                if (typeof HenryData !== 'undefined') {
                    const { error } = await HenryData.saveCandidateProfile(profile);
                    if (error) {
                        console.error('Error saving to Supabase:', error);
                    } else {
                        console.log('Profile saved to Supabase');
                    }
                }

                // Initialize tracker if new
                if (!localStorage.getItem('trackedApplications')) {
                    localStorage.setItem('trackedApplications', JSON.stringify([]));
                }

                // Always redirect to analyze page after save
                window.location.href = 'analyze.html';

            } catch (error) {
                console.error('Save error:', error);
                errorMessage.textContent = 'Failed to save changes: ' + error.message;
                errorMessage.classList.add('show');
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        });

        // Reset Profile handlers
        const resetModal = document.getElementById('resetModal');
        const resetConfirmInput = document.getElementById('resetConfirmInput');
        const confirmResetBtn = document.getElementById('confirmResetBtn');

        document.getElementById('resetProfileBtn').addEventListener('click', () => {
            resetConfirmInput.value = '';
            confirmResetBtn.disabled = true;
            resetModal.classList.add('show');
            resetConfirmInput.focus();
        });

        // Enable reset button only when user types "RESET"
        resetConfirmInput.addEventListener('input', () => {
            confirmResetBtn.disabled = resetConfirmInput.value.trim().toUpperCase() !== 'RESET';
        });

        document.getElementById('cancelResetBtn').addEventListener('click', () => {
            resetModal.classList.remove('show');
            resetConfirmInput.value = '';
        });

        document.getElementById('confirmResetBtn').addEventListener('click', async () => {
            if (resetConfirmInput.value.trim().toUpperCase() !== 'RESET') return;

            try {
                // Clear Supabase data if available
                if (typeof HenryData !== 'undefined') {
                    const session = await HenryAuth.getSession();
                    if (session) {
                        // Delete all applications
                        await HenryData.deleteAllApplications();
                        // Delete candidate profile
                        await HenryData.deleteCandidateProfile();
                        console.log('Cleared Supabase data');
                    }
                }

                // Clear localStorage
                localStorage.removeItem('userProfile');
                localStorage.removeItem('trackedApplications');
                localStorage.removeItem('upcomingInterviews');
                localStorage.removeItem('completedInterviews');
                localStorage.removeItem('resumeConversation');
                localStorage.removeItem('celebratedMilestones');
                localStorage.removeItem('interventionState');
                // Clear analysis_ and documents_ prefixed items
                for (let i = localStorage.length - 1; i >= 0; i--) {
                    const key = localStorage.key(i);
                    if (key && (key.startsWith('analysis_') || key.startsWith('documents_'))) {
                        localStorage.removeItem(key);
                    }
                }
                sessionStorage.clear();

                // Mark as needing onboarding and redirect
                localStorage.setItem('henryai_needs_onboarding', 'true');
                window.location.href = 'profile-edit.html';
            } catch (error) {
                console.error('Reset error:', error);
                errorMessage.textContent = 'Failed to reset profile: ' + error.message;
                errorMessage.classList.add('show');
                resetModal.classList.remove('show');
            }
        });

        resetModal.addEventListener('click', (e) => {
            if (e.target === resetModal) {
                resetModal.classList.remove('show');
                resetConfirmInput.value = '';
            }
        });

        // Delete Account handlers - Two-step confirmation
        const deleteFinalModal = document.getElementById('deleteFinalModal');
        const deleteConfirmInput = document.getElementById('deleteConfirmInput');
        const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');

        document.getElementById('deleteAccountBtn').addEventListener('click', () => {
            deleteModal.classList.add('show');
        });

        document.getElementById('cancelDeleteBtn').addEventListener('click', () => {
            deleteModal.classList.remove('show');
        });

        // Step 1: User clicks "Yes, Delete My Account" -> Show final confirmation
        document.getElementById('proceedDeleteBtn').addEventListener('click', () => {
            deleteModal.classList.remove('show');
            deleteConfirmInput.value = '';
            confirmDeleteBtn.disabled = true;
            deleteFinalModal.classList.add('show');
            deleteConfirmInput.focus();
        });

        // Enable delete button only when user types "DELETE MY ACCOUNT"
        deleteConfirmInput.addEventListener('input', () => {
            confirmDeleteBtn.disabled = deleteConfirmInput.value.trim().toUpperCase() !== 'DELETE MY ACCOUNT';
        });

        document.getElementById('cancelDeleteFinalBtn').addEventListener('click', () => {
            deleteFinalModal.classList.remove('show');
            deleteConfirmInput.value = '';
        });

        // Step 2: Final deletion
        document.getElementById('confirmDeleteBtn').addEventListener('click', async () => {
            if (deleteConfirmInput.value.trim().toUpperCase() !== 'DELETE MY ACCOUNT') return;

            try {
                // Clear Supabase data if available
                if (typeof HenryData !== 'undefined' && typeof HenryAuth !== 'undefined') {
                    const session = await HenryAuth.getSession();
                    if (session) {
                        // Delete all applications
                        await HenryData.deleteAllApplications();
                        // Delete candidate profile
                        await HenryData.deleteCandidateProfile();
                        // Sign out and delete user (note: full account deletion requires admin API)
                        await HenryAuth.signOut();
                        console.log('Signed out and cleared Supabase data');
                    }
                }

                // Clear all localStorage
                localStorage.clear();
                sessionStorage.clear();

                // Redirect to landing page
                window.location.href = 'index.html';
            } catch (error) {
                console.error('Delete account error:', error);
                errorMessage.textContent = 'Failed to delete account: ' + error.message;
                errorMessage.classList.add('show');
                deleteFinalModal.classList.remove('show');
            }
        });

        // Close modals on overlay click
        deleteModal.addEventListener('click', (e) => {
            if (e.target === deleteModal) {
                deleteModal.classList.remove('show');
            }
        });

        deleteFinalModal.addEventListener('click', (e) => {
            if (e.target === deleteFinalModal) {
                deleteFinalModal.classList.remove('show');
                deleteConfirmInput.value = '';
            }
        });

        // Initialize will be called after Supabase is loaded
    </script>

    <!-- Auth scripts - must load before initialization -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/supabase-client.js"></script>
    <script>
        // Initialize after Supabase is available
        (async function() {
            // Check authentication
            if (typeof HenryAuth !== 'undefined') {
                const session = await HenryAuth.getSession();
                if (!session) {
                    // Not logged in, redirect to login
                    window.location.href = 'login.html';
                    return;
                }
            }

            // Now load the profile
            await loadProfile();
        })();
    </script>
    <script src="components/ask-henry.js"></script>
    <script src="components/strategy-nav.js"></script>
    <script src="components/status-banner.js"></script>

    <!-- LinkedIn Upload Feature -->
    <link rel="stylesheet" href="css/linkedin.css">
    <script src="js/linkedin-upload.js"></script>
    <script>
        // Initialize LinkedIn section on profile page
        document.addEventListener('DOMContentLoaded', () => {
            if (window.linkedInUpload) {
                window.linkedInUpload.renderProfileSection('linkedin-profile-status');
            }
        });
    </script>
</body>
</html>
