<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Application Tracker | HenryAI</title>
    <style>
        :root {
            --color-bg: #0a0a0a;
            --color-surface: #161616;
            --color-surface-hover: #1e1e1e;
            --color-border: #2a2a2a;
            --color-text: #f5f5f5;
            --color-text-secondary: #888;
            --color-accent: #4ade80;
            --color-accent-muted: rgba(74, 222, 128, 0.1);
            --color-warning: #fbbf24;
            --color-warning-muted: rgba(251, 191, 36, 0.1);
            --color-danger: #ef4444;
            --color-danger-muted: rgba(239, 68, 68, 0.1);
            --color-info: #60a5fa;
            --color-info-muted: rgba(96, 165, 250, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--color-bg);
            color: var(--color-text);
            min-height: 100vh;
            padding: 40px 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .back-link {
            color: var(--color-text-secondary);
            text-decoration: none;
            font-size: 0.9rem;
            display: inline-block;
            margin-bottom: 24px;
        }

        .back-link:hover {
            color: var(--color-accent);
        }

        h1 {
            font-size: 2rem;
            font-weight: 300;
            margin-bottom: 8px;
        }

        /* Personalized Intro */
        .intro-box {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 32px;
            line-height: 1.7;
        }

        .intro-box p {
            color: var(--color-text-secondary);
            font-size: 0.95rem;
        }

        .intro-box p:first-child {
            color: var(--color-text);
        }

        /* Stats Bar */
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-item {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--color-accent);
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--color-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 4px;
        }

        /* Filters */
        .filters-bar {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-label {
            font-size: 0.85rem;
            color: var(--color-text-secondary);
        }

        .filter-select {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            color: var(--color-text);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.85rem;
            cursor: pointer;
        }

        .filter-select:hover {
            border-color: var(--color-text-secondary);
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--color-accent);
        }

        .sort-toggle {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            color: var(--color-text-secondary);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.85rem;
            cursor: pointer;
            margin-left: auto;
        }

        .sort-toggle:hover {
            color: var(--color-text);
            border-color: var(--color-text-secondary);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 80px 20px;
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 16px;
        }

        .empty-state h2 {
            font-size: 1.25rem;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .empty-state p {
            color: var(--color-text-secondary);
            margin-bottom: 24px;
        }

        .empty-state a {
            display: inline-block;
            background: var(--color-accent);
            color: #000;
            padding: 12px 24px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 500;
        }

        /* Application Cards */
        .applications-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .app-card {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 16px;
            padding: 24px;
            transition: border-color 0.2s;
        }

        .app-card:hover {
            border-color: var(--color-text-secondary);
        }

        .app-card.inactive {
            opacity: 0.6;
        }

        .app-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .app-card-title {
            flex: 1;
        }

        .app-card-title h3 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .app-card-title .company {
            color: var(--color-text-secondary);
            font-size: 0.95rem;
        }

        .app-card-meta {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .fit-badge {
            font-size: 0.85rem;
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 6px;
        }

        .fit-high {
            background: var(--color-accent-muted);
            color: var(--color-accent);
        }

        .fit-medium {
            background: var(--color-warning-muted);
            color: var(--color-warning);
        }

        .fit-low {
            background: var(--color-danger-muted);
            color: var(--color-danger);
        }

        /* Status Selector */
        .status-selector {
            position: relative;
        }

        .status-btn {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            color: var(--color-text);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .status-btn:hover {
            background: var(--color-surface-hover);
        }

        .status-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 4px;
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            padding: 8px;
            z-index: 100;
            min-width: 180px;
            display: none;
        }

        .status-dropdown.show {
            display: block;
        }

        .status-option {
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
        }

        .status-option:hover {
            background: var(--color-surface-hover);
        }

        /* Action Box - Clear visual hierarchy */
        .action-box {
            background: #1a1a2e;
            border: 1px solid #2d2d44;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .action-box.urgent {
            background: #2d2416;
            border-color: rgba(251, 191, 36, 0.4);
        }

        .action-box.dead {
            background: #2d1a1a;
            border-color: rgba(239, 68, 68, 0.4);
        }

        .action-box.positive {
            background: #1a2d1a;
            border-color: rgba(74, 222, 128, 0.4);
        }

        .action-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .action-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #8b8ba7;
            font-weight: 600;
        }

        .calendar-btn {
            padding: 6px 12px;
            background: rgba(96, 165, 250, 0.15);
            border: 1px solid rgba(96, 165, 250, 0.3);
            border-radius: 6px;
            color: #60a5fa;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }

        .calendar-btn:hover {
            background: rgba(96, 165, 250, 0.25);
            border-color: #60a5fa;
            transform: translateY(-1px);
        }

        .action-box.urgent .action-label {
            color: var(--color-warning);
        }

        .action-box.dead .action-label {
            color: var(--color-danger);
        }

        .action-box.positive .action-label {
            color: var(--color-accent);
        }

        .action-text {
            font-size: 0.95rem;
            line-height: 1.6;
            color: var(--color-text);
        }

        .action-item {
            display: block;
            margin-top: 12px;
            padding: 10px 14px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            font-weight: 500;
            color: var(--color-text);
        }

        .action-box.urgent .action-item {
            background: rgba(251, 191, 36, 0.15);
            color: var(--color-warning);
        }

        .action-box.positive .action-item {
            background: rgba(74, 222, 128, 0.15);
            color: var(--color-accent);
        }

        .action-box.dead .action-item {
            background: rgba(239, 68, 68, 0.1);
            color: var(--color-text-secondary);
        }

        /* History Timeline */
        .history-section {
            margin-bottom: 16px;
        }

        .history-toggle {
            color: var(--color-text-secondary);
            font-size: 0.85rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .history-toggle:hover {
            color: var(--color-text);
        }

        .history-content {
            display: none;
            margin-top: 12px;
            padding-left: 16px;
            border-left: 2px solid var(--color-border);
        }

        .history-content.show {
            display: block;
        }

        .history-item {
            padding: 8px 0;
            font-size: 0.85rem;
            color: var(--color-text-secondary);
        }

        .history-item .date {
            color: var(--color-text);
            font-weight: 500;
        }

        /* Notes */
        .notes-section {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--color-border);
        }

        .notes-toggle {
            color: var(--color-text-secondary);
            font-size: 0.85rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .notes-toggle:hover {
            color: var(--color-text);
        }

        .notes-content {
            display: none;
            margin-top: 12px;
        }

        .notes-content.show {
            display: block;
        }

        .notes-textarea {
            width: 100%;
            background: var(--color-bg);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            padding: 12px;
            color: var(--color-text);
            font-family: inherit;
            font-size: 0.9rem;
            resize: vertical;
            min-height: 80px;
        }

        .notes-textarea:focus {
            outline: none;
            border-color: var(--color-accent);
        }

        /* Card Actions */
        .card-actions {
            display: flex;
            gap: 12px;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--color-border);
            flex-wrap: wrap;
        }

        .card-action-btn {
            background: none;
            border: none;
            color: var(--color-text-secondary);
            font-size: 0.85rem;
            cursor: pointer;
            padding: 4px 0;
        }

        .card-action-btn:hover {
            color: var(--color-text);
        }

        .card-action-btn.danger:hover {
            color: var(--color-danger);
        }

        .card-action-btn.done {
            color: var(--color-accent);
            cursor: default;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 16px;
            padding: 32px;
            max-width: 500px;
            width: 100%;
        }

        .modal h2 {
            font-size: 1.25rem;
            margin-bottom: 16px;
        }

        .modal p {
            color: var(--color-text-secondary);
            margin-bottom: 24px;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .modal-btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
            border: none;
        }

        .modal-btn.secondary {
            background: var(--color-surface-hover);
            color: var(--color-text);
        }

        .modal-btn.danger {
            background: var(--color-danger);
            color: white;
        }

        /* Calendar Modal */
        .calendar-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .calendar-modal.show {
            opacity: 1;
        }

        .calendar-modal-content {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 16px;
            padding: 32px;
            max-width: 400px;
            width: 100%;
        }

        .calendar-modal-content h3 {
            font-size: 1.25rem;
            margin-bottom: 8px;
        }

        .calendar-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 16px;
        }

        .calendar-option-btn {
            padding: 14px 20px;
            background: rgba(96, 165, 250, 0.1);
            border: 1px solid rgba(96, 165, 250, 0.3);
            border-radius: 8px;
            color: #60a5fa;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
            text-align: left;
        }

        .calendar-option-btn:hover {
            background: rgba(96, 165, 250, 0.2);
            border-color: #60a5fa;
            transform: translateY(-2px);
        }

        .calendar-close-btn {
            width: 100%;
            padding: 10px 20px;
            background: var(--color-surface-hover);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            color: var(--color-text-secondary);
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .calendar-close-btn:hover {
            background: var(--color-surface);
            color: var(--color-text);
        }

        /* Comparison Insight */
        .comparison-insight {
            background: var(--color-accent-muted);
            border: 1px solid rgba(74, 222, 128, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 24px;
            display: none;
        }

        .comparison-insight.show {
            display: block;
        }

        .comparison-insight p {
            font-size: 0.95rem;
            line-height: 1.6;
        }

        /* Responsive */
        @media (max-width: 640px) {
            .stats-bar {
                grid-template-columns: repeat(2, 1fr);
            }

            .app-card-header {
                flex-direction: column;
                gap: 12px;
            }

            .app-card-meta {
                width: 100%;
                justify-content: space-between;
            }

            .filters-bar {
                flex-direction: column;
                align-items: stretch;
            }

            .sort-toggle {
                margin-left: 0;
            }
        }

        /* HEADER */
        header {
            padding: 24px 0;
            border-bottom: 1px solid var(--color-border);
            margin-bottom: 32px;
        }

        header .header-container {
            max-width: 960px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-family: 'Georgia', serif;
            font-size: 1.5rem;
            color: var(--color-text);
            text-decoration: none;
        }

        .logo em {
            font-style: italic;
            color: #22d3ee;
        }

        .header-nav {
            display: flex;
            gap: 24px;
            align-items: center;
        }

        .nav-link {
            color: var(--color-text-secondary);
            text-decoration: none;
            font-size: 0.9rem;
            transition: color 0.2s ease;
        }

        .nav-link:hover {
            color: var(--color-accent);
        }
    </style>
</head>
<body>
    <!-- HEADER -->
    <header>
        <div class="header-container">
            <a href="index.html" class="logo"><em>Henry</em>AI</a>
            <nav class="header-nav">
                <a href="index.html" class="nav-link">Analyze a Role</a>
                <a href="profile-edit.html" class="nav-link">Edit Profile</a>
            </nav>
        </div>
    </header>

    <div class="container">
        <a href="outreach.html" class="back-link">‚Üê Return to Network Intelligence & Strategic Outreach</a>

        <h1>Your Applications</h1>

        <!-- Personalized Intro -->
        <div class="intro-box" id="introBox">
            <p>This isn't another spreadsheet you'll abandon in two weeks.</p>
            <p style="margin-top: 12px;">Every role here comes with context: your fit score, what you emphasized, what gaps to address. When you update a status, I'll tell you exactly what to do next and when it's time to move on. No false hope, no busywork.</p>
        </div>

        <!-- Stats Bar -->
        <div class="stats-bar" id="statsBar">
            <div class="stat-item">
                <div class="stat-number" id="statTotal">0</div>
                <div class="stat-label">Total</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="statActive">0</div>
                <div class="stat-label">Active</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="statResponses">0</div>
                <div class="stat-label">Responses</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="statResponseRate">0%</div>
                <div class="stat-label">Response Rate</div>
            </div>
        </div>

        <!-- Filters -->
        <div class="filters-bar" id="filtersBar" style="display: none;">
            <span class="filter-label">Filter:</span>
            <select class="filter-select" id="filterStatus">
                <option value="all">All Statuses</option>
                <option value="active">Active Only</option>
                <option value="To Apply">To Apply</option>
                <option value="Applied">Applied</option>
                <option value="Reached Out">Reached Out</option>
                <option value="Response Received">Response Received</option>
                <option value="Interview Scheduled">Interview Scheduled</option>
                <option value="Interviewed">Interviewed</option>
                <option value="Offer Received">Offer Received</option>
                <option value="No Response">No Response</option>
                <option value="Rejected">Rejected</option>
            </select>
            <select class="filter-select" id="filterFit">
                <option value="all">All Fit Scores</option>
                <option value="high">75%+ (Strong)</option>
                <option value="medium">60-74% (Decent)</option>
                <option value="low">Below 60%</option>
            </select>
            <button class="sort-toggle" id="sortToggle">Sort: Newest ‚Üì</button>
        </div>

        <!-- Comparison Insight -->
        <div class="comparison-insight" id="comparisonInsight">
            <p id="comparisonText"></p>
        </div>

        <!-- Applications List -->
        <div id="applicationsContainer">
            <!-- Populated by JavaScript -->
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal-overlay" id="deleteModal">
        <div class="modal">
            <h2>Remove this application?</h2>
            <p>This will permanently remove this role from your tracker. You can always add it back later by analyzing the job again.</p>
            <div class="modal-actions">
                <button class="modal-btn secondary" onclick="closeDeleteModal()">Cancel</button>
                <button class="modal-btn danger" id="confirmDeleteBtn">Remove</button>
            </div>
        </div>
    </div>

    <script>
        // ========================================================================
        // APPLICATION STATUS DEFINITIONS
        // ========================================================================
        const STATUSES = {
            'To Apply': {
                label: 'To Apply',
                active: true,
                nextAction: (app) => {
                    const daysSinceAdded = getDaysSince(app.dateAdded);
                    if (daysSinceAdded > 3) {
                        return {
                            type: 'urgent',
                            context: `You added this ${daysSinceAdded} days ago but haven't applied. Roles get 300+ applicants in 48 hours.`,
                            action: `Apply today or remove it and focus elsewhere.`
                        };
                    }
                    return {
                        type: 'default',
                        context: `Best chances come from applying within 24 to 48 hours of posting.`,
                        action: `Submit your application, then update your status here.`
                    };
                }
            },
            'Applied': {
                label: 'Applied',
                active: true,
                nextAction: (app) => {
                    const daysSinceApplied = getDaysSince(app.dateApplied || app.dateAdded);
                    if (daysSinceApplied < 3) {
                        return {
                            type: 'default',
                            context: `Applied ${daysSinceApplied === 0 ? 'today' : daysSinceApplied + ' days ago'}. The ATS is a black hole. Direct outreach is how you get seen.`,
                            action: `Find the hiring manager on LinkedIn and send a personalized message. Use the outreach template from your download.`
                        };
                    } else if (daysSinceApplied < 7) {
                        return {
                            type: 'default',
                            context: `It has been ${daysSinceApplied} days since you applied.`,
                            action: `If you haven't reached out directly, now is the time. Find someone at the company on LinkedIn and send a personalized message.`
                        };
                    } else if (daysSinceApplied < 14) {
                        return {
                            type: 'urgent',
                            context: `${daysSinceApplied} days with no response.`,
                            action: `Send a follow-up: "Hi [Name], I applied for [Role] last week and wanted to reiterate my interest. Would love to connect if there is a fit."`
                        };
                    } else {
                        return {
                            type: 'dead',
                            context: `It has been ${daysSinceApplied} days. In this market, no response after 2 weeks usually means it is not moving forward.`,
                            action: `Send one final follow-up if you want, but mentally move on. Focus energy on newer opportunities.`
                        };
                    }
                }
            },
            'Reached Out': {
                label: 'Reached Out',
                active: true,
                nextAction: (app) => {
                    const daysSinceReached = getDaysSince(app.dateReachedOut || app.dateApplied || app.dateAdded);
                    if (daysSinceReached < 5) {
                        return {
                            type: 'default',
                            context: `Outreach sent ${daysSinceReached === 0 ? 'today' : daysSinceReached + ' days ago'}. Give them 3 to 5 business days to respond.`,
                            action: `Keep applying to other roles. Never wait on one opportunity.`
                        };
                    } else if (daysSinceReached < 10) {
                        return {
                            type: 'urgent',
                            context: `No response to your outreach after ${daysSinceReached} days.`,
                            action: `Send a brief follow-up: "Hi [Name], circling back on my note about the [Role] position. Still very interested. Let me know if there is a better time to connect."`
                        };
                    } else {
                        return {
                            type: 'dead',
                            context: `${daysSinceReached} days since outreach with no response. This one is likely cold.`,
                            action: `Mark it as "No Response" and redirect your energy. Not personal. Hiring managers are overwhelmed.`
                        };
                    }
                }
            },
            'Response Received': {
                label: 'Response Received',
                active: true,
                nextAction: (app) => {
                    return {
                        type: 'positive',
                        context: `Great news. You got a response. Speed signals interest.`,
                        action: `Respond within 24 hours. Be flexible on scheduling, prepare your "tell me about yourself" story, and research the interviewer on LinkedIn.`
                    };
                }
            },
            'Interview Scheduled': {
                label: 'Interview Scheduled',
                active: true,
                nextAction: (app) => {
                    return {
                        type: 'positive',
                        context: `Interview scheduled. Time to prepare.`,
                        action: `Research the company's recent news. Prepare 3 to 5 questions to ask. Practice your STAR stories for behavioral questions. Test your tech setup if it is virtual.`
                    };
                }
            },
            'Interviewed': {
                label: 'Interviewed',
                active: true,
                nextAction: (app) => {
                    const daysSinceInterview = getDaysSince(app.dateInterviewed || app.dateAdded);
                    if (daysSinceInterview < 1) {
                        return {
                            type: 'default',
                            context: `Interview complete. The follow-up matters.`,
                            action: `Send a thank-you email within 24 hours. Keep it brief: thank them for their time, reference one specific thing you discussed, reiterate your interest.`
                        };
                    } else if (daysSinceInterview < 7) {
                        return {
                            type: 'default',
                            context: `Thank-you sent. Now wait.`,
                            action: `If they gave you a timeline, respect it. If not, follow up after 5 to 7 business days if you have not heard back.`
                        };
                    } else {
                        return {
                            type: 'urgent',
                            context: `It has been ${daysSinceInterview} days since your interview.`,
                            action: `Send a follow-up: "Hi [Name], I wanted to check in on the timeline for [Role]. I remain very interested and happy to provide any additional information."`
                        };
                    }
                }
            },
            'Offer Received': {
                label: 'Offer Received',
                active: false,
                nextAction: (app) => {
                    return {
                        type: 'positive',
                        context: `Congratulations. Take 24 to 48 hours to review carefully. It is expected that you will take time.`,
                        action: `Research market rates. Consider the full package, not just salary. Prepare your negotiation points before responding.`
                    };
                }
            },
            'No Response': {
                label: 'No Response',
                active: false,
                nextAction: (app) => {
                    return {
                        type: 'dead',
                        context: `This one did not work out. That is the reality of this market. Even great candidates get ghosted.`,
                        action: `Archive it mentally and keep moving. Every silence gets you closer to the right opportunity.`
                    };
                }
            },
            'Rejected': {
                label: 'Rejected',
                active: false,
                nextAction: (app) => {
                    return {
                        type: 'dead',
                        context: `Rejection stings, but it is better than ghosting. At least you know.`,
                        action: `If they offered feedback, take it seriously. If not, do not read too much into it. The right role is still out there.`
                    };
                }
            },
            'Withdrawn': {
                label: 'Withdrawn',
                active: false,
                nextAction: (app) => {
                    return {
                        type: 'default',
                        context: `You withdrew from this one.`,
                        action: `Smart to know when a role is not right. Keep that clarity as you evaluate other opportunities.`
                    };
                }
            }
        };

        // ========================================================================
        // STATE
        // ========================================================================
        let currentFilter = 'all';
        let currentFitFilter = 'all';
        let sortNewestFirst = true;

        // ========================================================================
        // HELPER FUNCTIONS
        // ========================================================================
        function getDaysSince(dateString) {
            if (!dateString) return 0;
            const date = new Date(dateString);
            const now = new Date();
            const diffTime = Math.abs(now - date);
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            return diffDays;
        }

        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        }

        function formatDateTime(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', hour: 'numeric', minute: '2-digit' });
        }

        function getApplications() {
            return JSON.parse(localStorage.getItem('trackedApplications') || '[]');
        }

        function saveApplications(apps) {
            localStorage.setItem('trackedApplications', JSON.stringify(apps));
        }

        function parseSalary(salaryStr) {
            if (!salaryStr) return 0;
            const match = salaryStr.match(/\$?([\d,]+)/);
            if (match) {
                return parseInt(match[1].replace(/,/g, ''));
            }
            return 0;
        }

        // ========================================================================
        // FILTERING & SORTING
        // ========================================================================
        function filterApplications(apps) {
            return apps.filter(app => {
                // Status filter
                if (currentFilter === 'active') {
                    if (!STATUSES[app.status]?.active) return false;
                } else if (currentFilter !== 'all') {
                    if (app.status !== currentFilter) return false;
                }

                // Fit filter
                if (currentFitFilter === 'high' && app.fitScore < 75) return false;
                if (currentFitFilter === 'medium' && (app.fitScore < 60 || app.fitScore >= 75)) return false;
                if (currentFitFilter === 'low' && app.fitScore >= 60) return false;

                return true;
            });
        }

        function sortApplications(apps) {
            return [...apps].sort((a, b) => {
                // Always put active first
                const aActive = STATUSES[a.status]?.active ?? true;
                const bActive = STATUSES[b.status]?.active ?? true;
                if (aActive && !bActive) return -1;
                if (!aActive && bActive) return 1;

                // Then by date
                const dateA = new Date(a.dateAdded);
                const dateB = new Date(b.dateAdded);
                return sortNewestFirst ? dateB - dateA : dateA - dateB;
            });
        }

        // ========================================================================
        // COMPARISON INSIGHTS
        // ========================================================================
        function generateComparisonInsight(apps) {
            if (apps.length < 2) return null;

            const activeApps = apps.filter(a => STATUSES[a.status]?.active);
            if (activeApps.length < 2) return null;

            // Count by status
            const toApply = activeApps.filter(a => a.status === 'To Apply').length;
            const waiting = activeApps.filter(a => ['Applied', 'Reached Out'].includes(a.status)).length;
            const interviewing = activeApps.filter(a => ['Response Received', 'Interview Scheduled', 'Interviewed'].includes(a.status)).length;

            // Find highest fit
            const highestFit = activeApps.reduce((max, app) => app.fitScore > max.fitScore ? app : max, activeApps[0]);
            
            // Find highest salary
            const withSalary = activeApps.filter(a => a.salary && a.salary !== 'Not specified');
            let highestSalary = null;
            if (withSalary.length > 1) {
                highestSalary = withSalary.reduce((max, app) => parseSalary(app.salary) > parseSalary(max.salary) ? app : max, withSalary[0]);
            }

            // Generate insight
            if (interviewing > 0) {
                return `You have ${interviewing} role${interviewing > 1 ? 's' : ''} in the interview stage. Focus your energy there.${toApply > 0 ? ` The ${toApply} in "To Apply" can wait, or remove them to reduce noise.` : ''}`;
            } else if (waiting > 3 && toApply > 0) {
                return `You have ${waiting} applications waiting for responses and ${toApply} more to apply to. In this market, keep the pipeline moving. Apply to those ${toApply} roles today while you wait.`;
            } else if (highestFit && highestSalary && highestFit.id !== highestSalary.id && parseSalary(highestSalary.salary) > parseSalary(highestFit.salary || '0')) {
                return `Your strongest fit is ${highestFit.role} at ${highestFit.company} (${highestFit.fitScore}%), but ${highestSalary.role} at ${highestSalary.company} has the highest comp (${highestSalary.salary}). Worth considering which matters more for this search.`;
            }

            return null;
        }

        // ========================================================================
        // RENDER FUNCTIONS
        // ========================================================================
        function renderStats(apps) {
            const total = apps.length;
            const active = apps.filter(a => STATUSES[a.status]?.active).length;
            const responses = apps.filter(a => ['Response Received', 'Interview Scheduled', 'Interviewed', 'Offer Received'].includes(a.status)).length;
            const applied = apps.filter(a => a.status !== 'To Apply').length;
            const responseRate = applied > 0 ? Math.round((responses / applied) * 100) : 0;

            document.getElementById('statTotal').textContent = total;
            document.getElementById('statActive').textContent = active;
            document.getElementById('statResponses').textContent = responses;
            document.getElementById('statResponseRate').textContent = responseRate + '%';
        }

        function renderComparison(apps) {
            const insight = generateComparisonInsight(apps);
            const container = document.getElementById('comparisonInsight');
            const text = document.getElementById('comparisonText');

            if (insight) {
                text.textContent = insight;
                container.classList.add('show');
            } else {
                container.classList.remove('show');
            }
        }

        function renderApplications(apps) {
            const container = document.getElementById('applicationsContainer');
            const filtered = filterApplications(apps);
            const sorted = sortApplications(filtered);

            // Show/hide filters based on app count
            document.getElementById('filtersBar').style.display = apps.length > 0 ? 'flex' : 'none';

            if (apps.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h2>No applications yet</h2>
                        <p>Start by analyzing a job description. When you click "Track This Application," it'll show up here with your fit score, strategy, and next steps.</p>
                        <a href="index.html">Analyze a Role</a>
                    </div>
                `;
                return;
            }

            if (sorted.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h2>No matches</h2>
                        <p>No applications match your current filters. Try adjusting them above.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = `
                <div class="applications-list">
                    ${sorted.map(app => renderAppCard(app)).join('')}
                </div>
            `;

            attachCardListeners();
        }

        function renderAppCard(app) {
            const statusConfig = STATUSES[app.status] || STATUSES['To Apply'];
            const action = statusConfig.nextAction(app);
            const isInactive = !statusConfig.active;
            
            // Fit badge class
            let fitClass = 'fit-medium';
            if (app.fitScore >= 75) fitClass = 'fit-high';
            else if (app.fitScore < 60) fitClass = 'fit-low';

            // Build history
            const history = [];
            if (app.dateAdded) history.push({ action: 'Added', date: app.dateAdded });
            if (app.dateApplied) history.push({ action: 'Applied', date: app.dateApplied });
            if (app.dateReachedOut) history.push({ action: 'Reached out', date: app.dateReachedOut });
            if (app.dateResponseReceived) history.push({ action: 'Response received', date: app.dateResponseReceived });
            if (app.dateInterviewed) history.push({ action: 'Interviewed', date: app.dateInterviewed });
            history.sort((a, b) => new Date(a.date) - new Date(b.date));

            // Action button states
            const appliedDone = !!app.dateApplied;
            const reachedOutDone = !!app.dateReachedOut;
            const interviewedDone = !!app.dateInterviewed;

            return `
                <div class="app-card ${isInactive ? 'inactive' : ''}" data-id="${app.id}">
                    <div class="app-card-header">
                        <div class="app-card-title">
                            <h3>${app.role}</h3>
                            <div class="company">${app.company}${app.salary && app.salary !== 'Not specified' ? ' ¬∑ ' + app.salary : ''}</div>
                        </div>
                        <div class="app-card-meta">
                            <span class="fit-badge ${fitClass}">${app.fitScore}% fit</span>
                            <div class="status-selector">
                                <button class="status-btn" onclick="toggleStatusDropdown(${app.id})">
                                    ${app.status} <span style="font-size: 0.7rem;">‚ñº</span>
                                </button>
                                <div class="status-dropdown" id="dropdown-${app.id}">
                                    ${Object.keys(STATUSES).map(status => `
                                        <div class="status-option" onclick="updateStatus(${app.id}, '${status}')">${status}</div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="action-box ${action.type}">
                        <div class="action-header">
                            <div class="action-label">What to do next</div>
                            <button class="calendar-btn" onclick="addToCalendar(${app.id})" title="Add reminder to calendar">
                                üìÖ Add Reminder
                            </button>
                        </div>
                        <div class="action-text">${action.context}</div>
                        <div class="action-item">‚Üí ${action.action}</div>
                    </div>

                    ${history.length > 1 ? `
                    <div class="history-section">
                        <div class="history-toggle" onclick="toggleHistory(${app.id})">
                            üìÖ History (${history.length} events)
                        </div>
                        <div class="history-content" id="history-${app.id}">
                            ${history.map(h => `
                                <div class="history-item">
                                    <span class="date">${formatDateTime(h.date)}</span> - ${h.action}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    ` : ''}

                    <div class="notes-section">
                        <div class="notes-toggle" onclick="toggleNotes(${app.id})">
                            üìù Notes ${app.notes ? '(has notes)' : ''}
                        </div>
                        <div class="notes-content" id="notes-${app.id}">
                            <textarea 
                                class="notes-textarea" 
                                placeholder="Add notes: contacts, interview details, follow-up reminders..."
                                onblur="saveNotes(${app.id}, this.value)"
                            >${app.notes || ''}</textarea>
                        </div>
                    </div>

                    <div class="card-actions">
                        <button class="card-action-btn ${appliedDone ? 'done' : ''}" onclick="${appliedDone ? '' : `markDateAction(${app.id}, 'dateApplied')`}">
                            ${appliedDone ? '‚úì Applied' : 'üì§ Mark Applied'}
                        </button>
                        <button class="card-action-btn ${reachedOutDone ? 'done' : ''}" onclick="${reachedOutDone ? '' : `markDateAction(${app.id}, 'dateReachedOut')`}">
                            ${reachedOutDone ? '‚úì Reached Out' : 'üí¨ Mark Reached Out'}
                        </button>
                        <button class="card-action-btn ${interviewedDone ? 'done' : ''}" onclick="${interviewedDone ? '' : `markDateAction(${app.id}, 'dateInterviewed')`}">
                            ${interviewedDone ? '‚úì Interviewed' : 'üé§ Mark Interviewed'}
                        </button>
                        <button class="card-action-btn danger" onclick="showDeleteModal(${app.id})">Remove</button>
                    </div>
                </div>
            `;
        }

        // ========================================================================
        // INTERACTION HANDLERS
        // ========================================================================
        function toggleStatusDropdown(appId) {
            document.querySelectorAll('.status-dropdown').forEach(d => d.classList.remove('show'));
            const dropdown = document.getElementById(`dropdown-${appId}`);
            dropdown.classList.toggle('show');
        }

        function updateStatus(appId, newStatus) {
            const apps = getApplications();
            const appIndex = apps.findIndex(a => a.id === appId);
            
            if (appIndex !== -1) {
                apps[appIndex].status = newStatus;
                apps[appIndex].lastUpdated = new Date().toISOString();
                
                // Auto-set date fields based on status (only if not already set)
                if (newStatus === 'Applied' && !apps[appIndex].dateApplied) {
                    apps[appIndex].dateApplied = new Date().toISOString();
                }
                if (newStatus === 'Reached Out' && !apps[appIndex].dateReachedOut) {
                    apps[appIndex].dateReachedOut = new Date().toISOString();
                }
                if (newStatus === 'Response Received' && !apps[appIndex].dateResponseReceived) {
                    apps[appIndex].dateResponseReceived = new Date().toISOString();
                }
                if (newStatus === 'Interviewed' && !apps[appIndex].dateInterviewed) {
                    apps[appIndex].dateInterviewed = new Date().toISOString();
                }
                
                saveApplications(apps);
                renderAll(apps);
            }
        }

        function markDateAction(appId, dateField) {
            const apps = getApplications();
            const appIndex = apps.findIndex(a => a.id === appId);
            
            if (appIndex !== -1 && !apps[appIndex][dateField]) {
                apps[appIndex][dateField] = new Date().toISOString();
                
                // Auto-update status
                if (dateField === 'dateApplied' && apps[appIndex].status === 'To Apply') {
                    apps[appIndex].status = 'Applied';
                } else if (dateField === 'dateReachedOut' && ['To Apply', 'Applied'].includes(apps[appIndex].status)) {
                    apps[appIndex].status = 'Reached Out';
                } else if (dateField === 'dateInterviewed') {
                    apps[appIndex].status = 'Interviewed';
                }
                
                saveApplications(apps);
                renderAll(apps);
            }
        }

        function toggleHistory(appId) {
            const content = document.getElementById(`history-${appId}`);
            content.classList.toggle('show');
        }

        function toggleNotes(appId) {
            const notesContent = document.getElementById(`notes-${appId}`);
            notesContent.classList.toggle('show');
        }

        function saveNotes(appId, notes) {
            const apps = getApplications();
            const appIndex = apps.findIndex(a => a.id === appId);
            
            if (appIndex !== -1) {
                apps[appIndex].notes = notes;
                saveApplications(apps);
            }
        }

        let deleteAppId = null;

        function showDeleteModal(appId) {
            deleteAppId = appId;
            document.getElementById('deleteModal').classList.add('show');
        }

        function closeDeleteModal() {
            deleteAppId = null;
            document.getElementById('deleteModal').classList.remove('show');
        }

        function confirmDelete() {
            if (deleteAppId) {
                const apps = getApplications().filter(a => a.id !== deleteAppId);
                saveApplications(apps);
                closeDeleteModal();
                renderAll(apps);
            }
        }

        // ========================================================================
        // CALENDAR INTEGRATION
        // ========================================================================
        function addToCalendar(appId) {
            const apps = getApplications();
            const app = apps.find(a => a.id === appId);
            
            if (!app) return;

            // Determine when to set the reminder based on status and action
            const action = STATUSES[app.status] || STATUSES['To Apply'];
            let reminderDate = new Date();
            
            // Set reminder timing based on status
            if (app.status === 'To Apply') {
                // Apply within 24-48 hours
                reminderDate.setDate(reminderDate.getDate() + 1);
                reminderDate.setHours(9, 0, 0, 0); // 9 AM tomorrow
            } else if (app.status === 'Applied') {
                // Follow up in 5-7 days
                reminderDate.setDate(reminderDate.getDate() + 5);
                reminderDate.setHours(9, 0, 0, 0);
            } else if (app.status === 'Phone Screen') {
                // Prepare and send thank you within 24 hours
                reminderDate.setDate(reminderDate.getDate() + 1);
                reminderDate.setHours(14, 0, 0, 0); // 2 PM tomorrow
            } else if (app.status === 'Onsite') {
                // Send thank you within 24 hours
                reminderDate.setDate(reminderDate.getDate() + 1);
                reminderDate.setHours(14, 0, 0, 0);
            } else {
                // Default: tomorrow at 9 AM
                reminderDate.setDate(reminderDate.getDate() + 1);
                reminderDate.setHours(9, 0, 0, 0);
            }

            // Format dates for calendar
            const startDate = formatDateForCalendar(reminderDate);
            const endDate = formatDateForCalendar(new Date(reminderDate.getTime() + 30 * 60000)); // 30 min later

            // Build event details
            const title = `Follow up: ${app.company} - ${app.role}`;
            const description = `${action.context}\n\n‚Üí ${action.action}\n\nFit Score: ${app.fitScore}%\n${app.salary && app.salary !== 'Not specified' ? 'Salary: ' + app.salary : ''}`;
            const location = ''; // Could add job URL if we had it

            // Show calendar options modal
            showCalendarOptions(title, description, startDate, endDate, location);
        }

        function formatDateForCalendar(date) {
            // Format: YYYYMMDDTHHMMSSZ
            return date.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
        }

        function showCalendarOptions(title, description, startDate, endDate, location) {
            const modal = document.createElement('div');
            modal.className = 'calendar-modal';
            modal.innerHTML = `
                <div class="calendar-modal-content">
                    <h3>Add Reminder to Calendar</h3>
                    <p style="color: #888; margin-bottom: 20px;">Choose your calendar app:</p>
                    <div class="calendar-buttons">
                        <button class="calendar-option-btn" onclick="addToGoogleCalendar('${encodeURIComponent(title)}', '${encodeURIComponent(description)}', '${startDate}', '${endDate}', '${location}')">
                            üìÖ Google Calendar
                        </button>
                        <button class="calendar-option-btn" onclick="downloadICS('${encodeURIComponent(title)}', '${encodeURIComponent(description)}', '${startDate}', '${endDate}', '${location}')">
                            üì• Apple/Outlook (.ics)
                        </button>
                    </div>
                    <button class="calendar-close-btn" onclick="closeCalendarModal()">Cancel</button>
                </div>
            `;
            document.body.appendChild(modal);
            setTimeout(() => modal.classList.add('show'), 10);
        }

        function closeCalendarModal() {
            const modal = document.querySelector('.calendar-modal');
            if (modal) {
                modal.classList.remove('show');
                setTimeout(() => modal.remove(), 300);
            }
        }

        function addToGoogleCalendar(title, description, startDate, endDate, location) {
            const url = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${title}&details=${description}&dates=${startDate}/${endDate}&location=${location}`;
            window.open(url, '_blank');
            closeCalendarModal();
        }

        function downloadICS(title, description, startDate, endDate, location) {
            // Convert from URL encoding
            title = decodeURIComponent(title);
            description = decodeURIComponent(description);
            location = decodeURIComponent(location);

            // Create ICS file content
            const icsContent = `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//HenryAI//Job Application Tracker//EN
BEGIN:VEVENT
UID:${Date.now()}@henryai.com
DTSTAMP:${startDate}
DTSTART:${startDate}
DTEND:${endDate}
SUMMARY:${title}
DESCRIPTION:${description.replace(/\n/g, '\\n')}
LOCATION:${location}
STATUS:CONFIRMED
SEQUENCE:0
BEGIN:VALARM
TRIGGER:-PT30M
ACTION:DISPLAY
DESCRIPTION:Reminder
END:VALARM
END:VEVENT
END:VCALENDAR`;

            // Create blob and download
            const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
            const link = document.createElement('a');
            link.href = window.URL.createObjectURL(blob);
            link.download = `henryai-reminder-${Date.now()}.ics`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            closeCalendarModal();
        }

        function attachCardListeners() {
            // Close dropdowns when clicking outside
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.status-selector')) {
                    document.querySelectorAll('.status-dropdown').forEach(d => d.classList.remove('show'));
                }
            });
        }

        // ========================================================================
        // FILTER HANDLERS
        // ========================================================================
        document.getElementById('filterStatus').addEventListener('change', (e) => {
            currentFilter = e.target.value;
            renderApplications(getApplications());
        });

        document.getElementById('filterFit').addEventListener('change', (e) => {
            currentFitFilter = e.target.value;
            renderApplications(getApplications());
        });

        document.getElementById('sortToggle').addEventListener('click', () => {
            sortNewestFirst = !sortNewestFirst;
            document.getElementById('sortToggle').textContent = sortNewestFirst ? 'Sort: Newest ‚Üì' : 'Sort: Oldest ‚Üë';
            renderApplications(getApplications());
        });

        document.getElementById('confirmDeleteBtn').addEventListener('click', confirmDelete);

        // ========================================================================
        // RENDER ALL
        // ========================================================================
        function renderAll(apps) {
            renderStats(apps);
            renderComparison(apps);
            renderApplications(apps);
        }

        // ========================================================================
        // INITIALIZE
        // ========================================================================
        renderAll(getApplications());
    </script>
</body>
</html>
