<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pipeline Command Center | HenryAI</title>
    <style>
        :root {
            /* Core Colors */
            --color-bg: #0a0a0b;
            --color-surface: #141416;
            --color-surface-elevated: #1c1c1f;
            --color-border: rgba(255, 255, 255, 0.08);
            --color-border-hover: rgba(255, 255, 255, 0.15);
            --color-text: #fafafa;
            --color-text-secondary: #71717a;
            --color-text-muted: #52525b;

            /* Status Colors */
            --color-hot: #FF6B35;
            --color-hot-muted: rgba(255, 107, 53, 0.15);
            --color-active: #4CAF50;
            --color-active-muted: rgba(76, 175, 80, 0.15);
            --color-cooling: #546E7A;
            --color-cooling-muted: rgba(84, 110, 122, 0.15);
            --color-dead: #E57373;
            --color-dead-muted: rgba(229, 115, 115, 0.15);
            --color-leverage: #FFD700;
            --color-leverage-muted: rgba(255, 215, 0, 0.15);

            /* Accent */
            --color-accent: #22d3ee;
            --color-accent-muted: rgba(34, 211, 238, 0.15);

            /* Typography */
            --font-display: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            --font-body: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            background: var(--color-bg);
            color: var(--color-text);
            min-height: 100vh;
            line-height: 1.6;
        }

        /* HEADER */
        header {
            padding: 20px 0;
            border-bottom: 1px solid var(--color-border);
            background: var(--color-bg);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        header .header-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-family: 'Georgia', serif;
            font-size: 1.5rem;
            color: var(--color-text);
            text-decoration: none;
        }

        .logo em {
            font-style: italic;
            color: var(--color-accent);
        }

        .header-nav {
            display: flex;
            gap: 24px;
            align-items: center;
        }

        .nav-link {
            color: var(--color-text-secondary);
            text-decoration: none;
            font-size: 0.9rem;
            transition: color 0.2s ease;
        }

        .nav-link:hover {
            color: var(--color-accent);
        }

        /* MAIN CONTAINER */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 32px 24px;
        }

        /* PAGE HEADER */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 32px;
        }

        .page-header h1 {
            font-size: 1.75rem;
            font-weight: 600;
            letter-spacing: -0.02em;
        }

        .page-header .subtitle {
            color: var(--color-text-secondary);
            font-size: 0.95rem;
            margin-top: 4px;
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        .header-btn {
            padding: 10px 16px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid var(--color-border);
            background: var(--color-surface);
            color: var(--color-text);
        }

        .header-btn:hover {
            border-color: var(--color-border-hover);
            background: var(--color-surface-elevated);
        }

        .header-btn.primary {
            background: var(--color-accent);
            color: #000;
            border-color: var(--color-accent);
        }

        .header-btn.primary:hover {
            opacity: 0.9;
        }

        /* PIPELINE INTELLIGENCE DASHBOARD */
        .pipeline-dashboard {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 16px;
            margin-bottom: 32px;
        }

        .metric-card {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .metric-card.highlight {
            border-color: var(--color-leverage);
            background: var(--color-leverage-muted);
        }

        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            font-variant-numeric: tabular-nums;
            line-height: 1.2;
        }

        .metric-value.green { color: var(--color-active); }
        .metric-value.amber { color: var(--color-hot); }
        .metric-value.gold { color: var(--color-leverage); }
        .metric-value.blue { color: var(--color-accent); }
        .metric-value.gray { color: var(--color-cooling); }
        .metric-value.red { color: var(--color-dead); }

        .metric-label {
            font-size: 0.75rem;
            color: var(--color-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 6px;
        }

        .metric-sublabel {
            font-size: 0.7rem;
            color: var(--color-text-muted);
            margin-top: 4px;
        }

        /* STRATEGIC PRIORITIES */
        .strategic-priorities {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 32px;
        }

        .priorities-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .priorities-title {
            font-size: 1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .priority-item {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            padding: 16px;
            background: var(--color-bg);
            border-radius: 12px;
            margin-bottom: 12px;
            border-left: 3px solid transparent;
            transition: all 0.2s;
        }

        .priority-item:last-child {
            margin-bottom: 0;
        }

        .priority-item:hover {
            background: var(--color-surface-elevated);
        }

        .priority-item.hot {
            border-left-color: var(--color-hot);
        }

        .priority-item.active {
            border-left-color: var(--color-active);
        }

        .priority-item.cooling {
            border-left-color: var(--color-cooling);
        }

        .priority-item.leverage {
            border-left-color: var(--color-leverage);
        }

        .priority-badge {
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 4px 8px;
            border-radius: 4px;
            flex-shrink: 0;
        }

        .priority-badge.hot {
            background: var(--color-hot-muted);
            color: var(--color-hot);
        }

        .priority-badge.active {
            background: var(--color-active-muted);
            color: var(--color-active);
        }

        .priority-badge.cooling {
            background: var(--color-cooling-muted);
            color: var(--color-cooling);
        }

        .priority-badge.leverage {
            background: var(--color-leverage-muted);
            color: var(--color-leverage);
        }

        .priority-content {
            flex: 1;
            min-width: 0;
        }

        .priority-role {
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 4px;
        }

        .priority-company {
            color: var(--color-text-secondary);
            font-size: 0.85rem;
        }

        .priority-action {
            font-size: 0.85rem;
            color: var(--color-text-muted);
            margin-top: 8px;
            padding-left: 12px;
            border-left: 2px solid var(--color-border);
        }

        .priority-meta {
            display: flex;
            gap: 16px;
            align-items: center;
            flex-shrink: 0;
        }

        .priority-fit {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--color-active);
        }

        .priority-days {
            font-size: 0.8rem;
            color: var(--color-text-muted);
        }

        /* FILTERS BAR */
        .filters-bar {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-label {
            font-size: 0.8rem;
            color: var(--color-text-muted);
        }

        .filter-select {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            color: var(--color-text);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.85rem;
            cursor: pointer;
        }

        .filter-select:hover {
            border-color: var(--color-border-hover);
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--color-accent);
        }

        .view-toggle {
            display: flex;
            margin-left: auto;
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            overflow: hidden;
        }

        .view-btn {
            padding: 8px 16px;
            border: none;
            background: transparent;
            color: var(--color-text-secondary);
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .view-btn:hover {
            color: var(--color-text);
        }

        .view-btn.active {
            background: var(--color-accent);
            color: #000;
        }

        /* APPLICATION CARDS */
        .applications-grid {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .app-card {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 16px;
            overflow: hidden;
            transition: all 0.2s;
        }

        .app-card:hover {
            border-color: var(--color-border-hover);
        }

        .app-card.hot {
            border-color: var(--color-hot);
            box-shadow: 0 0 20px var(--color-hot-muted);
        }

        .app-card.inactive {
            opacity: 0.6;
        }

        /* Card Header */
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 20px 24px 16px;
        }

        .card-title-section {
            flex: 1;
            min-width: 0;
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .leverage-badge {
            font-size: 0.65rem;
            font-weight: 700;
            text-transform: uppercase;
            padding: 3px 6px;
            border-radius: 4px;
            background: var(--color-leverage-muted);
            color: var(--color-leverage);
        }

        .card-subtitle {
            color: var(--color-text-secondary);
            font-size: 0.9rem;
        }

        .card-meta {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .fit-badge {
            font-size: 0.9rem;
            font-weight: 600;
            padding: 6px 12px;
            border-radius: 8px;
        }

        .fit-badge.high {
            background: var(--color-active-muted);
            color: var(--color-active);
        }

        .fit-badge.medium {
            background: var(--color-hot-muted);
            color: var(--color-hot);
        }

        .fit-badge.low {
            background: var(--color-dead-muted);
            color: var(--color-dead);
        }

        /* Next Action Section */
        .next-action {
            margin: 0 24px 16px;
            padding: 16px;
            background: var(--color-bg);
            border-radius: 12px;
            border-left: 3px solid var(--color-accent);
        }

        .next-action.urgent {
            border-left-color: var(--color-hot);
            background: var(--color-hot-muted);
        }

        .next-action.positive {
            border-left-color: var(--color-active);
            background: var(--color-active-muted);
        }

        .next-action.dead {
            border-left-color: var(--color-dead);
            background: var(--color-dead-muted);
        }

        .next-action-label {
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--color-accent);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .next-action.urgent .next-action-label { color: var(--color-hot); }
        .next-action.positive .next-action-label { color: var(--color-active); }
        .next-action.dead .next-action-label { color: var(--color-dead); }

        .next-action-text {
            font-size: 0.9rem;
            line-height: 1.5;
            margin-bottom: 8px;
        }

        .next-action-cta {
            font-size: 0.85rem;
            color: var(--color-text);
            font-weight: 500;
        }

        /* Timeline Section */
        .timeline-section {
            padding: 0 24px 16px;
        }

        .timeline-bar {
            display: flex;
            align-items: center;
            gap: 4px;
            margin-bottom: 8px;
        }

        .timeline-stage {
            flex: 1;
            height: 6px;
            background: var(--color-border);
            border-radius: 3px;
            position: relative;
        }

        .timeline-stage.completed {
            background: var(--color-active);
        }

        .timeline-stage.current {
            background: linear-gradient(90deg, var(--color-active) 50%, var(--color-border) 50%);
        }

        .timeline-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.7rem;
            color: var(--color-text-muted);
        }

        /* Card Stats Grid */
        .card-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1px;
            background: var(--color-border);
            margin: 0 24px 16px;
            border-radius: 8px;
            overflow: hidden;
        }

        .card-stat {
            background: var(--color-bg);
            padding: 12px;
            text-align: center;
        }

        .card-stat-value {
            font-size: 0.85rem;
            font-weight: 600;
        }

        .card-stat-value.fast { color: var(--color-active); }
        .card-stat-value.medium { color: var(--color-hot); }
        .card-stat-value.slow { color: var(--color-cooling); }

        .card-stat-label {
            font-size: 0.7rem;
            color: var(--color-text-muted);
            margin-top: 2px;
        }

        /* Card Actions */
        .card-actions {
            display: flex;
            gap: 8px;
            padding: 16px 24px;
            border-top: 1px solid var(--color-border);
            background: var(--color-bg);
        }

        .card-action-btn {
            flex: 1;
            padding: 10px;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid var(--color-border);
            background: var(--color-surface);
            color: var(--color-text-secondary);
        }

        .card-action-btn:hover {
            background: var(--color-surface-elevated);
            color: var(--color-text);
        }

        .card-action-btn.primary {
            background: var(--color-accent);
            color: #000;
            border-color: var(--color-accent);
        }

        .card-action-btn.done {
            color: var(--color-active);
            border-color: var(--color-active-muted);
        }

        .card-action-btn.danger:hover {
            background: var(--color-dead-muted);
            color: var(--color-dead);
            border-color: var(--color-dead);
        }

        /* Status Selector */
        .status-selector {
            position: relative;
        }

        .status-btn {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
            border: 1px solid var(--color-border);
            background: var(--color-surface);
            color: var(--color-text);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .status-btn:hover {
            border-color: var(--color-border-hover);
        }

        .status-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 4px;
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 12px;
            padding: 8px;
            z-index: 100;
            min-width: 200px;
            display: none;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }

        .status-dropdown.show {
            display: block;
        }

        .status-option {
            padding: 10px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: background 0.15s;
        }

        .status-option:hover {
            background: var(--color-surface-elevated);
        }

        /* Expandable Sections */
        .expandable-section {
            padding: 0 24px;
            margin-bottom: 16px;
        }

        .expandable-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--color-text-secondary);
            font-size: 0.85rem;
            cursor: pointer;
            padding: 8px 0;
        }

        .expandable-toggle:hover {
            color: var(--color-text);
        }

        .expandable-content {
            display: none;
            padding: 12px 0;
        }

        .expandable-content.show {
            display: block;
        }

        /* Notes */
        .notes-textarea {
            width: 100%;
            background: var(--color-bg);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            padding: 12px;
            color: var(--color-text);
            font-family: inherit;
            font-size: 0.9rem;
            resize: vertical;
            min-height: 80px;
        }

        .notes-textarea:focus {
            outline: none;
            border-color: var(--color-accent);
        }

        /* Interview Notes */
        .interview-notes {
            background: var(--color-bg);
            border-radius: 8px;
            padding: 16px;
        }

        .interview-date {
            font-size: 0.8rem;
            color: var(--color-text-muted);
            margin-bottom: 12px;
        }

        .interview-section {
            margin-bottom: 12px;
        }

        .interview-section:last-child {
            margin-bottom: 0;
        }

        .interview-section-label {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
        }

        .interview-section-label.nailed { color: var(--color-active); }
        .interview-section-label.fumbled { color: var(--color-hot); }
        .interview-section-label.signals { color: var(--color-accent); }

        .interview-bullets {
            list-style: none;
            font-size: 0.85rem;
            color: var(--color-text-secondary);
        }

        .interview-bullets li {
            padding: 4px 0;
            padding-left: 16px;
            position: relative;
        }

        .interview-bullets li::before {
            content: 'â€¢';
            position: absolute;
            left: 0;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 80px 40px;
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 16px;
        }

        .empty-state h2 {
            font-size: 1.25rem;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .empty-state p {
            color: var(--color-text-secondary);
            margin-bottom: 24px;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        .empty-state a {
            display: inline-block;
            background: var(--color-accent);
            color: #000;
            padding: 14px 28px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
        }

        /* Modals */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 16px;
            padding: 32px;
            max-width: 500px;
            width: 100%;
        }

        .modal h2 {
            font-size: 1.25rem;
            margin-bottom: 12px;
        }

        .modal p {
            color: var(--color-text-secondary);
            margin-bottom: 24px;
            line-height: 1.6;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .modal-btn {
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }

        .modal-btn.secondary {
            background: var(--color-surface-elevated);
            color: var(--color-text);
        }

        .modal-btn.secondary:hover {
            background: var(--color-border);
        }

        .modal-btn.danger {
            background: var(--color-dead);
            color: white;
        }

        .modal-btn.danger:hover {
            opacity: 0.9;
        }

        /* Responsive */
        @media (max-width: 900px) {
            .pipeline-dashboard {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 640px) {
            .container {
                padding: 20px 16px;
            }

            .pipeline-dashboard {
                grid-template-columns: repeat(2, 1fr);
            }

            .page-header {
                flex-direction: column;
                gap: 16px;
            }

            .header-actions {
                width: 100%;
            }

            .header-btn {
                flex: 1;
            }

            .filters-bar {
                flex-direction: column;
                align-items: stretch;
            }

            .view-toggle {
                margin-left: 0;
            }

            .card-header {
                flex-direction: column;
                gap: 12px;
            }

            .card-meta {
                width: 100%;
                justify-content: space-between;
            }

            .card-stats {
                grid-template-columns: 1fr;
            }

            .card-actions {
                flex-wrap: wrap;
            }

            .priority-item {
                flex-direction: column;
                gap: 12px;
            }

            .priority-meta {
                width: 100%;
                justify-content: space-between;
            }
        }
    </style>
</head>
<body>
    <!-- HEADER -->
    <header>
        <div class="header-container">
            <a href="index.html" class="logo"><em>Henry</em>AI</a>
            <nav class="header-nav">
                <a href="index.html" class="nav-link">Analyze a Role</a>
                <a href="profile-edit.html" class="nav-link">Edit Profile</a>
            </nav>
        </div>
    </header>

    <div class="container">
        <!-- PAGE HEADER -->
        <div class="page-header">
            <div>
                <h1>Pipeline Command Center</h1>
                <p class="subtitle">Your strategic view of every opportunity in play</p>
            </div>
            <div class="header-actions">
                <a href="analyze.html" class="header-btn primary">+ Analyze New Role</a>
            </div>
        </div>

        <!-- PIPELINE INTELLIGENCE DASHBOARD -->
        <div class="pipeline-dashboard" id="pipelineDashboard">
            <div class="metric-card">
                <div class="metric-value green" id="metricActive">0</div>
                <div class="metric-label">Active</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="metricMomentum">--</div>
                <div class="metric-label">Momentum</div>
                <div class="metric-sublabel" id="metricMomentumDetail">High: 0 | Med: 0</div>
            </div>
            <div class="metric-card highlight">
                <div class="metric-value gold" id="metricLeverage">--</div>
                <div class="metric-label">Leverage</div>
            </div>
            <div class="metric-card">
                <div class="metric-value blue" id="metricTimeToScreen">--</div>
                <div class="metric-label">Avg Time to Screen</div>
            </div>
            <div class="metric-card">
                <div class="metric-value green" id="metricConversion">0%</div>
                <div class="metric-label">Interview Rate</div>
            </div>
            <div class="metric-card">
                <div class="metric-value gray" id="metricGhost">0%</div>
                <div class="metric-label">Ghost Rate</div>
            </div>
        </div>

        <!-- STRATEGIC PRIORITIES -->
        <div class="strategic-priorities" id="strategicPriorities" style="display: none;">
            <div class="priorities-header">
                <div class="priorities-title">
                    <span>ðŸŽ¯</span> Strategic Priorities
                </div>
            </div>
            <div id="prioritiesContent">
                <!-- Dynamically populated -->
            </div>
        </div>

        <!-- FILTERS BAR -->
        <div class="filters-bar" id="filtersBar" style="display: none;">
            <div class="filter-group">
                <span class="filter-label">Status:</span>
                <select class="filter-select" id="filterStatus">
                    <option value="all">All</option>
                    <option value="active">Active Only</option>
                    <option value="hot">ðŸ”¥ Hot</option>
                    <option value="interviewing">Interviewing</option>
                    <option value="waiting">Waiting</option>
                    <option value="stale">Stale</option>
                </select>
            </div>
            <div class="filter-group">
                <span class="filter-label">Fit:</span>
                <select class="filter-select" id="filterFit">
                    <option value="all">All</option>
                    <option value="high">80%+ Strong</option>
                    <option value="medium">60-79%</option>
                    <option value="low">Below 60%</option>
                </select>
            </div>
            <div class="filter-group">
                <span class="filter-label">Sort:</span>
                <select class="filter-select" id="sortBy">
                    <option value="urgency">Urgency</option>
                    <option value="fit">Fit Score</option>
                    <option value="recent">Most Recent</option>
                    <option value="timeline">Timeline</option>
                </select>
            </div>
        </div>

        <!-- APPLICATIONS -->
        <div id="applicationsContainer">
            <!-- Dynamically populated -->
        </div>
    </div>

    <!-- DELETE MODAL -->
    <div class="modal-overlay" id="deleteModal">
        <div class="modal">
            <h2>Archive this application?</h2>
            <p>This will move the role out of your active pipeline. You can always add it back by analyzing the job again.</p>
            <div class="modal-actions">
                <button class="modal-btn secondary" onclick="closeDeleteModal()">Cancel</button>
                <button class="modal-btn danger" id="confirmDeleteBtn">Archive</button>
            </div>
        </div>
    </div>

    <script>
        // ========================================================================
        // STATUS DEFINITIONS WITH STAGE WEIGHTS
        // ========================================================================
        const STATUSES = {
            'Preparing': { label: 'Preparing', active: true, stage: 0, stageWeight: 5 },
            'To Apply': { label: 'To Apply', active: true, stage: 0, stageWeight: 10 },
            'Applied': { label: 'Applied', active: true, stage: 1, stageWeight: 15 },
            'Reached Out': { label: 'Reached Out', active: true, stage: 1, stageWeight: 20 },
            'Response Received': { label: 'Response Received', active: true, stage: 2, stageWeight: 25 },
            'Recruiter Screen': { label: 'Recruiter Screen', active: true, stage: 2, stageWeight: 30 },
            'Hiring Manager': { label: 'Hiring Manager', active: true, stage: 3, stageWeight: 40 },
            'Technical Round': { label: 'Technical Round', active: true, stage: 3, stageWeight: 45 },
            'Panel Interview': { label: 'Panel Interview', active: true, stage: 3, stageWeight: 50 },
            'Final Round': { label: 'Final Round', active: true, stage: 4, stageWeight: 55 },
            'Executive Interview': { label: 'Executive Interview', active: true, stage: 4, stageWeight: 60 },
            'Interviewed': { label: 'Interviewed', active: true, stage: 4, stageWeight: 50 },
            'Offer Received': { label: 'Offer Received', active: false, stage: 5, stageWeight: 70 },
            'No Response': { label: 'No Response', active: false, stage: -1, stageWeight: 0 },
            'Rejected': { label: 'Rejected', active: false, stage: -1, stageWeight: 0 },
            'Withdrawn': { label: 'Withdrawn', active: false, stage: -1, stageWeight: 0 }
        };

        // Interview stages for timeline
        const INTERVIEW_STAGES = ['Applied', 'Screen', 'Interview', 'Final', 'Offer'];

        // ========================================================================
        // STATE
        // ========================================================================
        let currentStatusFilter = 'all';
        let currentFitFilter = 'all';
        let currentSort = 'urgency';

        // ========================================================================
        // HELPER FUNCTIONS
        // ========================================================================
        function getDaysSince(dateString) {
            if (!dateString) return 0;
            const date = new Date(dateString);
            const now = new Date();
            return Math.floor((now - date) / (1000 * 60 * 60 * 24));
        }

        function formatDate(dateString) {
            if (!dateString) return '';
            return new Date(dateString).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        }

        function getApplications() {
            return JSON.parse(localStorage.getItem('trackedApplications') || '[]');
        }

        function saveApplications(apps) {
            localStorage.setItem('trackedApplications', JSON.stringify(apps));
        }

        function parseSalary(salaryStr) {
            if (!salaryStr) return 0;
            const match = salaryStr.match(/\$?([\d,]+)/);
            return match ? parseInt(match[1].replace(/,/g, '')) : 0;
        }

        // ========================================================================
        // MOMENTUM CALCULATION
        // ========================================================================
        function getMomentum(app) {
            const daysSinceContact = getDaysSince(app.lastUpdated || app.dateAdded);
            if (daysSinceContact <= 3) return 'fast';
            if (daysSinceContact <= 7) return 'medium';
            if (daysSinceContact <= 14) return 'slow';
            return 'stalled';
        }

        function getMomentumLabel(momentum) {
            const labels = { fast: 'Fast', medium: 'Medium', slow: 'Slow', stalled: 'Stalled' };
            return labels[momentum] || 'Unknown';
        }

        // ========================================================================
        // STATUS LABEL (Hot, Active, Cooling, Dead)
        // ========================================================================
        function getStatusLabel(app) {
            const status = STATUSES[app.status];
            if (!status || !status.active) return 'dead';

            const daysSinceContact = getDaysSince(app.lastUpdated || app.dateAdded);
            const isInterviewing = ['Recruiter Screen', 'Hiring Manager', 'Technical Round', 'Panel Interview', 'Final Round', 'Executive Interview'].includes(app.status);

            // Hot: Interview stage OR offer expected soon OR urgent follow-up
            if (isInterviewing || app.status === 'Offer Received') return 'hot';
            if (daysSinceContact <= 3 && status.stageWeight >= 20) return 'hot';

            // Active: Movement within 7 days
            if (daysSinceContact <= 7) return 'active';

            // Cooling: No activity 8-13 days
            if (daysSinceContact <= 13) return 'cooling';

            // Stagnant/Dead: 14+ days
            return 'dead';
        }

        // ========================================================================
        // URGENCY SCORE (for sorting and prioritization)
        // ========================================================================
        function calculateUrgencyScore(app) {
            const status = STATUSES[app.status] || {};
            const daysSinceContact = getDaysSince(app.lastUpdated || app.dateAdded);
            const fitScore = app.fitScore || 50;

            // Base urgency from stage weight
            let urgency = status.stageWeight || 0;

            // Add fit score bonus (max 100)
            urgency += fitScore;

            // Recency bonus (inverse of days, max 50)
            urgency += Math.max(0, 50 - (daysSinceContact * 3));

            // Network leverage bonus
            if (app.networkLeverage === '1st_degree') urgency += 20;
            else if (app.networkLeverage === '2nd_degree') urgency += 10;
            else if (app.networkLeverage === 'referral') urgency += 15;

            // Penalize inactive
            if (!status.active) urgency = -100;

            return urgency;
        }

        // ========================================================================
        // NEXT ACTION ENGINE
        // ========================================================================
        function generateNextAction(app) {
            const status = app.status;
            const daysSinceContact = getDaysSince(app.lastUpdated || app.dateAdded);
            const daysSinceApplied = getDaysSince(app.dateApplied);
            const daysSinceInterview = getDaysSince(app.dateInterviewed);

            // Preparing
            if (status === 'Preparing') {
                return {
                    type: 'default',
                    context: "You're building your application materials.",
                    action: "Review your tailored documents and submit your application."
                };
            }

            // To Apply
            if (status === 'To Apply') {
                if (daysSinceContact > 3) {
                    return {
                        type: 'urgent',
                        context: `Added ${daysSinceContact} days ago. Roles get 300+ applicants in 48 hours.`,
                        action: "Apply today or archive it and focus elsewhere."
                    };
                }
                return {
                    type: 'default',
                    context: "Best results come from applying within 24-48 hours of posting.",
                    action: "Submit your application, then reach out directly on LinkedIn."
                };
            }

            // Applied
            if (status === 'Applied') {
                if (daysSinceApplied < 3) {
                    return {
                        type: 'default',
                        context: `Applied ${daysSinceApplied === 0 ? 'today' : daysSinceApplied + ' days ago'}. The ATS is a black hole.`,
                        action: "Find the hiring manager on LinkedIn and send a personalized message."
                    };
                } else if (daysSinceApplied < 7) {
                    return {
                        type: 'default',
                        context: `${daysSinceApplied} days since you applied.`,
                        action: "If you haven't reached out directly, now's the time. Find someone at the company."
                    };
                } else if (daysSinceApplied < 14) {
                    return {
                        type: 'urgent',
                        context: `${daysSinceApplied} days with no response.`,
                        action: "Send a follow-up or move on. In this market, silence usually means no."
                    };
                } else {
                    return {
                        type: 'dead',
                        context: `${daysSinceApplied} days since applying. Likely ghosted.`,
                        action: "Archive and focus on active opportunities. Not personalâ€”this market is brutal."
                    };
                }
            }

            // Reached Out
            if (status === 'Reached Out') {
                if (daysSinceContact < 5) {
                    return {
                        type: 'default',
                        context: `Outreach sent ${daysSinceContact === 0 ? 'today' : daysSinceContact + ' days ago'}. Give them 3-5 business days.`,
                        action: "Keep applying to other roles. Never wait on one opportunity."
                    };
                } else if (daysSinceContact < 10) {
                    return {
                        type: 'urgent',
                        context: `No response to outreach after ${daysSinceContact} days.`,
                        action: "Send a brief follow-up: 'Circling back on my note about [Role]. Still very interested.'"
                    };
                } else {
                    return {
                        type: 'dead',
                        context: `${daysSinceContact} days since outreach. This one's cold.`,
                        action: "Mark as 'No Response' and redirect your energy."
                    };
                }
            }

            // Response Received
            if (status === 'Response Received') {
                return {
                    type: 'positive',
                    context: "You got a response. Speed signals interest.",
                    action: "Respond within 24 hours. Be flexible on scheduling. Research the interviewer."
                };
            }

            // Interview stages
            if (['Recruiter Screen', 'Hiring Manager', 'Technical Round', 'Panel Interview', 'Final Round', 'Executive Interview'].includes(status)) {
                return {
                    type: 'positive',
                    context: `${status} scheduled. You're in the running.`,
                    action: "Prep your stories, research your interviewers, have questions ready."
                };
            }

            // Interviewed
            if (status === 'Interviewed') {
                if (daysSinceInterview < 1) {
                    return {
                        type: 'default',
                        context: "Interview complete. The follow-up matters.",
                        action: "Send a thank-you within 24 hours. Keep it brief but specific."
                    };
                } else if (daysSinceInterview < 7) {
                    return {
                        type: 'default',
                        context: "Thank-you sent. Now wait.",
                        action: "Follow up after 5-7 business days if you haven't heard back."
                    };
                } else {
                    return {
                        type: 'urgent',
                        context: `${daysSinceInterview} days since your interview.`,
                        action: "Send a check-in: 'Wanted to follow up on the timeline for [Role].'"
                    };
                }
            }

            // Offer
            if (status === 'Offer Received') {
                return {
                    type: 'positive',
                    context: "Congratulations. Take 24-48 hours to review carefully.",
                    action: "Research market rates. Prepare negotiation points. Consider the full package."
                };
            }

            // Inactive statuses
            if (['No Response', 'Rejected', 'Withdrawn'].includes(status)) {
                return {
                    type: 'dead',
                    context: status === 'Rejected' ? "This one didn't work out." : status === 'Withdrawn' ? "You withdrew from this one." : "No response received.",
                    action: "Archive it mentally and keep moving. Every silence gets you closer to the right fit."
                };
            }

            return {
                type: 'default',
                context: "Keep this one moving.",
                action: "Check for any pending follow-ups."
            };
        }

        // ========================================================================
        // PIPELINE METRICS
        // ========================================================================
        function calculatePipelineMetrics(apps) {
            const activeApps = apps.filter(a => STATUSES[a.status]?.active);
            const allApps = apps;

            // Active count
            const activeCount = activeApps.length;

            // Momentum distribution
            let momentumHigh = 0, momentumMed = 0;
            activeApps.forEach(app => {
                const m = getMomentum(app);
                if (m === 'fast') momentumHigh++;
                else if (m === 'medium') momentumMed++;
            });

            // Leverage score: (final-stage interviews * avg fit) / total active
            const finalStageApps = activeApps.filter(a =>
                ['Final Round', 'Executive Interview', 'Offer Received'].includes(a.status)
            );
            let leverageScore = 0;
            if (activeCount > 0 && finalStageApps.length > 0) {
                const avgFit = finalStageApps.reduce((sum, a) => sum + (a.fitScore || 50), 0) / finalStageApps.length;
                leverageScore = (finalStageApps.length * avgFit) / activeCount / 10;
            }

            // Average time to screen
            const withScreen = allApps.filter(a => a.dateApplied && a.dateResponseReceived);
            let avgTimeToScreen = null;
            if (withScreen.length > 0) {
                const total = withScreen.reduce((sum, a) => {
                    return sum + getDaysSince(a.dateApplied) - getDaysSince(a.dateResponseReceived);
                }, 0);
                avgTimeToScreen = Math.round(total / withScreen.length * 10) / 10;
            }

            // Interview conversion rate
            const applied = allApps.filter(a => !['Preparing', 'To Apply'].includes(a.status)).length;
            const interviewed = allApps.filter(a =>
                ['Response Received', 'Recruiter Screen', 'Hiring Manager', 'Technical Round', 'Panel Interview', 'Final Round', 'Executive Interview', 'Interviewed', 'Offer Received'].includes(a.status)
            ).length;
            const conversionRate = applied > 0 ? Math.round((interviewed / applied) * 100) : 0;

            // Ghost rate
            const ghosted = allApps.filter(a => {
                const days = getDaysSince(a.dateApplied || a.dateAdded);
                return a.status === 'Applied' && days > 14;
            }).length;
            const ghostRate = applied > 0 ? Math.round((ghosted / applied) * 100) : 0;

            return {
                activeCount,
                momentumHigh,
                momentumMed,
                leverageScore,
                avgTimeToScreen,
                conversionRate,
                ghostRate
            };
        }

        // ========================================================================
        // STRATEGIC PRIORITIES
        // ========================================================================
        function getStrategicPriorities(apps) {
            const activeApps = apps.filter(a => STATUSES[a.status]?.active);

            // Calculate urgency for each and sort
            const withUrgency = activeApps.map(app => ({
                ...app,
                urgencyScore: calculateUrgencyScore(app),
                statusLabel: getStatusLabel(app),
                momentum: getMomentum(app)
            }));

            withUrgency.sort((a, b) => b.urgencyScore - a.urgencyScore);

            // Return top 3-5
            return withUrgency.slice(0, Math.min(5, withUrgency.length));
        }

        // ========================================================================
        // FILTERING & SORTING
        // ========================================================================
        function filterApplications(apps) {
            return apps.filter(app => {
                const status = STATUSES[app.status];
                const statusLabel = getStatusLabel(app);

                // Status filter
                if (currentStatusFilter === 'active' && !status?.active) return false;
                if (currentStatusFilter === 'hot' && statusLabel !== 'hot') return false;
                if (currentStatusFilter === 'interviewing') {
                    const interviewStatuses = ['Recruiter Screen', 'Hiring Manager', 'Technical Round', 'Panel Interview', 'Final Round', 'Executive Interview'];
                    if (!interviewStatuses.includes(app.status)) return false;
                }
                if (currentStatusFilter === 'waiting') {
                    if (!['Applied', 'Reached Out', 'Interviewed'].includes(app.status)) return false;
                }
                if (currentStatusFilter === 'stale') {
                    if (statusLabel !== 'cooling' && statusLabel !== 'dead') return false;
                }

                // Fit filter
                if (currentFitFilter === 'high' && app.fitScore < 80) return false;
                if (currentFitFilter === 'medium' && (app.fitScore < 60 || app.fitScore >= 80)) return false;
                if (currentFitFilter === 'low' && app.fitScore >= 60) return false;

                return true;
            });
        }

        function sortApplications(apps) {
            return [...apps].sort((a, b) => {
                // Always put active first
                const aActive = STATUSES[a.status]?.active ?? true;
                const bActive = STATUSES[b.status]?.active ?? true;
                if (aActive && !bActive) return -1;
                if (!aActive && bActive) return 1;

                // Sort by selected criteria
                if (currentSort === 'urgency') {
                    return calculateUrgencyScore(b) - calculateUrgencyScore(a);
                }
                if (currentSort === 'fit') {
                    return (b.fitScore || 0) - (a.fitScore || 0);
                }
                if (currentSort === 'recent') {
                    return new Date(b.lastUpdated || b.dateAdded) - new Date(a.lastUpdated || a.dateAdded);
                }
                if (currentSort === 'timeline') {
                    return (STATUSES[b.status]?.stageWeight || 0) - (STATUSES[a.status]?.stageWeight || 0);
                }
                return 0;
            });
        }

        // ========================================================================
        // RENDER FUNCTIONS
        // ========================================================================
        function renderPipelineMetrics(metrics) {
            document.getElementById('metricActive').textContent = metrics.activeCount;
            document.getElementById('metricActive').className = 'metric-value ' + (metrics.activeCount > 0 ? 'green' : 'gray');

            // Momentum
            const totalMomentum = metrics.momentumHigh + metrics.momentumMed;
            document.getElementById('metricMomentum').textContent = totalMomentum > 0 ? (metrics.momentumHigh > metrics.momentumMed ? 'High' : 'Med') : '--';
            document.getElementById('metricMomentum').className = 'metric-value ' + (metrics.momentumHigh > 0 ? 'green' : metrics.momentumMed > 0 ? 'amber' : 'gray');
            document.getElementById('metricMomentumDetail').textContent = `High: ${metrics.momentumHigh} | Med: ${metrics.momentumMed}`;

            // Leverage
            document.getElementById('metricLeverage').textContent = metrics.leverageScore > 0 ? metrics.leverageScore.toFixed(1) + 'x' : '--';

            // Time to screen
            document.getElementById('metricTimeToScreen').textContent = metrics.avgTimeToScreen ? metrics.avgTimeToScreen + ' days' : '--';

            // Conversion
            document.getElementById('metricConversion').textContent = metrics.conversionRate + '%';
            document.getElementById('metricConversion').className = 'metric-value ' + (metrics.conversionRate >= 20 ? 'green' : metrics.conversionRate >= 10 ? 'amber' : 'gray');

            // Ghost rate
            document.getElementById('metricGhost').textContent = metrics.ghostRate + '%';
            document.getElementById('metricGhost').className = 'metric-value ' + (metrics.ghostRate <= 30 ? 'gray' : 'red');
        }

        function renderStrategicPriorities(priorities) {
            const container = document.getElementById('strategicPriorities');
            const content = document.getElementById('prioritiesContent');

            if (priorities.length === 0) {
                container.style.display = 'none';
                return;
            }

            container.style.display = 'block';

            content.innerHTML = priorities.map(app => {
                const action = generateNextAction(app);
                const statusLabel = app.statusLabel;
                const daysSince = getDaysSince(app.lastUpdated || app.dateAdded);

                return `
                    <div class="priority-item ${statusLabel}">
                        <span class="priority-badge ${statusLabel}">${statusLabel.toUpperCase()}</span>
                        <div class="priority-content">
                            <div class="priority-role">${app.role}</div>
                            <div class="priority-company">${app.company} â€¢ ${app.status}</div>
                            <div class="priority-action">â†’ ${action.action}</div>
                        </div>
                        <div class="priority-meta">
                            <span class="priority-fit">${app.fitScore}%</span>
                            <span class="priority-days">${daysSince === 0 ? 'Today' : daysSince + 'd ago'}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderApplications(apps) {
            const container = document.getElementById('applicationsContainer');
            const filtered = filterApplications(apps);
            const sorted = sortApplications(filtered);

            // Show/hide filters
            document.getElementById('filtersBar').style.display = apps.length > 0 ? 'flex' : 'none';

            if (apps.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h2>Your command center is ready.</h2>
                        <p>Analyze your first role to start building your strategic pipeline.</p>
                        <a href="analyze.html">Analyze First Role</a>
                    </div>
                `;
                return;
            }

            if (sorted.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h2>No matches</h2>
                        <p>No applications match your current filters.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = `
                <div class="applications-grid">
                    ${sorted.map(app => renderAppCard(app)).join('')}
                </div>
            `;
        }

        function renderAppCard(app) {
            const status = STATUSES[app.status] || {};
            const statusLabel = getStatusLabel(app);
            const momentum = getMomentum(app);
            const action = generateNextAction(app);
            const isInactive = !status.active;
            const daysSince = getDaysSince(app.lastUpdated || app.dateAdded);

            // Fit badge class
            let fitClass = 'medium';
            if (app.fitScore >= 80) fitClass = 'high';
            else if (app.fitScore < 60) fitClass = 'low';

            // Timeline stage (0-4)
            const timelineStage = Math.min(4, Math.floor((status.stageWeight || 0) / 15));

            // Check if high leverage (final stages + high fit)
            const isLeverage = status.stageWeight >= 50 && app.fitScore >= 75;

            return `
                <div class="app-card ${statusLabel === 'hot' ? 'hot' : ''} ${isInactive ? 'inactive' : ''}" data-id="${app.id}">
                    <div class="card-header">
                        <div class="card-title-section">
                            <div class="card-title">
                                ${app.role}
                                ${isLeverage ? '<span class="leverage-badge">ðŸ”¥ LEVERAGE</span>' : ''}
                            </div>
                            <div class="card-subtitle">
                                ${app.company}${app.salary && app.salary !== 'Not specified' ? ' â€¢ ' + app.salary : ''}
                            </div>
                        </div>
                        <div class="card-meta">
                            <span class="fit-badge ${fitClass}">${app.fitScore}% fit</span>
                            <div class="status-selector">
                                <button class="status-btn" onclick="toggleStatusDropdown(${app.id})">
                                    ${app.status} <span style="opacity: 0.5;">â–¼</span>
                                </button>
                                <div class="status-dropdown" id="dropdown-${app.id}">
                                    ${Object.keys(STATUSES).map(s => `
                                        <div class="status-option" onclick="updateStatus(${app.id}, '${s}')">${s}</div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="next-action ${action.type}">
                        <div class="next-action-label">
                            <span>âš¡</span> Next Action
                        </div>
                        <div class="next-action-text">${action.context}</div>
                        <div class="next-action-cta">â†’ ${action.action}</div>
                    </div>

                    <div class="timeline-section">
                        <div class="timeline-bar">
                            ${[0,1,2,3,4].map(i => `
                                <div class="timeline-stage ${i < timelineStage ? 'completed' : i === timelineStage ? 'current' : ''}"></div>
                            `).join('')}
                        </div>
                        <div class="timeline-labels">
                            <span>Applied</span>
                            <span>Screen</span>
                            <span>Interview</span>
                            <span>Final</span>
                            <span>Offer</span>
                        </div>
                    </div>

                    <div class="card-stats">
                        <div class="card-stat">
                            <div class="card-stat-value ${momentum}">${getMomentumLabel(momentum)}</div>
                            <div class="card-stat-label">Momentum</div>
                        </div>
                        <div class="card-stat">
                            <div class="card-stat-value">${daysSince === 0 ? 'Today' : daysSince + 'd'}</div>
                            <div class="card-stat-label">Last Activity</div>
                        </div>
                        <div class="card-stat">
                            <div class="card-stat-value">${app.networkLeverage ? 'âœ“' : 'â€”'}</div>
                            <div class="card-stat-label">Network</div>
                        </div>
                    </div>

                    <div class="expandable-section">
                        <div class="expandable-toggle" onclick="toggleSection(${app.id}, 'notes')">
                            ðŸ“ Notes ${app.notes ? '(has notes)' : ''}
                        </div>
                        <div class="expandable-content" id="notes-content-${app.id}">
                            <textarea class="notes-textarea" placeholder="Add notes: contacts, interview details, reminders..." onblur="saveNotes(${app.id}, this.value)">${app.notes || ''}</textarea>
                        </div>
                    </div>

                    ${app.interviewNotes ? `
                    <div class="expandable-section">
                        <div class="expandable-toggle" onclick="toggleSection(${app.id}, 'interview')">
                            ðŸŽ¤ Interview Notes
                        </div>
                        <div class="expandable-content" id="interview-content-${app.id}">
                            <div class="interview-notes">
                                ${renderInterviewNotes(app.interviewNotes)}
                            </div>
                        </div>
                    </div>
                    ` : ''}

                    <div class="card-actions">
                        <button class="card-action-btn ${app.dateApplied ? 'done' : ''}" onclick="${app.dateApplied ? '' : `markAction(${app.id}, 'dateApplied')`}">
                            ${app.dateApplied ? 'âœ“ Applied' : 'ðŸ“¤ Mark Applied'}
                        </button>
                        <button class="card-action-btn ${app.dateReachedOut ? 'done' : ''}" onclick="${app.dateReachedOut ? '' : `markAction(${app.id}, 'dateReachedOut')`}">
                            ${app.dateReachedOut ? 'âœ“ Reached Out' : 'ðŸ’¬ Reach Out'}
                        </button>
                        <button class="card-action-btn ${app.dateInterviewed ? 'done' : ''}" onclick="${app.dateInterviewed ? '' : `markAction(${app.id}, 'dateInterviewed')`}">
                            ${app.dateInterviewed ? 'âœ“ Interviewed' : 'ðŸŽ¤ Interviewed'}
                        </button>
                        <button class="card-action-btn danger" onclick="showDeleteModal(${app.id})">Archive</button>
                    </div>
                </div>
            `;
        }

        function renderInterviewNotes(notes) {
            if (!notes) return '';
            return `
                <div class="interview-date">${formatDate(notes.date)}</div>
                ${notes.nailed?.length ? `
                    <div class="interview-section">
                        <div class="interview-section-label nailed">What You Nailed</div>
                        <ul class="interview-bullets">
                            ${notes.nailed.map(n => `<li>${n}</li>`).join('')}
                        </ul>
                    </div>
                ` : ''}
                ${notes.fumbled?.length ? `
                    <div class="interview-section">
                        <div class="interview-section-label fumbled">What to Improve</div>
                        <ul class="interview-bullets">
                            ${notes.fumbled.map(f => `<li>${f}</li>`).join('')}
                        </ul>
                    </div>
                ` : ''}
                ${notes.signals?.length ? `
                    <div class="interview-section">
                        <div class="interview-section-label signals">Signals</div>
                        <ul class="interview-bullets">
                            ${notes.signals.map(s => `<li>${s}</li>`).join('')}
                        </ul>
                    </div>
                ` : ''}
            `;
        }

        // ========================================================================
        // INTERACTION HANDLERS
        // ========================================================================
        function toggleStatusDropdown(appId) {
            document.querySelectorAll('.status-dropdown').forEach(d => d.classList.remove('show'));
            document.getElementById(`dropdown-${appId}`).classList.toggle('show');
        }

        function updateStatus(appId, newStatus) {
            const apps = getApplications();
            const idx = apps.findIndex(a => a.id === appId);

            if (idx !== -1) {
                apps[idx].status = newStatus;
                apps[idx].lastUpdated = new Date().toISOString();

                // Auto-set dates
                if (newStatus === 'Applied' && !apps[idx].dateApplied) {
                    apps[idx].dateApplied = new Date().toISOString();
                }
                if (newStatus === 'Reached Out' && !apps[idx].dateReachedOut) {
                    apps[idx].dateReachedOut = new Date().toISOString();
                }
                if (newStatus === 'Response Received' && !apps[idx].dateResponseReceived) {
                    apps[idx].dateResponseReceived = new Date().toISOString();
                }
                if (['Interviewed', 'Recruiter Screen', 'Hiring Manager', 'Technical Round', 'Panel Interview', 'Final Round', 'Executive Interview'].includes(newStatus) && !apps[idx].dateInterviewed) {
                    apps[idx].dateInterviewed = new Date().toISOString();
                }

                saveApplications(apps);
                renderAll(apps);
            }

            document.querySelectorAll('.status-dropdown').forEach(d => d.classList.remove('show'));
        }

        function markAction(appId, dateField) {
            const apps = getApplications();
            const idx = apps.findIndex(a => a.id === appId);

            if (idx !== -1 && !apps[idx][dateField]) {
                apps[idx][dateField] = new Date().toISOString();
                apps[idx].lastUpdated = new Date().toISOString();

                // Auto-update status
                if (dateField === 'dateApplied' && ['Preparing', 'To Apply'].includes(apps[idx].status)) {
                    apps[idx].status = 'Applied';
                }
                if (dateField === 'dateReachedOut' && ['Preparing', 'To Apply', 'Applied'].includes(apps[idx].status)) {
                    apps[idx].status = 'Reached Out';
                }
                if (dateField === 'dateInterviewed' && !['Interviewed', 'Offer Received', 'No Response', 'Rejected', 'Withdrawn'].includes(apps[idx].status)) {
                    apps[idx].status = 'Interviewed';
                }

                saveApplications(apps);
                renderAll(apps);
            }
        }

        function toggleSection(appId, section) {
            const content = document.getElementById(`${section}-content-${appId}`);
            content.classList.toggle('show');
        }

        function saveNotes(appId, notes) {
            const apps = getApplications();
            const idx = apps.findIndex(a => a.id === appId);

            if (idx !== -1) {
                apps[idx].notes = notes;
                saveApplications(apps);
            }
        }

        let deleteAppId = null;

        function showDeleteModal(appId) {
            deleteAppId = appId;
            document.getElementById('deleteModal').classList.add('show');
        }

        function closeDeleteModal() {
            deleteAppId = null;
            document.getElementById('deleteModal').classList.remove('show');
        }

        function confirmDelete() {
            if (deleteAppId) {
                const apps = getApplications().filter(a => a.id !== deleteAppId);
                saveApplications(apps);
                closeDeleteModal();
                renderAll(apps);
            }
        }

        // Close dropdowns when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.status-selector')) {
                document.querySelectorAll('.status-dropdown').forEach(d => d.classList.remove('show'));
            }
        });

        // ========================================================================
        // FILTER HANDLERS
        // ========================================================================
        document.getElementById('filterStatus').addEventListener('change', (e) => {
            currentStatusFilter = e.target.value;
            renderApplications(getApplications());
        });

        document.getElementById('filterFit').addEventListener('change', (e) => {
            currentFitFilter = e.target.value;
            renderApplications(getApplications());
        });

        document.getElementById('sortBy').addEventListener('change', (e) => {
            currentSort = e.target.value;
            renderApplications(getApplications());
        });

        document.getElementById('confirmDeleteBtn').addEventListener('click', confirmDelete);

        // ========================================================================
        // RENDER ALL
        // ========================================================================
        function renderAll(apps) {
            const metrics = calculatePipelineMetrics(apps);
            const priorities = getStrategicPriorities(apps);

            renderPipelineMetrics(metrics);
            renderStrategicPriorities(priorities);
            renderApplications(apps);
        }

        // ========================================================================
        // INITIALIZE
        // ========================================================================
        renderAll(getApplications());
    </script>
<script src="components/ask-henry.js"></script>
</body>
</html>
