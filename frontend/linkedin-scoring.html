<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinkedIn Scoring ‚Äî HenryHQ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=DM+Sans:opsz,wght@9..40,400;9..40,500;9..40,600&display=swap" rel="stylesheet">
    <style>
        :root {
            --color-bg: #0a0a0b;
            --color-surface: #141416;
            --color-surface-elevated: #1c1c1f;
            --color-border: rgba(255, 255, 255, 0.08);
            --color-text: #fafafa;
            --color-text-secondary: #a1a1aa;
            --color-accent: #22d3ee;
            --color-success: #4ade80;
            --color-warning: #fbbf24;
            --color-error: #f87171;
            --color-linkedin: #0077b5;
            --font-display: 'Instrument Serif', Georgia, serif;
            --font-body: 'DM Sans', -apple-system, sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: var(--font-body);
            background: var(--color-bg);
            color: var(--color-text);
            min-height: 100vh;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
        }

        main {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .back-link {
            color: var(--color-text-secondary);
            text-decoration: none;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 24px;
        }

        .back-link:hover { color: var(--color-accent); }

        h1 {
            font-family: var(--font-display);
            font-size: 2.2rem;
            font-weight: 400;
            margin-bottom: 8px;
        }

        .subtitle {
            color: var(--color-text-secondary);
            font-size: 1rem;
            margin-bottom: 32px;
        }

        /* Score Header */
        .score-header {
            display: flex;
            align-items: center;
            gap: 24px;
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 16px;
            padding: 28px;
            margin-bottom: 24px;
        }

        .score-circle {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            background: conic-gradient(var(--color-linkedin) calc(var(--score) * 3.6deg), var(--color-surface-elevated) 0deg);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            flex-shrink: 0;
        }

        .score-circle::before {
            content: '';
            position: absolute;
            width: 72px;
            height: 72px;
            border-radius: 50%;
            background: var(--color-surface);
        }

        .score-value {
            position: relative;
            z-index: 1;
            font-size: 1.6rem;
            font-weight: 600;
            color: var(--color-linkedin);
        }

        .score-info h2 {
            font-family: var(--font-display);
            font-size: 1.4rem;
            font-weight: 400;
            margin-bottom: 6px;
        }

        .score-summary {
            color: var(--color-text-secondary);
            font-size: 0.95rem;
        }

        /* Fix List - Collapsible */
        .fix-section {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 16px;
            margin-bottom: 24px;
            overflow: hidden;
        }

        .fix-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .fix-header:hover {
            background: var(--color-surface-elevated);
        }

        .fix-header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .fix-title {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .fix-count {
            background: var(--color-error);
            color: #000;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .fix-count.success {
            background: var(--color-success);
        }

        .fix-header-right {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--color-text-secondary);
            font-size: 0.85rem;
        }

        .fix-chevron {
            transition: transform 0.2s;
        }

        .fix-section.expanded .fix-chevron {
            transform: rotate(180deg);
        }

        .fix-list {
            display: none;
            padding: 0 24px 24px;
            border-top: 1px solid var(--color-border);
        }

        .fix-section.expanded .fix-list {
            display: block;
        }

        .fix-list-inner {
            padding-top: 16px;
        }

        .fix-item {
            background: var(--color-surface-elevated);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 12px;
            border-left: 3px solid var(--color-error);
        }

        .fix-item:last-child { margin-bottom: 0; }

        .fix-item.done {
            border-left-color: var(--color-success);
            opacity: 0.6;
        }

        .fix-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .fix-item-title {
            font-weight: 600;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .fix-item-title .priority {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            text-transform: uppercase;
            font-weight: 600;
        }

        .fix-item-title .priority.critical {
            background: rgba(248, 113, 113, 0.15);
            color: var(--color-error);
        }

        .fix-item-title .priority.high {
            background: rgba(251, 191, 36, 0.15);
            color: var(--color-warning);
        }

        .fix-item-title .priority.medium {
            background: rgba(34, 211, 238, 0.15);
            color: var(--color-accent);
        }

        .fix-item-title .priority.low {
            background: rgba(161, 161, 170, 0.15);
            color: var(--color-text-secondary);
        }

        .fix-item.critical { border-left-color: var(--color-error); }
        .fix-item.high { border-left-color: var(--color-warning); }
        .fix-item.medium { border-left-color: var(--color-accent); }
        .fix-item.low { border-left-color: var(--color-text-secondary); }

        .fix-item-why {
            color: var(--color-text-secondary);
            font-size: 0.9rem;
            margin-bottom: 16px;
        }

        /* Before/After */
        .before-after {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        @media (max-width: 600px) {
            .before-after {
                grid-template-columns: 1fr;
            }
        }

        .before, .after {
            padding: 14px;
            border-radius: 8px;
            font-size: 0.85rem;
        }

        .before {
            background: rgba(248, 113, 113, 0.08);
            border: 1px solid rgba(248, 113, 113, 0.2);
        }

        .after {
            background: rgba(74, 222, 128, 0.08);
            border: 1px solid rgba(74, 222, 128, 0.2);
        }

        .before-label, .after-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
            font-weight: 600;
        }

        .before-label { color: var(--color-error); }
        .after-label { color: var(--color-success); }

        .before-text, .after-text {
            color: var(--color-text-secondary);
            line-height: 1.5;
        }

        .after-text { color: var(--color-text); }

        /* Section Cards - 2 Column Grid */
        .section-cards {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }

        @media (max-width: 700px) {
            .section-cards {
                grid-template-columns: 1fr;
            }
        }

        .section-card {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 12px;
            overflow: hidden;
            transition: border-color 0.2s;
        }

        .section-card.good { border-left: 3px solid var(--color-success); }
        .section-card.warning { border-left: 3px solid var(--color-warning); }
        .section-card.bad { border-left: 3px solid var(--color-error); }

        .section-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 16px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .section-card-header:hover {
            background: var(--color-surface-elevated);
        }

        .section-card-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-icon {
            font-size: 1.1rem;
        }

        .section-name {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .section-card-right {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-score {
            font-weight: 600;
            font-size: 0.95rem;
        }

        .section-card.good .section-score { color: var(--color-success); }
        .section-card.warning .section-score { color: var(--color-warning); }
        .section-card.bad .section-score { color: var(--color-error); }

        .section-chevron {
            color: var(--color-text-secondary);
            transition: transform 0.2s;
            font-size: 0.8rem;
        }

        .section-card.expanded .section-chevron {
            transform: rotate(180deg);
        }

        .section-card-body {
            display: none;
            padding: 0 16px 16px;
            border-top: 1px solid var(--color-border);
        }

        .section-card.expanded .section-card-body {
            display: block;
        }

        .score-criteria {
            padding-top: 12px;
        }

        .criteria-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 0;
            font-size: 0.85rem;
            border-bottom: 1px solid var(--color-border);
        }

        .criteria-item:last-child {
            border-bottom: none;
        }

        .criteria-label {
            color: var(--color-text-secondary);
        }

        .criteria-value {
            font-weight: 500;
        }

        .criteria-value.earned { color: var(--color-success); }
        .criteria-value.partial { color: var(--color-warning); }
        .criteria-value.missed { color: var(--color-error); }

        /* Quick Breakdown Grid (for mobile/summary) */
        .breakdown-grid {
            display: none;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }

        @media (max-width: 600px) {
            .breakdown-grid {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
            }
            .section-cards {
                display: none;
            }
        }

        .breakdown-card {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
        }

        .breakdown-card.good { border-color: rgba(74, 222, 128, 0.3); }
        .breakdown-card.warning { border-color: rgba(251, 191, 36, 0.3); }
        .breakdown-card.bad { border-color: rgba(248, 113, 113, 0.3); }

        .breakdown-score {
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .breakdown-card.good .breakdown-score { color: var(--color-success); }
        .breakdown-card.warning .breakdown-score { color: var(--color-warning); }
        .breakdown-card.bad .breakdown-score { color: var(--color-error); }

        .breakdown-label {
            font-size: 0.8rem;
            color: var(--color-text-secondary);
        }

        /* All Good State */
        .all-good {
            background: rgba(74, 222, 128, 0.08);
            border: 1px solid rgba(74, 222, 128, 0.2);
            border-radius: 16px;
            padding: 32px;
            text-align: center;
            margin-bottom: 24px;
        }

        .all-good-icon {
            font-size: 3rem;
            margin-bottom: 16px;
        }

        .all-good h3 {
            font-family: var(--font-display);
            font-size: 1.3rem;
            color: var(--color-success);
            margin-bottom: 8px;
        }

        .all-good p {
            color: var(--color-text-secondary);
            font-size: 0.95rem;
        }

        /* CTA */
        .cta-section {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
        }

        .cta-section h3 {
            font-family: var(--font-display);
            font-size: 1.2rem;
            margin-bottom: 8px;
        }

        .cta-section p {
            color: var(--color-text-secondary);
            margin-bottom: 16px;
            font-size: 0.9rem;
        }

        .btn-primary {
            padding: 12px 24px;
            background: var(--color-accent);
            border: none;
            border-radius: 8px;
            color: #000;
            font-family: var(--font-body);
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(34, 211, 238, 0.3);
        }

        /* Upload State */
        .upload-prompt {
            background: var(--color-surface);
            border: 2px dashed var(--color-border);
            border-radius: 16px;
            padding: 48px 32px;
            text-align: center;
        }

        .upload-icon { font-size: 3rem; margin-bottom: 16px; }

        .upload-prompt h2 {
            font-family: var(--font-display);
            font-size: 1.4rem;
            margin-bottom: 12px;
        }

        .upload-prompt p {
            color: var(--color-text-secondary);
            margin-bottom: 24px;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        .upload-how-to {
            background: var(--color-surface-elevated);
            border-radius: 8px;
            padding: 14px 18px;
            margin-bottom: 24px;
            display: inline-block;
            font-size: 0.9rem;
        }

        .upload-path {
            color: var(--color-text-secondary);
            display: block;
            margin-top: 6px;
        }

        .btn-upload {
            padding: 14px 28px;
            background: var(--color-linkedin);
            border: none;
            border-radius: 8px;
            color: white;
            font-family: var(--font-body);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 60px 20px;
        }

        .loading-spinner {
            border: 3px solid var(--color-surface-elevated);
            border-top: 3px solid var(--color-linkedin);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    <link rel="stylesheet" href="css/mobile.css">
    <link rel="stylesheet" href="css/linkedin.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/supabase-client.js"></script>
</head>
<body>
    <main>
        <a href="results.html" class="back-link">‚Üê Back to Results</a>

        <h1>LinkedIn Audit</h1>
        <p class="subtitle">What to fix before you apply</p>

        <div id="mainContent">
            <!-- Upload Prompt -->
            <div class="upload-prompt" id="uploadPrompt">
                <div class="upload-icon">üíº</div>
                <h2>Upload Your LinkedIn Profile</h2>
                <p>We'll tell you exactly what's hurting your visibility and how to fix it.</p>

                <div class="upload-how-to">
                    <strong>How to get your LinkedIn PDF:</strong>
                    <span class="upload-path">Your Profile ‚Üí More ‚Üí Save to PDF</span>
                </div>

                <button class="btn-upload" id="uploadBtn">Upload LinkedIn PDF</button>
                <input type="file" id="linkedinFile" accept=".pdf" style="display: none;">
            </div>

            <!-- Score Content -->
            <div id="scoreContent" style="display: none;">
                <!-- Score Header -->
                <div class="score-header">
                    <div class="score-circle" style="--score: 68">
                        <span class="score-value" id="overallScore">68</span>
                    </div>
                    <div class="score-info">
                        <h2 id="scoreLabel">Needs Work</h2>
                        <p class="score-summary" id="scoreSummary">Recruiters will find you but won't click. Fix the items below.</p>
                    </div>
                </div>

                <!-- Section Cards (Desktop) -->
                <div class="section-cards" id="sectionCards">
                    <!-- Populated dynamically -->
                </div>

                <!-- Quick Breakdown (Mobile) -->
                <div class="breakdown-grid" id="breakdownGrid">
                    <!-- Populated dynamically -->
                </div>

                <!-- Fix List or All Good -->
                <div id="fixListContainer">
                    <!-- Populated dynamically -->
                </div>

                <!-- CTA -->
                <div class="cta-section">
                    <h3>Ready to make these changes?</h3>
                    <p>We've generated optimized sections you can copy-paste into LinkedIn.</p>
                    <a href="documents.html" class="btn-primary">Get Your Optimized Sections ‚Üí</a>
                </div>
            </div>
        </div>
    </main>

    <script>
        const API_BASE = window.location.hostname === 'localhost' ? 'http://localhost:8000' : 'https://henryai-app-production.up.railway.app';

        // Section configuration with weights and scoring criteria
        const SECTION_CONFIG = {
            headline: {
                name: 'Headline',
                icon: 'üìå',
                weight: 0.20,
                maxPoints: 20,
                criteria: [
                    { key: 'length', label: 'Optimal length (100-220 chars)', points: 6 },
                    { key: 'role', label: 'Contains clear role/title', points: 5 },
                    { key: 'noBuzzwords', label: 'No generic buzzwords', points: 4 },
                    { key: 'quantified', label: 'Includes quantified impact', points: 5 }
                ]
            },
            about: {
                name: 'About Section',
                icon: 'üìù',
                weight: 0.15,
                maxPoints: 15,
                criteria: [
                    { key: 'exists', label: 'About section exists', points: 3 },
                    { key: 'length', label: 'Substantial length (400+ words)', points: 4 },
                    { key: 'structure', label: 'Clear structure/paragraphs', points: 3 },
                    { key: 'metrics', label: 'Contains metrics/achievements', points: 3 },
                    { key: 'cta', label: 'Has call-to-action', points: 2 }
                ]
            },
            experience: {
                name: 'Experience',
                icon: 'üíº',
                weight: 0.25,
                maxPoints: 25,
                criteria: [
                    { key: 'hasRoles', label: 'Has work experience', points: 5 },
                    { key: 'currentDetailed', label: 'Current role is detailed', points: 6 },
                    { key: 'bullets', label: 'Uses bullet points', points: 4 },
                    { key: 'metrics', label: 'Quantified achievements', points: 6 },
                    { key: 'impactFirst', label: 'Impact-first format', points: 4 }
                ]
            },
            skills: {
                name: 'Skills',
                icon: 'üéØ',
                weight: 0.15,
                maxPoints: 15,
                criteria: [
                    { key: 'count', label: 'Has 15+ skills', points: 4 },
                    { key: 'jobMatch', label: 'Skills match target job', points: 5 },
                    { key: 'topThree', label: 'Top 3 are optimized', points: 3 },
                    { key: 'noGeneric', label: 'No overly generic skills', points: 3 }
                ]
            },
            freshness: {
                name: 'Freshness',
                icon: 'üïê',
                weight: 0.10,
                maxPoints: 10,
                criteria: [
                    { key: 'recentUpdate', label: 'Updated in last 30 days', points: 5 },
                    { key: 'currentRole', label: 'Current role is up-to-date', points: 3 },
                    { key: 'activeSignals', label: 'Shows recent activity', points: 2 }
                ]
            },
            resumeAlignment: {
                name: 'Resume Alignment',
                icon: 'üìÑ',
                weight: 0.10,
                maxPoints: 10,
                criteria: [
                    { key: 'datesMatch', label: 'Dates match resume', points: 4 },
                    { key: 'titlesMatch', label: 'Job titles match', points: 3 },
                    { key: 'noGaps', label: 'No unexplained gaps', points: 3 }
                ]
            },
            credibility: {
                name: 'Credibility Signals',
                icon: '‚ú®',
                weight: 0.05,
                maxPoints: 5,
                criteria: [
                    { key: 'recommendations', label: 'Has recommendations', points: 2 },
                    { key: 'endorsements', label: 'Has skill endorsements', points: 1 },
                    { key: 'featured', label: 'Has featured section', points: 1 },
                    { key: 'activity', label: 'Shows thought leadership', points: 1 }
                ]
            }
        };

        // Severity levels for fixes
        const SEVERITY = {
            CRITICAL: { label: 'Critical', class: 'critical', order: 1 },
            HIGH: { label: 'High', class: 'high', order: 2 },
            MEDIUM: { label: 'Medium', class: 'medium', order: 3 },
            LOW: { label: 'Low', class: 'low', order: 4 }
        };

        document.addEventListener('DOMContentLoaded', async () => {
            const profile = JSON.parse(localStorage.getItem('userProfile') || '{}');
            if (profile.linkedin_profile_uploaded) {
                showScoreContent();
                await loadLinkedInScore();
            } else {
                showUploadPrompt();
            }
        });

        function showUploadPrompt() {
            document.getElementById('uploadPrompt').style.display = 'block';
            document.getElementById('scoreContent').style.display = 'none';
        }

        function showScoreContent() {
            document.getElementById('uploadPrompt').style.display = 'none';
            document.getElementById('scoreContent').style.display = 'block';
        }

        document.getElementById('uploadBtn').addEventListener('click', () => {
            document.getElementById('linkedinFile').click();
        });

        document.getElementById('linkedinFile').addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            document.getElementById('uploadPrompt').innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>Analyzing your LinkedIn profile...</p>
                </div>
            `;

            try {
                const formData = new FormData();
                formData.append('file', file);

                const response = await fetch(`${API_BASE}/api/linkedin/upload`, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) throw new Error('Upload failed');

                const data = await response.json();

                let profile = JSON.parse(localStorage.getItem('userProfile') || '{}');
                profile.linkedin_profile_uploaded = true;
                profile.linkedin_last_updated = new Date().toISOString();
                profile.linkedin_parsed = data.parsed_data;
                localStorage.setItem('userProfile', JSON.stringify(profile));

                sessionStorage.setItem('linkedinScoringData', JSON.stringify({
                    parsed: data.parsed_data,
                    timestamp: new Date().toISOString()
                }));

                showScoreContent();
                await loadLinkedInScore();

            } catch (error) {
                console.error('Upload error:', error);
                alert('Failed to upload. Please try again.');
                showUploadPrompt();
            }
        });

        async function loadLinkedInScore() {
            const analysisData = JSON.parse(sessionStorage.getItem('analysisData') || '{}');
            const profile = JSON.parse(localStorage.getItem('userProfile') || '{}');
            const resume = JSON.parse(localStorage.getItem('lastResumeAnalysis') || '{}');

            const result = calculateScore(profile, analysisData, resume);
            displayScore(result);

            sessionStorage.setItem('linkedinScoringResults', JSON.stringify(result));
        }

        function calculateScore(profile, analysisData, resume) {
            const linkedin = profile.linkedin_parsed || {};
            const sectionScores = {};
            const sectionDetails = {};
            const fixes = [];

            // ============ HEADLINE SCORING (20 pts) ============
            const headline = linkedin.headline || '';
            const headlineCriteria = {};

            // Length check (100-220 chars optimal)
            if (headline.length >= 100 && headline.length <= 220) {
                headlineCriteria.length = 6;
            } else if (headline.length >= 50) {
                headlineCriteria.length = 3;
            } else {
                headlineCriteria.length = 0;
                fixes.push({
                    severity: 'CRITICAL',
                    section: 'Headline',
                    problem: 'Your headline is too short to capture recruiter attention',
                    why: 'Recruiters scan headlines in 3 seconds. A short headline wastes valuable real estate that could showcase your expertise.',
                    fix: 'Expand to 100-220 characters. Include: Title | Specialty | Key achievement or value prop'
                });
            }

            // Clear role/title
            const hasRole = /\b(manager|director|lead|senior|engineer|developer|analyst|specialist|consultant|head|vp|chief|founder|ceo|cto|cfo)\b/i.test(headline);
            headlineCriteria.role = hasRole ? 5 : 0;
            if (!hasRole) {
                fixes.push({
                    severity: 'HIGH',
                    section: 'Headline',
                    problem: 'No clear job title in your headline',
                    why: 'Recruiters search by title. Without one, you won\'t appear in their searches.',
                    fix: 'Lead with your target role: "Senior Product Manager" not "Product enthusiast"'
                });
            }

            // No buzzwords
            const buzzwords = /\b(passionate|driven|results-oriented|team player|self-starter|dynamic|motivated|enthusiastic|hardworking|dedicated)\b/i;
            headlineCriteria.noBuzzwords = !buzzwords.test(headline) ? 4 : 0;
            if (buzzwords.test(headline)) {
                fixes.push({
                    severity: 'MEDIUM',
                    section: 'Headline',
                    problem: 'Headline contains generic buzzwords',
                    why: '"Passionate" and "driven" are invisible to recruiters - everyone uses them.',
                    fix: 'Replace buzzwords with specifics: "Passionate recruiter" ‚Üí "Technical Recruiter | 200+ engineering hires"'
                });
            }

            // Quantified impact
            const hasNumbers = /\d+[%+]?|\$\d+|#\d+/i.test(headline);
            headlineCriteria.quantified = hasNumbers ? 5 : 0;
            if (!hasNumbers && headline.length > 0) {
                fixes.push({
                    severity: 'MEDIUM',
                    section: 'Headline',
                    problem: 'No numbers in your headline',
                    why: 'Numbers provide instant credibility and differentiate you from generic profiles.',
                    fix: 'Add a metric: "$50M+ revenue" or "500+ hires" or "15 years"'
                });
            }

            sectionScores.headline = Object.values(headlineCriteria).reduce((a, b) => a + b, 0);
            sectionDetails.headline = headlineCriteria;

            // ============ ABOUT SECTION SCORING (15 pts) ============
            const about = linkedin.summary || '';
            const aboutCriteria = {};

            aboutCriteria.exists = about.length > 0 ? 3 : 0;
            if (!about) {
                fixes.push({
                    severity: 'CRITICAL',
                    section: 'About',
                    problem: 'No About section',
                    why: 'The About section is prime real estate for keywords and showing personality. Without it, you\'re invisible to searches.',
                    fix: 'Write 400-800 words covering: Hook ‚Üí Career narrative ‚Üí Expertise ‚Üí What you\'re looking for'
                });
            }

            // Length check (400+ words = ~2000 chars)
            const wordCount = about.split(/\s+/).length;
            if (wordCount >= 400) {
                aboutCriteria.length = 4;
            } else if (wordCount >= 150) {
                aboutCriteria.length = 2;
            } else {
                aboutCriteria.length = 0;
                if (about.length > 0) {
                    fixes.push({
                        severity: 'HIGH',
                        section: 'About',
                        problem: 'About section is too short',
                        why: 'A thin About section suggests you didn\'t put effort into your profile. More content = more keywords = more search matches.',
                        fix: 'Expand to 400-800 words. Add paragraphs for: Career story, Key achievements, Skills/expertise, What you\'re seeking'
                    });
                }
            }

            // Structure (paragraphs)
            const paragraphs = about.split(/\n\n+/).filter(p => p.trim().length > 0);
            aboutCriteria.structure = paragraphs.length >= 3 ? 3 : (paragraphs.length >= 2 ? 1 : 0);

            // Metrics
            const aboutHasMetrics = /\d+[%+]?|\$\d+[MBK]?|\d+\s*(years?|hires?|people|team|clients?|projects?)/i.test(about);
            aboutCriteria.metrics = aboutHasMetrics ? 3 : 0;
            if (!aboutHasMetrics && about.length > 0) {
                fixes.push({
                    severity: 'MEDIUM',
                    section: 'About',
                    problem: 'No quantified achievements in About section',
                    why: 'Metrics prove impact. "Managed teams" is forgettable. "Managed 50-person team across 3 countries" is memorable.',
                    fix: 'Add 3-5 metrics: team size, revenue impact, projects completed, years of experience'
                });
            }

            // CTA
            const hasCTA = /\b(reach out|contact|connect|email|let's talk|open to|looking for)\b/i.test(about);
            aboutCriteria.cta = hasCTA ? 2 : 0;

            sectionScores.about = Object.values(aboutCriteria).reduce((a, b) => a + b, 0);
            sectionDetails.about = aboutCriteria;

            // ============ EXPERIENCE SCORING (25 pts) ============
            const experience = linkedin.experience || [];
            const expCriteria = {};

            expCriteria.hasRoles = experience.length > 0 ? 5 : 0;
            if (experience.length === 0) {
                fixes.push({
                    severity: 'CRITICAL',
                    section: 'Experience',
                    problem: 'No work experience listed',
                    why: 'Without experience, recruiters have nothing to evaluate. This is the most important section.',
                    fix: 'Add all relevant positions with detailed descriptions, even if briefly'
                });
            }

            // Current role detail
            const currentRole = experience[0];
            const currentDesc = currentRole?.description || '';
            if (currentDesc.length >= 500) {
                expCriteria.currentDetailed = 6;
            } else if (currentDesc.length >= 200) {
                expCriteria.currentDetailed = 3;
            } else {
                expCriteria.currentDetailed = 0;
                if (experience.length > 0) {
                    fixes.push({
                        severity: 'HIGH',
                        section: 'Experience',
                        problem: 'Current role description is too thin',
                        why: 'Recruiters spend 80% of their time on your current role. A short description signals low effort.',
                        fix: 'Expand to 4-6 bullet points. Each bullet: Impact metric ‚Üí Action ‚Üí Context'
                    });
                }
            }

            // Bullet points format
            const hasBullets = experience.some(e => /^[‚Ä¢\-\*]|^\d+\./m.test(e.description || ''));
            expCriteria.bullets = hasBullets ? 4 : 0;
            if (!hasBullets && experience.length > 0) {
                fixes.push({
                    severity: 'MEDIUM',
                    section: 'Experience',
                    problem: 'Experience sections lack bullet points',
                    why: 'Walls of text get skipped. Bullets are scannable and professional.',
                    fix: 'Convert paragraphs to 4-6 bullet points per role, starting with action verbs'
                });
            }

            // Quantified achievements
            const expHasMetrics = experience.some(e =>
                /\d+[%+]?|\$\d+[MBK]?|\d+x|\d+\s*(people|hires|team|revenue|growth|million|billion)/i.test(e.description || '')
            );
            expCriteria.metrics = expHasMetrics ? 6 : 0;
            if (!expHasMetrics && experience.length > 0) {
                fixes.push({
                    severity: 'HIGH',
                    section: 'Experience',
                    problem: 'No quantified results in experience bullets',
                    why: '"Improved sales" means nothing. "Increased sales 40% ($2M)" is a compelling proof point.',
                    fix: 'Add metrics to at least 50% of bullets: %, $, team size, time saved, revenue generated'
                });
            }

            // Impact-first format
            const impactFirst = experience.some(e =>
                /^(increased|decreased|grew|reduced|generated|saved|delivered|achieved|drove|led|built|launched)/im.test(e.description || '')
            );
            expCriteria.impactFirst = impactFirst ? 4 : (experience.length > 0 ? 2 : 0);

            sectionScores.experience = Object.values(expCriteria).reduce((a, b) => a + b, 0);
            sectionDetails.experience = expCriteria;

            // ============ SKILLS SCORING (15 pts) ============
            const skills = linkedin.skills || [];
            const skillsCriteria = {};
            const atsKeywords = analysisData.ats_keywords || [];

            // Skill count
            if (skills.length >= 15) {
                skillsCriteria.count = 4;
            } else if (skills.length >= 8) {
                skillsCriteria.count = 2;
            } else {
                skillsCriteria.count = 0;
                fixes.push({
                    severity: 'HIGH',
                    section: 'Skills',
                    problem: `Only ${skills.length} skills listed (need 15+)`,
                    why: 'More skills = more search matches. LinkedIn recommends 50 skills for optimal visibility.',
                    fix: 'Add skills from job descriptions you\'re targeting. Include tools, methodologies, and soft skills.'
                });
            }

            // Job match
            if (atsKeywords.length > 0) {
                const skillsLower = skills.map(s => s.toLowerCase());
                const matches = atsKeywords.filter(kw => skillsLower.some(s => s.includes(kw.toLowerCase())));
                const matchRate = matches.length / atsKeywords.length;
                skillsCriteria.jobMatch = matchRate >= 0.5 ? 5 : (matchRate >= 0.25 ? 3 : 0);
                if (matchRate < 0.5) {
                    fixes.push({
                        severity: 'HIGH',
                        section: 'Skills',
                        problem: 'Skills don\'t match your target job',
                        why: 'Recruiters search for specific skills. Missing key skills = missing opportunities.',
                        fix: `Add missing skills from the job: ${atsKeywords.slice(0, 5).join(', ')}`
                    });
                }
            } else {
                skillsCriteria.jobMatch = 3; // Neutral if no job to compare
            }

            // Top 3 optimized (check if first skills are specific)
            const genericSkills = ['communication', 'leadership', 'teamwork', 'problem solving', 'microsoft office'];
            const topThreeGeneric = skills.slice(0, 3).filter(s =>
                genericSkills.some(g => s.toLowerCase().includes(g))
            ).length;
            skillsCriteria.topThree = topThreeGeneric === 0 ? 3 : (topThreeGeneric === 1 ? 1 : 0);
            if (topThreeGeneric >= 2) {
                fixes.push({
                    severity: 'MEDIUM',
                    section: 'Skills',
                    problem: 'Top skills are too generic',
                    why: 'Your top 3 skills appear first in searches. Generic skills like "Communication" don\'t differentiate you.',
                    fix: 'Pin your most unique, searchable skills to the top: specific tools, certifications, or technical skills'
                });
            }

            // No overly generic
            const genericCount = skills.filter(s => genericSkills.some(g => s.toLowerCase().includes(g))).length;
            skillsCriteria.noGeneric = genericCount <= 3 ? 3 : (genericCount <= 5 ? 1 : 0);

            sectionScores.skills = Object.values(skillsCriteria).reduce((a, b) => a + b, 0);
            sectionDetails.skills = skillsCriteria;

            // ============ FRESHNESS SCORING (10 pts) ============
            const freshCriteria = {};

            if (profile.linkedin_last_updated) {
                const days = (Date.now() - new Date(profile.linkedin_last_updated)) / (1000 * 60 * 60 * 24);
                if (days < 30) {
                    freshCriteria.recentUpdate = 5;
                } else if (days < 90) {
                    freshCriteria.recentUpdate = 3;
                } else {
                    freshCriteria.recentUpdate = 0;
                    fixes.push({
                        severity: 'MEDIUM',
                        section: 'Freshness',
                        problem: 'Profile hasn\'t been updated recently',
                        why: 'LinkedIn\'s algorithm boosts recently updated profiles. Stale profiles rank lower in searches.',
                        fix: 'Make any edit (skill, headline tweak) to refresh your profile. Set a reminder for monthly updates.'
                    });
                }
            } else {
                freshCriteria.recentUpdate = 3;
            }

            // Current role appears current
            const currentRoleDate = currentRole?.dates || '';
            const hasPresent = /present|current|now|\d{4}\s*-\s*$/i.test(currentRoleDate);
            freshCriteria.currentRole = hasPresent ? 3 : 0;

            // Activity signals
            const hasActivity = linkedin.activity?.length > 0 || linkedin.posts?.length > 0;
            freshCriteria.activeSignals = hasActivity ? 2 : 0;

            sectionScores.freshness = Object.values(freshCriteria).reduce((a, b) => a + b, 0);
            sectionDetails.freshness = freshCriteria;

            // ============ RESUME ALIGNMENT SCORING (10 pts) ============
            const alignCriteria = {};

            // Date matching (if we have resume data)
            if (resume.experience?.length > 0 && experience.length > 0) {
                // Basic check - this would need more sophisticated comparison
                alignCriteria.datesMatch = 4; // Assume match if both exist
                alignCriteria.titlesMatch = 3;
                alignCriteria.noGaps = 3;
            } else {
                // No resume to compare - partial credit
                alignCriteria.datesMatch = 2;
                alignCriteria.titlesMatch = 2;
                alignCriteria.noGaps = 2;
                if (!resume.experience) {
                    fixes.push({
                        severity: 'LOW',
                        section: 'Resume Alignment',
                        problem: 'Unable to verify resume alignment',
                        why: 'Discrepancies between LinkedIn and resume are instant red flags for recruiters.',
                        fix: 'Upload your resume to check for date/title mismatches'
                    });
                }
            }

            sectionScores.resumeAlignment = Object.values(alignCriteria).reduce((a, b) => a + b, 0);
            sectionDetails.resumeAlignment = alignCriteria;

            // ============ CREDIBILITY SCORING (5 pts) ============
            const credCriteria = {};

            credCriteria.recommendations = linkedin.recommendations?.length > 0 ? 2 : 0;
            if (!linkedin.recommendations?.length) {
                fixes.push({
                    severity: 'LOW',
                    section: 'Credibility',
                    problem: 'No recommendations',
                    why: 'Recommendations are social proof. They show others vouch for your work.',
                    fix: 'Ask 2-3 colleagues for recommendations. Offer to write theirs first.'
                });
            }

            credCriteria.endorsements = skills.length > 0 ? 1 : 0; // Proxy for endorsements
            credCriteria.featured = linkedin.featured?.length > 0 ? 1 : 0;
            credCriteria.activity = hasActivity ? 1 : 0;

            sectionScores.credibility = Object.values(credCriteria).reduce((a, b) => a + b, 0);
            sectionDetails.credibility = credCriteria;

            // ============ CALCULATE OVERALL SCORE ============
            // Weighted formula
            const overall = Math.round(
                (sectionScores.headline / SECTION_CONFIG.headline.maxPoints) * 20 +
                (sectionScores.about / SECTION_CONFIG.about.maxPoints) * 15 +
                (sectionScores.experience / SECTION_CONFIG.experience.maxPoints) * 25 +
                (sectionScores.skills / SECTION_CONFIG.skills.maxPoints) * 15 +
                (sectionScores.freshness / SECTION_CONFIG.freshness.maxPoints) * 10 +
                (sectionScores.resumeAlignment / SECTION_CONFIG.resumeAlignment.maxPoints) * 10 +
                (sectionScores.credibility / SECTION_CONFIG.credibility.maxPoints) * 5
            );

            // Sort fixes by severity
            fixes.sort((a, b) => SEVERITY[a.severity].order - SEVERITY[b.severity].order);

            return {
                overall,
                sectionScores,
                sectionDetails,
                fixes: fixes.slice(0, 8) // Max 8 fixes to avoid overwhelm
            };
        }

        function displayScore(result) {
            const { overall, sectionScores, sectionDetails, fixes } = result;

            // Update overall score
            document.getElementById('overallScore').textContent = overall;
            document.querySelector('.score-circle').style.setProperty('--score', overall);

            // Set score color based on health
            const scoreCircle = document.querySelector('.score-circle');
            const scoreValue = document.getElementById('overallScore');
            if (overall >= 80) {
                scoreCircle.style.background = `conic-gradient(var(--color-success) ${overall * 3.6}deg, var(--color-surface-elevated) 0deg)`;
                scoreValue.style.color = 'var(--color-success)';
            } else if (overall >= 60) {
                scoreCircle.style.background = `conic-gradient(var(--color-warning) ${overall * 3.6}deg, var(--color-surface-elevated) 0deg)`;
                scoreValue.style.color = 'var(--color-warning)';
            } else {
                scoreCircle.style.background = `conic-gradient(var(--color-error) ${overall * 3.6}deg, var(--color-surface-elevated) 0deg)`;
                scoreValue.style.color = 'var(--color-error)';
            }

            // Set label and summary
            let label, summary;
            if (overall >= 80) {
                label = 'Strong Profile';
                summary = 'Your profile is well-optimized. Focus on the minor improvements below to maximize visibility.';
            } else if (overall >= 60) {
                label = 'Needs Improvement';
                summary = 'Recruiters will find you but may not click. Address the high-priority items below.';
            } else if (overall >= 40) {
                label = 'Needs Work';
                summary = 'Your profile is missing key elements. Fix the critical issues to start getting noticed.';
            } else {
                label = 'Critical Attention Needed';
                summary = 'Your profile isn\'t optimized for recruiter search. Start with the critical items immediately.';
            }

            document.getElementById('scoreLabel').textContent = label;
            document.getElementById('scoreSummary').textContent = summary;

            // Render section cards
            renderSectionCards(sectionScores, sectionDetails);

            // Render breakdown grid (mobile)
            renderBreakdownGrid(sectionScores);

            // Render fix list
            renderFixList(fixes);

            // Add click handlers for expandable cards
            document.querySelectorAll('.section-card-header').forEach(header => {
                header.addEventListener('click', () => {
                    header.closest('.section-card').classList.toggle('expanded');
                });
            });
        }

        function renderSectionCards(sectionScores, sectionDetails) {
            const container = document.getElementById('sectionCards');

            const html = Object.entries(SECTION_CONFIG).map(([key, config]) => {
                const score = sectionScores[key] || 0;
                const details = sectionDetails[key] || {};
                const pct = (score / config.maxPoints) * 100;
                const status = pct >= 80 ? 'good' : pct >= 50 ? 'warning' : 'bad';

                const criteriaHtml = config.criteria.map(c => {
                    const earned = details[c.key] || 0;
                    const valueClass = earned >= c.points ? 'earned' : (earned > 0 ? 'partial' : 'missed');
                    return `
                        <div class="criteria-item">
                            <span class="criteria-label">${c.label}</span>
                            <span class="criteria-value ${valueClass}">${earned}/${c.points}</span>
                        </div>
                    `;
                }).join('');

                return `
                    <div class="section-card ${status}">
                        <div class="section-card-header">
                            <div class="section-card-left">
                                <span class="section-icon">${config.icon}</span>
                                <span class="section-name">${config.name}</span>
                            </div>
                            <div class="section-card-right">
                                <span class="section-score">${score}/${config.maxPoints}</span>
                                <span class="section-chevron">‚ñº</span>
                            </div>
                        </div>
                        <div class="section-card-body">
                            <div class="score-criteria">
                                ${criteriaHtml}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = html;
        }

        function renderBreakdownGrid(sectionScores) {
            const container = document.getElementById('breakdownGrid');

            const html = Object.entries(SECTION_CONFIG).map(([key, config]) => {
                const score = sectionScores[key] || 0;
                const pct = (score / config.maxPoints) * 100;
                const status = pct >= 80 ? 'good' : pct >= 50 ? 'warning' : 'bad';

                return `
                    <div class="breakdown-card ${status}">
                        <div class="breakdown-score">${score}/${config.maxPoints}</div>
                        <div class="breakdown-label">${config.name}</div>
                    </div>
                `;
            }).join('');

            container.innerHTML = html;
        }

        function renderFixList(fixes) {
            const container = document.getElementById('fixListContainer');

            if (fixes.length === 0) {
                container.innerHTML = `
                    <div class="all-good">
                        <div class="all-good-icon">‚úì</div>
                        <h3>Your profile looks solid</h3>
                        <p>No major issues found. Keep your profile fresh by updating every 30 days.</p>
                    </div>
                `;
                return;
            }

            const criticalCount = fixes.filter(f => f.severity === 'CRITICAL').length;
            const highCount = fixes.filter(f => f.severity === 'HIGH').length;
            const countClass = criticalCount > 0 ? '' : (highCount > 0 ? '' : 'success');

            // Generate summary text
            let summaryText = '';
            if (criticalCount > 0) {
                summaryText = `${criticalCount} critical`;
                if (highCount > 0) summaryText += `, ${highCount} high priority`;
            } else if (highCount > 0) {
                summaryText = `${highCount} high priority`;
            } else {
                summaryText = 'Minor improvements';
            }

            container.innerHTML = `
                <div class="fix-section" id="fixSection">
                    <div class="fix-header" id="fixToggle">
                        <div class="fix-header-left">
                            <span class="fix-title">Priority Fix List</span>
                            <span class="fix-count ${countClass}">${fixes.length} items</span>
                        </div>
                        <div class="fix-header-right">
                            <span>${summaryText}</span>
                            <span class="fix-chevron">‚ñº</span>
                        </div>
                    </div>
                    <div class="fix-list">
                        <div class="fix-list-inner">
                            ${fixes.map(fix => {
                                const severity = SEVERITY[fix.severity];
                                return `
                                    <div class="fix-item ${severity.class}">
                                        <div class="fix-item-header">
                                            <span class="fix-item-title">
                                                <span class="priority ${severity.class}">${severity.label}</span>
                                                ${fix.problem}
                                            </span>
                                        </div>
                                        <p class="fix-item-why"><strong>Why it matters:</strong> ${fix.why}</p>
                                        <div class="after">
                                            <div class="after-label">How to fix</div>
                                            <div class="after-text">${fix.fix}</div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                </div>
            `;

            // Add click handler for fix list toggle
            document.getElementById('fixToggle').addEventListener('click', () => {
                document.getElementById('fixSection').classList.toggle('expanded');
            });
        }
    </script>

    <script src="components/ask-henry.js"></script>
    <script src="components/strategy-nav.js"></script>
    <script src="components/status-banner.js"></script>
    <script src="js/linkedin-upload.js"></script>
</body>
</html>
