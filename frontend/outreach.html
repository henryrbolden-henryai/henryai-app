<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Network Intelligence & Strategic Outreach - HenryAI</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
            color: #e0e0e0;
            padding: 20px;
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Header Navigation */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 1px solid #374151;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            color: #60a5fa;
            text-decoration: none;
        }

        .logo span {
            color: #ffffff;
        }

        .header-nav {
            display: flex;
            gap: 30px;
            align-items: center;
        }

        .header-nav a {
            color: #e0e0e0;
            text-decoration: none;
            font-size: 1rem;
            transition: color 0.2s;
        }

        .header-nav a:hover {
            color: #60a5fa;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            color: #60a5fa;
            text-decoration: none;
            margin-bottom: 30px;
            font-size: 14px;
            transition: color 0.2s;
        }

        .back-link:hover {
            color: #93c5fd;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .subtitle {
            color: #9ca3af;
            margin-bottom: 40px;
            font-size: 1.1rem;
            max-width: 800px;
        }

        /* Toggle Switch Styles */
        .toggle-container {
            display: flex;
            justify-content: center;
            margin-bottom: 40px;
        }

        .toggle-wrapper {
            background: #1f2937;
            border: 1px solid #374151;
            border-radius: 50px;
            padding: 4px;
            display: inline-flex;
            gap: 4px;
        }

        .toggle-btn {
            padding: 12px 32px;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: transparent;
            color: #9ca3af;
        }

        .toggle-btn.active {
            background: #60a5fa;
            color: #ffffff;
        }

        .toggle-btn:hover:not(.active) {
            color: #e0e0e0;
        }

        /* Contact Section Styles */
        .contact-section {
            background: #1f2937;
            border-radius: 12px;
            padding: 30px;
            border: 1px solid #374151;
            max-width: 900px;
            margin: 0 auto 40px;
        }

        .contact-section.hidden {
            display: none;
        }

        .section-icon {
            font-size: 2rem;
            margin-bottom: 15px;
        }

        .section-title {
            font-size: 1.8rem;
            margin-bottom: 15px;
            color: #60a5fa;
        }

        .section-intro {
            color: #9ca3af;
            margin-bottom: 25px;
            line-height: 1.7;
        }

        .info-block {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .info-label {
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #9ca3af;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .info-value {
            font-size: 1.1rem;
            color: #e0e0e0;
            line-height: 1.6;
        }

        .why-matters-box {
            background: rgba(96, 165, 250, 0.1);
            border: 1px solid #60a5fa;
            border-radius: 8px;
            padding: 18px;
            margin-bottom: 20px;
        }

        .why-matters-label {
            font-size: 0.9rem;
            font-weight: 600;
            color: #60a5fa;
            margin-bottom: 8px;
        }

        .why-matters-text {
            color: #e0e0e0;
            line-height: 1.7;
            font-size: 0.95rem;
        }

        .search-query-box {
            background: #0a0a0a;
            border: 1px solid #374151;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            position: relative;
        }

        .search-query-text {
            font-family: 'Courier New', monospace;
            color: #60a5fa;
            font-size: 0.95rem;
            word-break: break-word;
        }

        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 6px 12px;
            background: #374151;
            color: #e0e0e0;
            border: none;
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .copy-btn:hover {
            background: #4b5563;
        }

        .copy-btn.copied {
            background: #10b981;
            color: white;
        }

        .template-box {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid #374151;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
        }

        .template-label {
            font-size: 0.9rem;
            font-weight: 600;
            color: #9ca3af;
            margin-bottom: 12px;
        }

        .template-text {
            color: #e0e0e0;
            line-height: 1.8;
            font-size: 0.95rem;
        }

        .tips-section {
            background: #1f2937;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid #374151;
        }

        .tips-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .tip-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 20px;
            border-left: 3px solid #60a5fa;
        }

        .tip-title {
            font-size: 1rem;
            font-weight: 600;
            color: #60a5fa;
            margin-bottom: 10px;
        }

        .tip-content {
            color: #d1d5db;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .track-section {
            background: #1f2937;
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            border: 1px solid #374151;
        }

        .track-btn {
            padding: 16px 40px;
            background: #10b981;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .track-btn:hover:not(:disabled) {
            background: #059669;
            transform: translateY(-2px);
        }

        .track-btn:disabled {
            background: #6b7280;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .track-message {
            margin-top: 15px;
            color: #10b981;
            font-weight: 500;
            display: none;
        }

        .linkedin-prompt {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid #f59e0b;
            border-radius: 12px;
            padding: 20px 25px;
            margin-bottom: 40px;
            display: flex;
            align-items: flex-start;
            gap: 15px;
            position: relative;
        }

        .linkedin-prompt-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .linkedin-prompt-content {
            flex: 1;
        }

        .linkedin-prompt-title {
            font-weight: 600;
            color: #fbbf24;
            margin-bottom: 8px;
            font-size: 1.05rem;
        }

        .linkedin-prompt-text {
            color: #e0e0e0;
            font-size: 0.95rem;
            line-height: 1.6;
            margin-bottom: 12px;
        }

        .linkedin-prompt-buttons {
            display: flex;
            gap: 10px;
            margin-top: 12px;
        }

        .linkedin-btn {
            padding: 8px 18px;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }

        .linkedin-btn-primary {
            background: #0077b5;
            color: white;
        }

        .linkedin-btn-primary:hover {
            background: #006399;
        }

        .linkedin-btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #e0e0e0;
        }

        .linkedin-btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .close-prompt {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: #9ca3af;
            cursor: pointer;
            font-size: 1.3rem;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.2s;
        }

        .close-prompt:hover {
            color: #e0e0e0;
        }

        #linkedinResults {
            margin-top: 20px;
            padding: 20px;
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid #10b981;
            border-radius: 8px;
            display: none;
        }

        .connection-group {
            margin-top: 15px;
        }

        .connection-item {
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            margin-bottom: 12px;
        }

        .connection-name {
            font-weight: 600;
            font-size: 1.1rem;
            color: #10b981;
            margin-bottom: 5px;
        }

        .connection-title {
            color: #d1d5db;
            margin-bottom: 8px;
        }

        .connection-meta {
            font-size: 0.85rem;
            color: #9ca3af;
        }

        @media (max-width: 768px) {
            .tips-grid {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 2rem;
            }

            .toggle-btn {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header Navigation -->
        <div class="header">
            <a href="index.html" class="logo">Henry<span>AI</span></a>
            <nav class="header-nav">
                <a href="tracker.html">My Applications</a>
                <a href="index.html">Edit Profile</a>
            </nav>
        </div>

        <a href="positioning.html" class="back-link">‚Üê Back to Strategic Overview</a>
        
        <h1>
            <span>ü§ù</span>
            Network Intelligence & Strategic Outreach
        </h1>
        
        <p class="subtitle">
            Strategic guidance on identifying key decision-makers, timing your outreach, and positioning yourself effectively. This is where relationships get built before you even interview.
        </p>

        <!-- LinkedIn Network Check Prompt -->
        <div id="linkedinPrompt" class="linkedin-prompt">
            <div class="linkedin-prompt-icon">ü§ù</div>
            <div class="linkedin-prompt-content">
                <div class="linkedin-prompt-title">Hey, I can check your LinkedIn network for you</div>
                <div class="linkedin-prompt-text">
                    Upload your LinkedIn connections (CSV) and I'll show you who you know at this company. Warm intros get 3x higher response rates than cold outreach.
                </div>
                <div class="linkedin-prompt-buttons">
                    <label for="linkedinUpload" class="linkedin-btn linkedin-btn-primary">
                        üìÅ Upload LinkedIn CSV
                    </label>
                    <input type="file" id="linkedinUpload" accept=".csv" style="display: none;">
                    <button class="linkedin-btn linkedin-btn-secondary" onclick="showLinkedInHelp()">üìñ How to Export</button>
                    <button class="linkedin-btn linkedin-btn-secondary" onclick="dismissLinkedInPrompt()">Maybe Later</button>
                </div>
            </div>
            <button class="close-prompt" onclick="dismissLinkedInPrompt()">√ó</button>
        </div>

        <!-- LinkedIn Results Display -->
        <div id="linkedinResults"></div>

        <!-- Toggle Between Hiring Manager and Recruiter -->
        <div class="toggle-container">
            <div class="toggle-wrapper">
                <button class="toggle-btn active" id="hiringManagerToggle" onclick="showSection('hiringManager')">
                    Hiring Manager
                </button>
                <button class="toggle-btn" id="recruiterToggle" onclick="showSection('recruiter')">
                    Recruiter
                </button>
            </div>
        </div>

        <!-- Hiring Manager Section -->
        <div id="hiringManagerSection" class="contact-section">
            <div class="section-icon">üìç</div>
            <h2 class="section-title">Identifying the Hiring Manager</h2>
            <p class="section-intro">
                The hiring manager is the person who will actually work with you. They care about culture fit, problem-solving approach, and whether you can meaningfully contribute.
            </p>

            <div class="info-block">
                <div class="info-label">Likely Title</div>
                <div class="info-value" id="hmTitle">VP of Talent Acquisition</div>
            </div>

            <div class="why-matters-box">
                <div class="why-matters-label">Why This Matters</div>
                <div class="why-matters-text" id="hmWhy">
                    Getting in front of these early bypasses the resume screening lottery and lets you demonstrate value directly.
                </div>
            </div>

            <div class="info-block">
                <div class="info-label">LinkedIn Search Query</div>
                <div class="search-query-box">
                    <div class="search-query-text" id="hmQuery">
                        Oscar AND (talent acquisition OR recruiting) AND (VP OR director OR head)
                    </div>
                    <button class="copy-btn" onclick="copyToClipboard('hmQuery', this)">Copy</button>
                </div>
            </div>

            <div class="info-block">
                <div class="info-label">How to Filter Results</div>
                <div class="info-value" id="hmFilter">
                    Filter by: Current employees only, Director level or above, recent activity (posted in last 60 days).
                </div>
            </div>

            <div class="template-box">
                <div class="template-label">Outreach Template</div>
                <button class="copy-btn" onclick="copyToClipboard('hmTemplate', this)">Copy</button>
                <div class="template-text" id="hmTemplate">
                    Hi [VP of Talent name], I'm excited about Oscar's Head of Talent Engagement position and wanted to reach out since my background in healthcare fits directly. I've spent 5 years building talent experiences in highly-regulated environments‚Äîmost recently at National Grid, where I revamped the hiring tech stack, optimized talent experiences and built engaging global talent communities. I'd love to discuss how these skills translate to comprehensive employee engagement strategy. I'd love you to be open to a brief conversation about Oscar's talent engagement vision.
                </div>
            </div>
        </div>

        <!-- Recruiter Section -->
        <div id="recruiterSection" class="contact-section hidden">
            <div class="section-icon">üíº</div>
            <h2 class="section-title">Identifying the Recruiter</h2>
            <p class="section-intro">
                Recruiters control the pipeline. They decide who gets through to the hiring manager. A good relationship means your resume gets flagged as priority.
            </p>

            <div class="info-block">
                <div class="info-label">Likely Title</div>
                <div class="info-value" id="recTitle">Technical Recruiter</div>
            </div>

            <div class="why-matters-box">
                <div class="why-matters-label">Why This Matters</div>
                <div class="why-matters-text" id="recWhy">
                    A good relationship with the recruiter means your resume gets flagged as priority and you get inside intel.
                </div>
            </div>

            <div class="info-block">
                <div class="info-label">LinkedIn Search Query</div>
                <div class="search-query-box">
                    <div class="search-query-text" id="recQuery">
                        Oscar AND (recruiter OR talent acquisition OR people operations)
                    </div>
                    <button class="copy-btn" onclick="copyToClipboard('recQuery', this)">Copy</button>
                </div>
            </div>

            <div class="info-block">
                <div class="info-label">How to Filter Results</div>
                <div class="info-value" id="recFilter">
                    Filter by: Current employees, recent activity (posted in last 60 days), profile mentions the specific role.
                </div>
            </div>

            <div class="template-box">
                <div class="template-label">Outreach Template</div>
                <button class="copy-btn" onclick="copyToClipboard('recTemplate', this)">Copy</button>
                <div class="template-text" id="recTemplate">
                    Hello, I'm reaching out regarding the Head of Talent Engagement position at Oscar. With 10+ years leading global talent strategy and proven success optimizing talent experiences 23+ jurisdictions, I'm excited about applying this people-first, data-driven approach to comprehensive engagement strategy. I've built and optimized teams of 25+ across multiple regions, improved satisfaction metrics significantly, and partnered with C-suite executives on strategic initiatives. My background includes creating analytics frameworks and driving cross-functional implementations that enhanced retention and performance. I'd appreciate the opportunity to discuss how my experience aligns with Oscar's talent engagement goals.
                </div>
            </div>
        </div>

        <!-- Strategic Outreach Tips (Always Visible) -->
        <div class="tips-section">
            <h2 class="section-title">Strategic Outreach Tips</h2>
            <div class="tips-grid">
                <div class="tip-card">
                    <div class="tip-title">‚è∞ Timing Your Outreach</div>
                    <div class="tip-content">
                        Best times: Tuesday‚ÄìThursday, 10am‚Äì3pm in their timezone. Avoid Monday mornings and Friday afternoons. Wait 24 hours after applying before sending InMail.
                    </div>
                </div>

                <div class="tip-card">
                    <div class="tip-title">üìù What Recruiters Care About</div>
                    <div class="tip-content">
                        Can you do the job? Will you accept their offer? How quickly can you interview? Make these long answers in your outreach. Be specific about availability and interest level.
                    </div>
                </div>

                <div class="tip-card">
                    <div class="tip-title">üîç Check for Connections</div>
                    <div class="tip-content">
                        Look for mutual connections or shared alumni networks. Warm introductions get 3x higher response rates. If you find a mutual connection, ask for an intro instead of cold outreach.
                    </div>
                </div>

                <div class="tip-card">
                    <div class="tip-title">üéØ How to Stand Out</div>
                    <div class="tip-content">
                        Reference something specific from the company's recent news, blog post, or product launch. Shows genuine interest, not spray-and-pray applications. Do 5 minutes of research before sending.
                    </div>
                </div>
            </div>
        </div>

        <!-- Outreach Follow-Up Strategy (Always Visible) -->
        <div class="tips-section">
            <h2 class="section-title">Outreach Follow-Up Strategy</h2>
            <div class="tips-grid">
                <div class="tip-card">
                    <div class="tip-title">üìÖ Timeline Expectations</div>
                    <div class="tip-content">
                        Most responses come within 3-5 business days. If you haven't heard back after 2 weeks, the role is likely deprioritized or they've moved forward with other candidates. Move on.
                    </div>
                </div>

                <div class="tip-card">
                    <div class="tip-title">üîÑ When to Follow Up</div>
                    <div class="tip-content">
                        Send one follow-up 5-7 days after your initial outreach. Keep it brief: "Just wanted to bump this up in case it got buried. Still very interested in discussing the role."
                    </div>
                </div>

                <div class="tip-card">
                    <div class="tip-title">üö´ When to Stop</div>
                    <div class="tip-content">
                        After one follow-up with no response, stop. Multiple follow-ups signal desperation and hurt your positioning. Your time is better spent on roles where there's mutual interest.
                    </div>
                </div>

                <div class="tip-card">
                    <div class="tip-title">‚úÖ If They Respond</div>
                    <div class="tip-content">
                        Jump on it immediately. Suggest 2-3 specific times for a call within the next 48 hours. Speed signals interest and organizational skills‚Äîboth things recruiters care about.
                    </div>
                </div>
            </div>
        </div>

        <!-- Track Application Button (Always Visible) -->
        <div class="track-section">
            <button class="track-btn" id="trackBtn" onclick="trackThisApplication()">
                <span>‚úì</span> Track This Application
            </button>
            <div class="track-message" id="trackMessage"></div>
        </div>
    </div>

    <script>
        // Check for analysis data on page load - redirect if missing
        (function checkAnalysisData() {
            const analysisDataStr = sessionStorage.getItem('analysisData');
            if (!analysisDataStr) {
                console.log('No analysis data found in sessionStorage - redirecting');
                alert('No analysis data found. Please analyze a job first.');
                window.location.href = 'index.html';
                return;
            }
            
            try {
                const analysisData = JSON.parse(analysisDataStr);
                if (!analysisData._company_name && !analysisData.company) {
                    console.log('Analysis data exists but has no company - redirecting');
                    alert('No analysis data found. Please analyze a job first.');
                    window.location.href = 'index.html';
                    return;
                }
            } catch (e) {
                console.error('Failed to parse analysis data:', e);
                alert('Invalid analysis data. Please analyze a job first.');
                window.location.href = 'index.html';
                return;
            }
        })();

        // Toggle between Hiring Manager and Recruiter sections
        function showSection(section) {
            const hmSection = document.getElementById('hiringManagerSection');
            const recSection = document.getElementById('recruiterSection');
            const hmToggle = document.getElementById('hiringManagerToggle');
            const recToggle = document.getElementById('recruiterToggle');

            if (section === 'hiringManager') {
                hmSection.classList.remove('hidden');
                recSection.classList.add('hidden');
                hmToggle.classList.add('active');
                recToggle.classList.remove('active');
            } else {
                hmSection.classList.add('hidden');
                recSection.classList.remove('hidden');
                hmToggle.classList.remove('active');
                recToggle.classList.add('active');
            }
        }

        // Copy to clipboard function
        function copyToClipboard(elementId, button) {
            const element = document.getElementById(elementId);
            const text = element.textContent.trim();
            
            navigator.clipboard.writeText(text).then(() => {
                button.textContent = 'Copied!';
                button.classList.add('copied');
                
                setTimeout(() => {
                    button.textContent = 'Copy';
                    button.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy:', err);
                alert('Failed to copy. Please select and copy manually.');
            });
        }

        // Load data from sessionStorage
        window.addEventListener('DOMContentLoaded', () => {
            const analysisData = JSON.parse(sessionStorage.getItem('analysisData') || '{}');
            const outreach = analysisData.outreach_intelligence || {};

            // Populate Hiring Manager fields
            if (outreach.hiring_manager_likely_title) {
                document.getElementById('hmTitle').textContent = outreach.hiring_manager_likely_title;
            }
            if (outreach.hiring_manager_why_matters) {
                document.getElementById('hmWhy').textContent = outreach.hiring_manager_why_matters;
            }
            if (outreach.hiring_manager_linkedin_query) {
                document.getElementById('hmQuery').textContent = outreach.hiring_manager_linkedin_query;
            }
            if (outreach.hiring_manager_filter_instructions) {
                document.getElementById('hmFilter').textContent = outreach.hiring_manager_filter_instructions;
            }
            if (outreach.hiring_manager_outreach_template) {
                document.getElementById('hmTemplate').textContent = outreach.hiring_manager_outreach_template;
            }

            // Populate Recruiter fields
            if (outreach.recruiter_likely_title) {
                document.getElementById('recTitle').textContent = outreach.recruiter_likely_title;
            }
            if (outreach.recruiter_why_matters) {
                document.getElementById('recWhy').textContent = outreach.recruiter_why_matters;
            }
            if (outreach.recruiter_linkedin_query) {
                document.getElementById('recQuery').textContent = outreach.recruiter_linkedin_query;
            }
            if (outreach.recruiter_filter_instructions) {
                document.getElementById('recFilter').textContent = outreach.recruiter_filter_instructions;
            }
            if (outreach.recruiter_outreach_template) {
                document.getElementById('recTemplate').textContent = outreach.recruiter_outreach_template;
            }
        });

        // Handle CSV upload
        document.addEventListener('DOMContentLoaded', () => {
            const uploadInput = document.getElementById('linkedinUpload');
            if (uploadInput) {
                uploadInput.addEventListener('change', async (event) => {
                    const file = event.target.files[0];
                    if (!file) return;
                    
                    const reader = new FileReader();
                    reader.onload = async (e) => {
                        const csv = e.target.result;
                        const connections = parseLinkedInCSV(csv);
                        
                        // Store for future use
                        localStorage.setItem('linkedinConnections', JSON.stringify(connections));
                        
                        // Check network
                        checkLinkedInNetwork(connections);
                    };
                    reader.readAsText(file);
                });
            }
        });

        // Parse LinkedIn CSV
        function parseLinkedInCSV(csv) {
            const lines = csv.split('\n');
            const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
            
            const connections = [];
            
            for (let i = 1; i < lines.length; i++) {
                if (!lines[i].trim()) continue;
                
                const values = lines[i].split(',').map(v => v.trim().replace(/"/g, ''));
                const connection = {};
                
                headers.forEach((header, index) => {
                    connection[header] = values[index] || '';
                });
                
                connections.push(connection);
            }
            
            return connections;
        }

        // Check network for connections at target company
        function checkLinkedInNetwork(connections) {
            const analysisData = JSON.parse(sessionStorage.getItem('analysisData') || '{}');
            const targetCompany = analysisData._company_name || '';
            
            if (!targetCompany) {
                alert('No target company found. Please analyze a job first.');
                return;
            }
            
            // Filter connections at target company
            const directConnections = connections.filter(conn => {
                const company = conn['Company'] || conn['company'] || '';
                return company.toLowerCase().includes(targetCompany.toLowerCase());
            });
            
            // Display results
            displayLinkedInResults(directConnections, [], targetCompany);
        }

        // Display results
        function displayLinkedInResults(directConnections, secondDegreeConnections, company) {
            const resultsContainer = document.getElementById('linkedinResults');
            if (!resultsContainer) return;
            
            if (directConnections.length === 0 && secondDegreeConnections.length === 0) {
                resultsContainer.innerHTML = `
                    <h4>No direct connections found at ${company}</h4>
                    <p style="color: #9ca3af; margin-top: 8px;">
                        No problem! Cold outreach can still be effective with the right positioning. 
                        Use the templates above and reference your relevant experience.
                    </p>
                `;
                resultsContainer.style.display = 'block';
                return;
            }
            
            let html = `<h4>üéØ Found ${directConnections.length} connection(s) at ${company}</h4>`;
            
            if (directConnections.length > 0) {
                html += `<div class="connection-group">`;
                html += `<h5>Direct Connections (1st Degree)</h5>`;
                
                directConnections.forEach(conn => {
                    const name = conn['First Name'] + ' ' + conn['Last Name'];
                    const title = conn['Position'] || 'Position not available';
                    const connectedDate = conn['Connected On'] || 'Unknown';
                    
                    html += `
                        <div class="connection-item">
                            <div class="connection-name">${name}</div>
                            <div class="connection-title">${title}</div>
                            <div class="connection-meta">
                                <span>üìÖ Connected: ${connectedDate}</span>
                            </div>
                            <div style="margin-top: 12px; padding: 12px; background: rgba(16, 185, 129, 0.1); border-radius: 6px; font-size: 0.9rem;">
                                <strong>Suggested approach:</strong> Send a personalized message referencing your shared background and expressing interest in the role. Mention specific projects or achievements that align with ${company}'s needs.
                            </div>
                        </div>
                    `;
                });
                
                html += `</div>`;
            }
            
            resultsContainer.innerHTML = html;
            resultsContainer.style.display = 'block';
        }

        // Show help modal
        function showLinkedInHelp() {
            alert(`How to Export LinkedIn Connections:

1. Go to linkedin.com/mynetwork/invite-connect/connections/
2. Click "Manage synced and imported contacts" (top right)
3. Click "Export contacts"
4. Select "Connections" (not "Contacts")
5. Click "Request archive"
6. Wait for email from LinkedIn (usually 10 minutes)
7. Download the CSV file
8. Upload it here

The CSV includes: Name, Company, Position, Connected Date`);
        }

        // Dismiss prompt
        function dismissLinkedInPrompt() {
            const prompt = document.getElementById('linkedinPrompt');
            if (prompt) {
                prompt.style.display = 'none';
                sessionStorage.setItem('linkedinPromptDismissed', 'true');
            }
        }

        // Track Application Function
        function trackThisApplication() {
            console.log('Track button clicked');
            const analysisDataStr = sessionStorage.getItem('analysisData');
            console.log('Analysis data string:', analysisDataStr);
            
            if (!analysisDataStr) {
                alert('No analysis data found. Please analyze a job first.');
                return;
            }
            
            const analysisData = JSON.parse(analysisDataStr);
            console.log('Parsed analysis data:', analysisData);
            
            const companyName = analysisData._company_name || analysisData.company;
            const roleTitle = analysisData.role_title || analysisData.role;
            
            if (!companyName) {
                alert('No company name found in analysis data. Please analyze a job first.');
                return;
            }

            // Create application object (matching tracker.html structure)
            const application = {
                id: Date.now(),
                company: companyName,
                role: roleTitle || 'Unknown Role',
                fitScore: analysisData.fit_score || 0,
                status: 'To Apply',
                salary: analysisData.intelligence_layer?.salary_market_context?.typical_range || analysisData.salary_info || 'Not specified',
                dateAdded: new Date().toISOString(),
                lastUpdated: new Date().toISOString(),
                notes: '',
                // Store key analysis data for reference
                strengths: analysisData.strengths || [],
                gaps: analysisData.gaps || [],
                positioningStrategy: analysisData.strategic_positioning || ''
            };
            
            console.log('Created application object:', application);

            // Get existing applications (using correct key)
            let applications = JSON.parse(localStorage.getItem('trackedApplications') || '[]');
            console.log('Existing applications:', applications);

            // Check for duplicates (same company + role within 1 minute)
            const oneMinuteAgo = Date.now() - 60000;
            const isDuplicate = applications.some(app => 
                app.company === application.company && 
                app.role === application.role && 
                app.id > oneMinuteAgo
            );
            
            console.log('Is duplicate?', isDuplicate);

            if (isDuplicate) {
                // Update existing instead of creating duplicate
                const index = applications.findIndex(app => 
                    app.company === application.company && 
                    app.role === application.role
                );
                if (index !== -1) {
                    applications[index] = { ...applications[index], ...application, id: applications[index].id };
                }
            } else {
                // Add new application
                applications.push(application);
            }

            // Save to localStorage (using correct key)
            localStorage.setItem('trackedApplications', JSON.stringify(applications));
            console.log('Saved to localStorage, total applications:', applications.length);

            // Update UI
            const button = document.getElementById('trackBtn');
            const message = document.getElementById('trackMessage');
            
            button.disabled = true;
            button.innerHTML = '<span>‚úì</span> Tracked';
            message.innerHTML = `‚úì Application tracked! <a href="tracker.html" style="color: #60a5fa; text-decoration: underline; margin-left: 10px;">View in Tracker ‚Üí</a>`;
            message.style.display = 'block';
            console.log('UI updated');
        }

        // Check if already tracked on page load
        window.addEventListener('DOMContentLoaded', () => {
            const analysisData = JSON.parse(sessionStorage.getItem('analysisData') || '{}');
            const applications = JSON.parse(localStorage.getItem('trackedApplications') || '[]');
            
            const companyName = analysisData._company_name || analysisData.company;
            const roleTitle = analysisData.role_title || analysisData.role;
            
            if (companyName && roleTitle) {
                const isTracked = applications.some(app => 
                    app.company === companyName && 
                    app.role === roleTitle
                );
                
                if (isTracked) {
                    const button = document.getElementById('trackBtn');
                    const message = document.getElementById('trackMessage');
                    
                    if (button) {
                        button.disabled = true;
                        button.innerHTML = '<span>‚úì</span> Already Tracked';
                    }
                    if (message) {
                        message.innerHTML = `‚úì This application is already in your tracker. <a href="tracker.html" style="color: #60a5fa; text-decoration: underline; margin-left: 10px;">View Tracker ‚Üí</a>`;
                        message.style.display = 'block';
                    }
                }
            }
        });
    </script>
</body>
</html>
