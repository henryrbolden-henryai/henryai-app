<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Network Intelligence & Strategic Outreach - HenryAI</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
            color: #e0e0e0;
            padding: 20px;
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Header Navigation */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 1px solid #374151;
        }

        .logo {
            font-family: 'Instrument Serif', Georgia, serif;
            font-size: 1.5rem;
            color: #ffffff;
            text-decoration: none;
        }

        .logo em {
            font-style: italic;
            color: #22d3ee;
        }

        .header-nav {
            display: flex;
            gap: 30px;
            align-items: center;
        }

        .header-nav a {
            color: #e0e0e0;
            text-decoration: none;
            font-size: 1rem;
            transition: color 0.2s;
        }

        .header-nav a:hover {
            color: #60a5fa;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            color: #60a5fa;
            text-decoration: none;
            margin-bottom: 30px;
            font-size: 14px;
            transition: color 0.2s;
        }

        .back-link:hover {
            color: #93c5fd;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .subtitle {
            color: #9ca3af;
            margin-bottom: 40px;
            font-size: 1.1rem;
            max-width: 800px;
        }

        /* Toggle Switch Styles */
        .toggle-container {
            display: flex;
            justify-content: center;
            margin-bottom: 40px;
        }

        .toggle-wrapper {
            background: #1f2937;
            border: 1px solid #374151;
            border-radius: 50px;
            padding: 4px;
            display: inline-flex;
            gap: 4px;
        }

        .toggle-btn {
            padding: 12px 32px;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: transparent;
            color: #9ca3af;
        }

        .toggle-btn.active {
            background: #60a5fa;
            color: #ffffff;
        }

        .toggle-btn:hover:not(.active) {
            color: #e0e0e0;
        }

        /* Contact Section Styles */
        .contact-section {
            background: #1f2937;
            border-radius: 12px;
            padding: 30px;
            border: 1px solid #374151;
            max-width: 900px;
            margin: 0 auto 40px;
        }

        .contact-section.hidden {
            display: none;
        }

        .section-icon {
            font-size: 2rem;
            margin-bottom: 15px;
        }

        .section-title {
            font-size: 1.8rem;
            margin-bottom: 15px;
            color: #60a5fa;
        }

        .section-intro {
            color: #9ca3af;
            margin-bottom: 25px;
            line-height: 1.7;
        }

        .info-block {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .info-label {
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #9ca3af;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .info-value {
            font-size: 1.1rem;
            color: #e0e0e0;
            line-height: 1.6;
        }

        .why-matters-box {
            background: rgba(96, 165, 250, 0.1);
            border: 1px solid #60a5fa;
            border-radius: 8px;
            padding: 18px;
            margin-bottom: 20px;
        }

        .why-matters-label {
            font-size: 0.9rem;
            font-weight: 600;
            color: #60a5fa;
            margin-bottom: 8px;
        }

        .why-matters-text {
            color: #e0e0e0;
            line-height: 1.7;
            font-size: 0.95rem;
        }

        .search-query-box {
            background: #0a0a0a;
            border: 1px solid #374151;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            position: relative;
        }

        .search-query-text {
            font-family: 'Courier New', monospace;
            color: #60a5fa;
            font-size: 0.95rem;
            word-break: break-word;
        }

        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 6px 12px;
            background: #374151;
            color: #e0e0e0;
            border: none;
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .copy-btn:hover {
            background: #4b5563;
        }

        .copy-btn.copied {
            background: #10b981;
            color: white;
        }

        .template-box {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid #374151;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
        }

        .template-label {
            font-size: 0.9rem;
            font-weight: 600;
            color: #9ca3af;
            margin-bottom: 12px;
        }

        .template-text {
            color: #e0e0e0;
            line-height: 1.8;
            font-size: 0.95rem;
        }

        .tips-section {
            background: #1f2937;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid #374151;
        }

        .tips-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .tip-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 20px;
            border-left: 3px solid #60a5fa;
        }

        .tip-title {
            font-size: 1rem;
            font-weight: 600;
            color: #60a5fa;
            margin-bottom: 10px;
        }

        .tip-content {
            color: #d1d5db;
            font-size: 0.9rem;
            line-height: 1.6;
        }


        .linkedin-prompt {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid #f59e0b;
            border-radius: 12px;
            padding: 20px 25px;
            margin-bottom: 40px;
            display: flex;
            align-items: flex-start;
            gap: 15px;
            position: relative;
        }

        .linkedin-prompt-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .linkedin-prompt-content {
            flex: 1;
        }

        .linkedin-prompt-title {
            font-weight: 600;
            color: #fbbf24;
            margin-bottom: 8px;
            font-size: 1.05rem;
        }

        .linkedin-prompt-text {
            color: #e0e0e0;
            font-size: 0.95rem;
            line-height: 1.6;
            margin-bottom: 12px;
        }

        .linkedin-prompt-buttons {
            display: flex;
            gap: 10px;
            margin-top: 12px;
        }

        .linkedin-btn {
            padding: 8px 18px;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }

        .linkedin-btn-primary {
            background: #0077b5;
            color: white;
        }

        .linkedin-btn-primary:hover {
            background: #006399;
        }

        .linkedin-btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #e0e0e0;
        }

        .linkedin-btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .close-prompt {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: #9ca3af;
            cursor: pointer;
            font-size: 1.3rem;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.2s;
        }

        .close-prompt:hover {
            color: #e0e0e0;
        }

        #linkedinResults {
            margin-top: 20px;
            padding: 20px;
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid #10b981;
            border-radius: 8px;
            display: none;
        }

        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: #10b981;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Hiring Velocity Section */
        .hiring-velocity-section {
            background: linear-gradient(135deg, #1e3a5f 0%, #1a2e44 100%);
            border: 1px solid #3b82f6;
            border-radius: 12px;
            padding: 24px 28px;
            margin-bottom: 30px;
        }

        .velocity-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .velocity-icon {
            font-size: 1.5rem;
        }

        .velocity-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #ffffff;
        }

        .velocity-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .velocity-stat {
            text-align: center;
            padding: 16px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        .velocity-number {
            font-size: 2rem;
            font-weight: 700;
            color: #60a5fa;
            margin-bottom: 4px;
        }

        .velocity-label {
            font-size: 0.85rem;
            color: #9ca3af;
        }

        .velocity-insight {
            margin-top: 16px;
            padding: 12px 16px;
            background: rgba(96, 165, 250, 0.1);
            border-left: 3px solid #60a5fa;
            border-radius: 0 8px 8px 0;
            color: #d1d5db;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        @media (max-width: 768px) {
            .velocity-grid {
                grid-template-columns: 1fr;
            }
        }

        /* LinkedIn Value Diagram */
        .linkedin-value-section {
            background: #1f2937;
            border: 1px solid #374151;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 30px;
        }

        .linkedin-value-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .network-flow {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin: 24px 0;
            flex-wrap: wrap;
        }

        .flow-node {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 16px 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            min-width: 100px;
        }

        .flow-node.highlight {
            background: rgba(16, 185, 129, 0.15);
            border: 1px solid #10b981;
        }

        .flow-node-icon {
            font-size: 1.8rem;
        }

        .flow-node-label {
            font-size: 0.85rem;
            color: #d1d5db;
            text-align: center;
        }

        .flow-arrow {
            font-size: 1.5rem;
            color: #6b7280;
        }

        .linkedin-stats {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #374151;
        }

        .linkedin-stat {
            text-align: center;
        }

        .linkedin-stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #10b981;
        }

        .linkedin-stat-label {
            font-size: 0.8rem;
            color: #9ca3af;
        }

        .connection-group {
            margin-top: 15px;
        }

        .connection-item {
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            margin-bottom: 12px;
        }

        .connection-name {
            font-weight: 600;
            font-size: 1.1rem;
            color: #10b981;
            margin-bottom: 5px;
        }

        .connection-title {
            color: #d1d5db;
            margin-bottom: 8px;
        }

        .connection-meta {
            font-size: 0.85rem;
            color: #9ca3af;
        }

        @media (max-width: 768px) {
            .tips-grid {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 2rem;
            }

            .toggle-btn {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header Navigation -->
        <div class="header">
            <a href="index.html" class="logo"><em>Henry</em>AI</a>
            <nav class="header-nav">
                <a href="tracker.html">My Applications</a>
                <a href="index.html">Edit Profile</a>
            </nav>
        </div>

        <a href="positioning.html" class="back-link">‚Üê Back to Strategic Overview</a>
        
        <h1>
            <span>ü§ù</span>
            Network Intelligence & Strategic Outreach
        </h1>
        
        <p class="subtitle">
            Strategic guidance on identifying key decision-makers, timing your outreach, and positioning yourself effectively. This is where relationships get built before you even interview.
        </p>

        <!-- Hiring Velocity Section -->
        <div class="hiring-velocity-section" id="hiringVelocitySection">
            <div class="velocity-header">
                <span class="velocity-icon">üìà</span>
                <h3 class="velocity-title">Hiring Velocity at <span id="velocityCompanyName">this company</span></h3>
            </div>
            <div class="velocity-grid">
                <div class="velocity-stat">
                    <div class="velocity-number" id="openRolesCount">--</div>
                    <div class="velocity-label">Open Roles</div>
                </div>
                <div class="velocity-stat">
                    <div class="velocity-number" id="departmentRoles">--</div>
                    <div class="velocity-label">In Your Department</div>
                </div>
                <div class="velocity-stat">
                    <div class="velocity-number" id="hiringSignal">--</div>
                    <div class="velocity-label">Hiring Signal</div>
                </div>
            </div>
            <div class="velocity-insight" id="velocityInsight">
                Loading hiring insights...
            </div>
        </div>

        <!-- LinkedIn Value Explanation -->
        <div class="linkedin-value-section" id="linkedinValueSection">
            <div class="linkedin-value-title">
                <span>üîó</span> Why Upload Your LinkedIn Connections?
            </div>
            <div class="network-flow">
                <div class="flow-node">
                    <div class="flow-node-icon">üë§</div>
                    <div class="flow-node-label">Your Network</div>
                </div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-node highlight">
                    <div class="flow-node-icon">ü§ù</div>
                    <div class="flow-node-label">Warm Intro</div>
                </div>
                <div class="flow-arrow">‚Üí</div>
                <div class="flow-node">
                    <div class="flow-node-icon">üéØ</div>
                    <div class="flow-node-label">Hiring Manager</div>
                </div>
            </div>
            <div class="linkedin-stats">
                <div class="linkedin-stat">
                    <div class="linkedin-stat-value">3x</div>
                    <div class="linkedin-stat-label">Higher response rate<br>with warm intros</div>
                </div>
                <div class="linkedin-stat">
                    <div class="linkedin-stat-value">40%</div>
                    <div class="linkedin-stat-label">Of hires come from<br>referrals</div>
                </div>
            </div>
        </div>

        <!-- LinkedIn Network Check Prompt -->
        <div id="linkedinPrompt" class="linkedin-prompt">
            <div class="linkedin-prompt-icon">ü§ù</div>
            <div class="linkedin-prompt-content">
                <div class="linkedin-prompt-title">Hey, I can check your LinkedIn network for you</div>
                <div class="linkedin-prompt-text">
                    Upload your LinkedIn connections (CSV) and I'll show you who you know at this company. Warm intros get 3x higher response rates than cold outreach.
                </div>
                <div class="linkedin-prompt-buttons">
                    <label for="linkedinUpload" class="linkedin-btn linkedin-btn-primary">
                        üìÅ Upload LinkedIn CSV
                    </label>
                    <input type="file" id="linkedinUpload" accept=".csv" style="display: none;">
                    <button class="linkedin-btn linkedin-btn-secondary" onclick="showLinkedInHelp()">üìñ How to Export</button>
                    <button class="linkedin-btn linkedin-btn-secondary" onclick="dismissLinkedInPrompt()">Maybe Later</button>
                </div>
            </div>
            <button class="close-prompt" onclick="dismissLinkedInPrompt()">√ó</button>
        </div>

        <!-- LinkedIn Results Display -->
        <div id="linkedinResults"></div>

        <!-- Toggle Between Hiring Manager and Recruiter -->
        <div class="toggle-container">
            <div class="toggle-wrapper">
                <button class="toggle-btn active" id="hiringManagerToggle" onclick="showSection('hiringManager')">
                    Hiring Manager
                </button>
                <button class="toggle-btn" id="recruiterToggle" onclick="showSection('recruiter')">
                    Recruiter
                </button>
            </div>
        </div>

        <!-- Hiring Manager Section -->
        <div id="hiringManagerSection" class="contact-section">
            <div class="section-icon">üìç</div>
            <h2 class="section-title">Identifying the Hiring Manager</h2>
            <p class="section-intro">
                The hiring manager is the person who will actually work with you. They care about culture fit, problem-solving approach, and whether you can meaningfully contribute.
            </p>

            <div class="info-block">
                <div class="info-label">Likely Title</div>
                <div class="info-value" id="hmTitle">VP of Talent Acquisition</div>
            </div>

            <div class="why-matters-box">
                <div class="why-matters-label">Why This Matters</div>
                <div class="why-matters-text" id="hmWhy">
                    Getting in front of these early bypasses the resume screening lottery and lets you demonstrate value directly.
                </div>
            </div>

            <div class="info-block">
                <div class="info-label">LinkedIn Search Query</div>
                <div class="search-query-box">
                    <div class="search-query-text" id="hmQuery">
                        Oscar AND (talent acquisition OR recruiting) AND (VP OR director OR head)
                    </div>
                    <button class="copy-btn" onclick="copyToClipboard('hmQuery', this)">Copy</button>
                </div>
            </div>

            <div class="info-block">
                <div class="info-label">How to Filter Results</div>
                <div class="info-value" id="hmFilter">
                    Filter by: Current employees only, Director level or above, recent activity (posted in last 60 days).
                </div>
            </div>

            <div class="template-box">
                <div class="template-label">Outreach Template</div>
                <button class="copy-btn" onclick="copyToClipboard('hmTemplate', this)">Copy</button>
                <div class="template-text" id="hmTemplate">
                    Hi [VP of Talent name], I'm excited about Oscar's Head of Talent Engagement position and wanted to reach out since my background in healthcare fits directly. I've spent 5 years building talent experiences in highly-regulated environments‚Äîmost recently at National Grid, where I revamped the hiring tech stack, optimized talent experiences and built engaging global talent communities. I'd love to discuss how these skills translate to comprehensive employee engagement strategy. I'd love you to be open to a brief conversation about Oscar's talent engagement vision.
                </div>
            </div>
        </div>

        <!-- Recruiter Section -->
        <div id="recruiterSection" class="contact-section hidden">
            <div class="section-icon">üíº</div>
            <h2 class="section-title">Identifying the Recruiter</h2>
            <p class="section-intro">
                Recruiters control the pipeline. They decide who gets through to the hiring manager. A good relationship means your resume gets flagged as priority.
            </p>

            <div class="info-block">
                <div class="info-label">Likely Title</div>
                <div class="info-value" id="recTitle">Technical Recruiter</div>
            </div>

            <div class="why-matters-box">
                <div class="why-matters-label">Why This Matters</div>
                <div class="why-matters-text" id="recWhy">
                    A good relationship with the recruiter means your resume gets flagged as priority and you get inside intel.
                </div>
            </div>

            <div class="info-block">
                <div class="info-label">LinkedIn Search Query</div>
                <div class="search-query-box">
                    <div class="search-query-text" id="recQuery">
                        Oscar AND (recruiter OR talent acquisition OR people operations)
                    </div>
                    <button class="copy-btn" onclick="copyToClipboard('recQuery', this)">Copy</button>
                </div>
            </div>

            <div class="info-block">
                <div class="info-label">How to Filter Results</div>
                <div class="info-value" id="recFilter">
                    Filter by: Current employees, recent activity (posted in last 60 days), profile mentions the specific role.
                </div>
            </div>

            <div class="template-box">
                <div class="template-label">Outreach Template</div>
                <button class="copy-btn" onclick="copyToClipboard('recTemplate', this)">Copy</button>
                <div class="template-text" id="recTemplate">
                    Hello, I'm reaching out regarding the Head of Talent Engagement position at Oscar. With 10+ years leading global talent strategy and proven success optimizing talent experiences 23+ jurisdictions, I'm excited about applying this people-first, data-driven approach to comprehensive engagement strategy. I've built and optimized teams of 25+ across multiple regions, improved satisfaction metrics significantly, and partnered with C-suite executives on strategic initiatives. My background includes creating analytics frameworks and driving cross-functional implementations that enhanced retention and performance. I'd appreciate the opportunity to discuss how my experience aligns with Oscar's talent engagement goals.
                </div>
            </div>
        </div>

        <!-- Strategic Outreach Tips (Always Visible) -->
        <div class="tips-section">
            <h2 class="section-title">Strategic Outreach Tips</h2>
            <div class="tips-grid">
                <div class="tip-card">
                    <div class="tip-title">‚è∞ Timing Your Outreach</div>
                    <div class="tip-content">
                        Best times: Tuesday‚ÄìThursday, 10am‚Äì3pm in their timezone. Avoid Monday mornings and Friday afternoons. Wait 24 hours after applying before sending InMail.
                    </div>
                </div>

                <div class="tip-card">
                    <div class="tip-title">üìù What Recruiters Care About</div>
                    <div class="tip-content">
                        Can you do the job? Will you accept their offer? How quickly can you interview? Make these long answers in your outreach. Be specific about availability and interest level.
                    </div>
                </div>

                <div class="tip-card">
                    <div class="tip-title">üîç Check for Connections</div>
                    <div class="tip-content">
                        Look for mutual connections or shared alumni networks. Warm introductions get 3x higher response rates. If you find a mutual connection, ask for an intro instead of cold outreach.
                    </div>
                </div>

                <div class="tip-card">
                    <div class="tip-title">üéØ How to Stand Out</div>
                    <div class="tip-content">
                        Reference something specific from the company's recent news, blog post, or product launch. Shows genuine interest, not spray-and-pray applications. Do 5 minutes of research before sending.
                    </div>
                </div>
            </div>
        </div>

        <!-- Outreach Follow-Up Strategy (Always Visible) -->
        <div class="tips-section">
            <h2 class="section-title">Outreach Follow-Up Strategy</h2>
            <div class="tips-grid">
                <div class="tip-card">
                    <div class="tip-title">üìÖ Timeline Expectations</div>
                    <div class="tip-content">
                        Most responses come within 3-5 business days. If you haven't heard back after 2 weeks, the role is likely deprioritized or they've moved forward with other candidates. Move on.
                    </div>
                </div>

                <div class="tip-card">
                    <div class="tip-title">üîÑ When to Follow Up</div>
                    <div class="tip-content">
                        Send one follow-up 5-7 days after your initial outreach. Keep it brief: "Just wanted to bump this up in case it got buried. Still very interested in discussing the role."
                    </div>
                </div>

                <div class="tip-card">
                    <div class="tip-title">üö´ When to Stop</div>
                    <div class="tip-content">
                        After one follow-up with no response, stop. Multiple follow-ups signal desperation and hurt your positioning. Your time is better spent on roles where there's mutual interest.
                    </div>
                </div>

                <div class="tip-card">
                    <div class="tip-title">‚úÖ If They Respond</div>
                    <div class="tip-content">
                        Jump on it immediately. Suggest 2-3 specific times for a call within the next 48 hours. Speed signals interest and organizational skills‚Äîboth things recruiters care about.
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        // API Configuration
        const API_BASE = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
            ? 'http://localhost:8000'
            : 'https://henryai-app-production.up.railway.app';

        // Check for analysis data on page load - redirect if missing
        (function checkAnalysisData() {
            const analysisDataStr = sessionStorage.getItem('analysisData');
            if (!analysisDataStr) {
                console.log('No analysis data found in sessionStorage - redirecting');
                alert('No analysis data found. Please analyze a job first.');
                window.location.href = 'index.html';
                return;
            }
            
            try {
                const analysisData = JSON.parse(analysisDataStr);
                if (!analysisData._company_name && !analysisData.company) {
                    console.log('Analysis data exists but has no company - redirecting');
                    alert('No analysis data found. Please analyze a job first.');
                    window.location.href = 'index.html';
                    return;
                }
            } catch (e) {
                console.error('Failed to parse analysis data:', e);
                alert('Invalid analysis data. Please analyze a job first.');
                window.location.href = 'index.html';
                return;
            }
        })();

        // Toggle between Hiring Manager and Recruiter sections
        function showSection(section) {
            const hmSection = document.getElementById('hiringManagerSection');
            const recSection = document.getElementById('recruiterSection');
            const hmToggle = document.getElementById('hiringManagerToggle');
            const recToggle = document.getElementById('recruiterToggle');

            if (section === 'hiringManager') {
                hmSection.classList.remove('hidden');
                recSection.classList.add('hidden');
                hmToggle.classList.add('active');
                recToggle.classList.remove('active');
            } else {
                hmSection.classList.add('hidden');
                recSection.classList.remove('hidden');
                hmToggle.classList.remove('active');
                recToggle.classList.add('active');
            }
        }

        // Generate hiring insight based on available data
        function generateHiringInsight(companyName, velocity) {
            const signal = velocity.signal || 'Active';
            const openRoles = velocity.open_roles || 50;

            if (signal === 'High' || openRoles > 100) {
                return `${companyName} is in a hiring surge. This is a great time to reach out - recruiters are actively looking for candidates and response times are typically faster.`;
            } else if (signal === 'Active' || openRoles > 20) {
                return `${companyName} has steady hiring activity. Competition is moderate, so a well-positioned outreach can help you stand out from the applicant pool.`;
            } else {
                return `${companyName} appears to be hiring selectively. Focus on quality over speed - make sure your outreach demonstrates deep understanding of their specific needs.`;
            }
        }

        // Copy to clipboard function
        function copyToClipboard(elementId, button) {
            const element = document.getElementById(elementId);
            const text = element.textContent.trim();
            
            navigator.clipboard.writeText(text).then(() => {
                button.textContent = 'Copied!';
                button.classList.add('copied');
                
                setTimeout(() => {
                    button.textContent = 'Copy';
                    button.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy:', err);
                alert('Failed to copy. Please select and copy manually.');
            });
        }

        // Load data from sessionStorage
        window.addEventListener('DOMContentLoaded', () => {
            const analysisData = JSON.parse(sessionStorage.getItem('analysisData') || '{}');
            const outreach = analysisData.outreach_intelligence || {};

            // Populate Hiring Velocity section
            const companyName = analysisData._company_name || analysisData.company || 'this company';
            document.getElementById('velocityCompanyName').textContent = companyName;

            // Get hiring velocity data (from backend or estimate)
            const hiringVelocity = analysisData.hiring_velocity || {};

            if (hiringVelocity.open_roles !== undefined) {
                document.getElementById('openRolesCount').textContent = hiringVelocity.open_roles;
            } else {
                // Estimate based on company info
                document.getElementById('openRolesCount').textContent = '50+';
            }

            if (hiringVelocity.department_roles !== undefined) {
                document.getElementById('departmentRoles').textContent = hiringVelocity.department_roles;
            } else {
                document.getElementById('departmentRoles').textContent = '5-10';
            }

            if (hiringVelocity.signal) {
                document.getElementById('hiringSignal').textContent = hiringVelocity.signal;
            } else {
                document.getElementById('hiringSignal').textContent = 'Active';
            }

            // Generate insight based on data
            const insight = hiringVelocity.insight || generateHiringInsight(companyName, hiringVelocity);
            document.getElementById('velocityInsight').textContent = insight;

            // Populate Hiring Manager fields
            if (outreach.hiring_manager_likely_title) {
                document.getElementById('hmTitle').textContent = outreach.hiring_manager_likely_title;
            }
            if (outreach.hiring_manager_why_matters) {
                document.getElementById('hmWhy').textContent = outreach.hiring_manager_why_matters;
            }
            if (outreach.hiring_manager_linkedin_query) {
                document.getElementById('hmQuery').textContent = outreach.hiring_manager_linkedin_query;
            }
            if (outreach.hiring_manager_filter_instructions) {
                document.getElementById('hmFilter').textContent = outreach.hiring_manager_filter_instructions;
            }
            if (outreach.hiring_manager_outreach_template) {
                document.getElementById('hmTemplate').textContent = outreach.hiring_manager_outreach_template;
            }

            // Populate Recruiter fields
            if (outreach.recruiter_likely_title) {
                document.getElementById('recTitle').textContent = outreach.recruiter_likely_title;
            }
            if (outreach.recruiter_why_matters) {
                document.getElementById('recWhy').textContent = outreach.recruiter_why_matters;
            }
            if (outreach.recruiter_linkedin_query) {
                document.getElementById('recQuery').textContent = outreach.recruiter_linkedin_query;
            }
            if (outreach.recruiter_filter_instructions) {
                document.getElementById('recFilter').textContent = outreach.recruiter_filter_instructions;
            }
            if (outreach.recruiter_outreach_template) {
                document.getElementById('recTemplate').textContent = outreach.recruiter_outreach_template;
            }
        });

        // Handle CSV upload
        document.addEventListener('DOMContentLoaded', () => {
            // Check if connections already uploaded
            const existingConnections = localStorage.getItem('linkedinConnections');
            if (existingConnections) {
                try {
                    const connections = JSON.parse(existingConnections);
                    if (connections.length > 0) {
                        // Hide the value explanation since they already have connections
                        const valueSection = document.getElementById('linkedinValueSection');
                        if (valueSection) valueSection.style.display = 'none';

                        // Hide the upload prompt since they already have connections
                        const promptSection = document.getElementById('linkedinPrompt');
                        if (promptSection) promptSection.style.display = 'none';

                        // Auto-check network for this company
                        checkLinkedInNetwork(connections);
                    }
                } catch (e) {
                    console.error('Error parsing stored connections:', e);
                }
            }

            const uploadInput = document.getElementById('linkedinUpload');
            if (uploadInput) {
                uploadInput.addEventListener('change', async (event) => {
                    const file = event.target.files[0];
                    if (!file) return;

                    const reader = new FileReader();
                    reader.onload = async (e) => {
                        const csv = e.target.result;
                        const connections = parseLinkedInCSV(csv);

                        // Store for future use
                        localStorage.setItem('linkedinConnections', JSON.stringify(connections));

                        // Hide value explanation after upload
                        const valueSection = document.getElementById('linkedinValueSection');
                        if (valueSection) valueSection.style.display = 'none';

                        // Hide the prompt
                        dismissLinkedInPrompt();

                        // Check network
                        checkLinkedInNetwork(connections);
                    };
                    reader.readAsText(file);
                });
            }
        });

        // Parse LinkedIn CSV
        function parseLinkedInCSV(csv) {
            const lines = csv.split('\n');
            const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
            
            const connections = [];
            
            for (let i = 1; i < lines.length; i++) {
                if (!lines[i].trim()) continue;
                
                const values = lines[i].split(',').map(v => v.trim().replace(/"/g, ''));
                const connection = {};
                
                headers.forEach((header, index) => {
                    connection[header] = values[index] || '';
                });
                
                connections.push(connection);
            }
            
            return connections;
        }

        // Check network for connections at target company
        async function checkLinkedInNetwork(connections) {
            const analysisData = JSON.parse(sessionStorage.getItem('analysisData') || '{}');
            const targetCompany = analysisData._company_name || analysisData.company || analysisData._company || '';
            const roleTitle = analysisData.role_title || analysisData._role || '';

            if (!targetCompany) {
                alert('No target company found. Please analyze a job first.');
                return;
            }

            // Show loading state
            const resultsContainer = document.getElementById('linkedinResults');
            if (resultsContainer) {
                resultsContainer.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div class="loading-spinner"></div>
                        <span>Analyzing your network for relevant connections...</span>
                    </div>
                `;
                resultsContainer.style.display = 'block';
            }

            // First check for direct connections at target company
            const directConnections = connections.filter(conn => {
                const company = conn['Company'] || conn['company'] || '';
                return company.toLowerCase().includes(targetCompany.toLowerCase());
            });

            // Format connections for API call (sample up to 100 to avoid huge payloads)
            const formattedContacts = connections.slice(0, 100).map(conn => ({
                name: `${conn['First Name'] || ''} ${conn['Last Name'] || ''}`.trim(),
                company: conn['Company'] || conn['company'] || '',
                title: conn['Position'] || conn['position'] || '',
                relationship: 'linkedin_connection'
            })).filter(c => c.name && c.company);

            try {
                // Call the network recommendation API for smart matching
                const response = await fetch(`${API_BASE}/api/network/recommend`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        company: targetCompany,
                        role_title: roleTitle,
                        contacts: formattedContacts
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    displayNetworkRecommendations(data.recommendations, directConnections, targetCompany);
                } else {
                    // Fallback to simple display
                    displayLinkedInResults(directConnections, [], targetCompany);
                }
            } catch (error) {
                console.error('Network recommendation error:', error);
                // Fallback to simple display
                displayLinkedInResults(directConnections, [], targetCompany);
            }
        }

        // Display AI-powered network recommendations
        function displayNetworkRecommendations(recommendations, directConnections, company) {
            const resultsContainer = document.getElementById('linkedinResults');
            if (!resultsContainer) return;

            if (recommendations.length === 0 && directConnections.length === 0) {
                resultsContainer.innerHTML = `
                    <h4>No relevant connections found for ${company}</h4>
                    <p style="color: #9ca3af; margin-top: 8px;">
                        No problem! Cold outreach can still be effective with the right positioning.
                        Use the templates above and reference your relevant experience.
                    </p>
                `;
                resultsContainer.style.display = 'block';
                return;
            }

            let html = '';

            // Show direct connections first
            if (directConnections.length > 0) {
                html += `<h4 style="margin-bottom: 16px;">üéØ Found ${directConnections.length} connection(s) at ${company}</h4>`;
                html += `<div class="connection-group" style="margin-bottom: 24px;">`;
                directConnections.forEach(conn => {
                    const name = `${conn['First Name'] || ''} ${conn['Last Name'] || ''}`.trim();
                    const title = conn['Position'] || 'Position not available';
                    html += `
                        <div class="connection-item" style="background: rgba(16, 185, 129, 0.15); border: 1px solid #10b981; border-radius: 8px; padding: 16px; margin-bottom: 12px;">
                            <div class="connection-name" style="font-weight: 600; font-size: 1.05rem;">${name}</div>
                            <div class="connection-title" style="color: #9ca3af; margin-top: 4px;">${title} at ${company}</div>
                            <div style="margin-top: 12px; padding: 12px; background: rgba(16, 185, 129, 0.1); border-radius: 6px; font-size: 0.9rem;">
                                <strong>üî• Direct connection!</strong> Reach out for a referral or insider info on the role.
                            </div>
                        </div>
                    `;
                });
                html += `</div>`;
            }

            // Show AI recommendations for relevant connections
            if (recommendations.length > 0) {
                html += `<h4 style="margin-bottom: 16px;">üí° Recommended Outreach (${recommendations.length} relevant connections)</h4>`;
                html += `<div class="recommendations-list">`;

                recommendations.forEach((rec, idx) => {
                    const priorityColors = {
                        1: '#10b981',  // green - high priority
                        2: '#f59e0b',  // amber - medium
                        3: '#6b7280'   // gray - lower
                    };
                    const priorityLabels = {
                        1: 'High Priority',
                        2: 'Worth Reaching Out',
                        3: 'Consider'
                    };
                    const color = priorityColors[rec.priority] || '#6b7280';
                    const label = priorityLabels[rec.priority] || 'Consider';

                    html += `
                        <div class="recommendation-item" style="background: rgba(255, 255, 255, 0.05); border: 1px solid ${color}40; border-radius: 8px; padding: 16px; margin-bottom: 12px;">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                <div>
                                    <div style="font-weight: 600; font-size: 1.05rem;">${rec.name}</div>
                                    <div style="color: #9ca3af; margin-top: 4px;">${rec.title} at ${rec.company}</div>
                                </div>
                                <span style="background: ${color}20; color: ${color}; padding: 4px 10px; border-radius: 12px; font-size: 0.75rem; font-weight: 600;">${label}</span>
                            </div>
                            <div style="margin-top: 12px; color: #e0e0e0; font-size: 0.9rem;">
                                <strong>Why:</strong> ${rec.reason}
                            </div>
                            <div style="margin-top: 12px; padding: 12px; background: rgba(96, 165, 250, 0.1); border-radius: 6px; font-size: 0.9rem; border-left: 3px solid #60a5fa;">
                                <strong>Message idea:</strong> ${rec.suggested_message_stub}
                            </div>
                        </div>
                    `;
                });

                html += `</div>`;
            }

            resultsContainer.innerHTML = html;
            resultsContainer.style.display = 'block';
        }

        // Display results
        function displayLinkedInResults(directConnections, secondDegreeConnections, company) {
            const resultsContainer = document.getElementById('linkedinResults');
            if (!resultsContainer) return;
            
            if (directConnections.length === 0 && secondDegreeConnections.length === 0) {
                resultsContainer.innerHTML = `
                    <h4>No direct connections found at ${company}</h4>
                    <p style="color: #9ca3af; margin-top: 8px;">
                        No problem! Cold outreach can still be effective with the right positioning. 
                        Use the templates above and reference your relevant experience.
                    </p>
                `;
                resultsContainer.style.display = 'block';
                return;
            }
            
            let html = `<h4>üéØ Found ${directConnections.length} connection(s) at ${company}</h4>`;
            
            if (directConnections.length > 0) {
                html += `<div class="connection-group">`;
                html += `<h5>Direct Connections (1st Degree)</h5>`;
                
                directConnections.forEach(conn => {
                    const name = conn['First Name'] + ' ' + conn['Last Name'];
                    const title = conn['Position'] || 'Position not available';
                    const connectedDate = conn['Connected On'] || 'Unknown';
                    
                    html += `
                        <div class="connection-item">
                            <div class="connection-name">${name}</div>
                            <div class="connection-title">${title}</div>
                            <div class="connection-meta">
                                <span>üìÖ Connected: ${connectedDate}</span>
                            </div>
                            <div style="margin-top: 12px; padding: 12px; background: rgba(16, 185, 129, 0.1); border-radius: 6px; font-size: 0.9rem;">
                                <strong>Suggested approach:</strong> Send a personalized message referencing your shared background and expressing interest in the role. Mention specific projects or achievements that align with ${company}'s needs.
                            </div>
                        </div>
                    `;
                });
                
                html += `</div>`;
            }
            
            resultsContainer.innerHTML = html;
            resultsContainer.style.display = 'block';
        }

        // Show help modal
        function showLinkedInHelp() {
            alert(`How to Export LinkedIn Connections:

1. Go to linkedin.com/mynetwork/invite-connect/connections/
2. Click "Manage synced and imported contacts" (top right)
3. Click "Export contacts"
4. Select "Connections" (not "Contacts")
5. Click "Request archive"
6. Wait for email from LinkedIn (usually 10 minutes)
7. Download the CSV file
8. Upload it here

The CSV includes: Name, Company, Position, Connected Date`);
        }

        // Dismiss prompt
        function dismissLinkedInPrompt() {
            const prompt = document.getElementById('linkedinPrompt');
            if (prompt) {
                prompt.style.display = 'none';
                sessionStorage.setItem('linkedinPromptDismissed', 'true');
            }
        }

    </script>
<script src="components/ask-henry.js"></script>
</body>
</html>
